'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/**
 * DatetimeField Component for tingle
 * @author caoke.ck
 *
 * Copyright 2014-2016, Tingle Team.
 * All rights reserved.
 */
var React = require('react');
var classnames = require('classnames');

var Context = require('@ali/tingle-context');
var Slot = require('@ali/tingle-slot');
var Icon = require('@ali/tingle-icon');
var Field = require('@ali/tingle-field');

if (!React.addons || !React.addons.update) {
    console.warning('Please use react with addons!');
}

var DatetimeField = function (_React$Component) {
    _inherits(DatetimeField, _React$Component);

    function DatetimeField(props) {
        _classCallCheck(this, DatetimeField);

        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(DatetimeField).call(this, props));

        var t = _this;

        // 使用当前时间或传入时间作为默认值
        var currentValue = parseValue(props.value);

        // 形成候选项
        var options = [makeArray(currentValue[0] - 80, currentValue[0] + 20), makeArray(1, 12).map(function (v) {
            return { text: '' + v, value: v - 1 };
        }), getDates(currentValue[0], currentValue[1]), makeArray(0, 23), makeArray(0, 59), makeArray(0, 59)];
        currentValue = slice(currentValue, props);
        options = slice(options, props);

        // 数据格式化
        var ret = Slot.formatDataValue(options, currentValue);
        t.state = {
            data: ret.data,
            value: currentValue,
            confirmedValue: props.value ? ret.value : []
        };
        return _this;
    }

    // 外部变更选中值


    _createClass(DatetimeField, [{
        key: 'componentWillReceiveProps',
        value: function componentWillReceiveProps(nextProps) {
            var t = this;
            var value = nextProps.value;
            if (value) {
                t.setValue(slice(parseValue(nextProps.value), nextProps), true);
            } else {
                t.setState({
                    confirmedValue: []
                });
            }
        }
    }, {
        key: 'handleClick',
        value: function handleClick() {
            var t = this;
            !t.props.readOnly && t.refs.slot.show();
        }
    }, {
        key: 'handleChange',
        value: function handleChange(value, column, index) {
            var t = this;
            var dates = void 0;
            if (value.length > 2) {
                if (column === 1) {

                    // 改变了月份，会导致月内天数的改变
                    dates = getDates(value[0].value, value[1].value);
                } else if (column === 0 && value[1].value === 1) {

                    // 改变了年份，会导致 2 月天数的改变
                    dates = getDates(value[0].value, 1);
                }
            }
            if (dates) {

                // 同时变更日期和选中项
                var ret = Slot.formatColumnValue(dates, value[2]);
                value[2] = ret.columnValue;
                t.setState(React.addons.update(t.state, {
                    data: _defineProperty({}, 2, {
                        $set: ret.columnData
                    }),
                    value: {
                        $set: value
                    }
                }));
            } else {

                // 仅改变了选中项
                t.setState({
                    value: value
                });
            }
        }
    }, {
        key: 'handleConfirm',
        value: function handleConfirm(value) {
            var t = this;
            var argv = value.map(function (v) {
                return v.value;
            });
            for (var i = 0; i < 6; i++) {
                argv[i] = argv[i] || (i === 2 ? 1 : 0);
            }
            var date = new (Function.prototype.bind.apply(Date, [null].concat(argv)))();

            // 确认选中项目
            t.props.onSelect(date.getTime());
        }
    }, {
        key: 'handleCancel',
        value: function handleCancel() {
            var t = this;
            if (t.state.confirmedValue && t.state.confirmedValue.length) {
                t.setValue(t.state.confirmedValue);
            }
        }
    }, {
        key: 'setValue',
        value: function setValue(val, confirm) {
            var t = this;

            var _Slot$formatDataValue = Slot.formatDataValue(t.state.data, val);

            var value = _Slot$formatDataValue.value;

            var changes = void 0;

            if (value.length > 2) {
                // 为确保有对应的日期，需要重新设置日期
                var dates = getDates(value[0].value, value[1].value);
                var ret = Slot.formatColumnValue(dates);
                changes = {
                    data: _defineProperty({}, 2, {
                        $set: ret.columnData
                    }),
                    value: {
                        $set: value
                    }
                };
            } else {
                changes = {
                    value: {
                        $set: value
                    }
                };
            }
            if (confirm) {
                changes.confirmedValue = {
                    $set: value
                };
            }
            t.setState(React.addons.update(t.state, changes));
        }
    }, {
        key: 'render',
        value: function render() {
            var t = this;
            var options = [];
            return React.createElement(
                Field,
                _extends({}, t.props, { icon: t.props.readOnly ? null : {
                        className: Context.prefixClass('datetime-field-icon'),
                        name: 'angle-right',
                        width: 26,
                        height: 26,
                        onClick: t.handleClick.bind(t)
                    },
                    className: classnames(Context.prefixClass('datetime-field'), _defineProperty({}, t.props.className, !!t.props.className)) }),
                React.createElement(
                    'div',
                    { onClick: t.handleClick.bind(t) },
                    !t.state.confirmedValue[0] ? React.createElement(
                        'div',
                        { className: Context.prefixClass('omit datetime-field-placeholder') },
                        t.props.placeholder
                    ) : '',
                    React.createElement(
                        'div',
                        { className: Context.prefixClass('datetime-field-value FBH FBAC') },
                        React.createElement(
                            'span',
                            { className: classnames(Context.prefixClass('FB1 omit'), _defineProperty({}, Context.prefixClass('datetime-field-readonly'), !!t.props.readOnly)) },
                            t.props.formatter(t.state.confirmedValue)
                        )
                    )
                ),
                React.createElement(Slot, { ref: 'slot', title: t.props.label, confirmText: t.props.confirmText, cancelText: t.props.cancelText, data: t.state.data, value: t.state.value, onChange: t.handleChange.bind(t), onCancel: t.handleCancel.bind(t), onConfirm: t.handleConfirm.bind(t), columns: t.props.columns })
            );
        }
    }]);

    return DatetimeField;
}(React.Component);

DatetimeField.defaultProps = {
    formatter: function formatter(value) {
        var arr = value.map(function (v) {
            return v.text < 10 ? '0' + v.text : v.text;
        });
        if (arr.length < 4) {
            return arr.join('-');
        } else {
            return arr.slice(0, 3).join('-') + ' ' + arr.slice(3).join(':');
        }
    },
    onSelect: function onSelect() {},
    readOnly: false,
    placeholder: '',
    columns: ['年', '月', '日', '时', '分', '秒']
};

// http://facebook.github.io/react/docs/reusable-components.html
DatetimeField.propTypes = {
    className: React.PropTypes.string,
    label: React.PropTypes.string.isRequired,
    value: React.PropTypes.number,
    formatter: React.PropTypes.func,
    onSelect: React.PropTypes.func,
    readOnly: React.PropTypes.bool,
    placeholder: React.PropTypes.string,
    confirmText: React.PropTypes.string,
    cancelText: React.PropTypes.string,
    columns: React.PropTypes.array
};

DatetimeField.displayName = 'DatetimeField';

module.exports = DatetimeField;

// 是否是闰年的判断
function isLeapYear(year) {
    return year % 4 === 0 && year % 100 !== 0 || year % 400 === 0;
}

function makeArray(start, end) {
    for (var arr = [], i = start; i <= end; i++) {
        arr.push(i);
    }
    return arr;
}

// 获取某个月份的日期选项
function getDates(year, month) {
    var dates = [];
    switch ('1 1010110101'.split('')[month]) {
        case '1':
            // 大月
            return makeArray(1, 31);
        case '0':
            // 小月
            return makeArray(1, 30);
        case ' ':
            // 闰年 2 月 和 平年 2 月
            return isLeapYear(year) ? makeArray(1, 29) : makeArray(1, 28);
    }
}

function parseValue(value) {
    var date = value ? new Date(parseInt(value)) : new Date();
    return [date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds()];
}

function slice(array, props) {
    return array.slice(0, props.columns.length);
}
//# sourceMappingURL=data:application/json;base64,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LENBQTdDO0FBTlI7QUFRSDs7QUFFRCxTQUFTLFVBQVQsQ0FBb0IsS0FBcEIsRUFBMkI7QUFDdkIsUUFBSSxPQUFPLFFBQVEsSUFBSSxJQUFKLENBQVMsU0FBUyxLQUFULENBQVQsQ0FBUixHQUFvQyxJQUFJLElBQUosRUFBL0M7QUFDQSxXQUFPLENBQ0gsS0FBSyxXQUFMLEVBREcsRUFFSCxLQUFLLFFBQUwsRUFGRyxFQUdILEtBQUssT0FBTCxFQUhHLEVBSUgsS0FBSyxRQUFMLEVBSkcsRUFLSCxLQUFLLFVBQUwsRUFMRyxFQU1ILEtBQUssVUFBTCxFQU5HLENBQVA7QUFRSDs7QUFFRCxTQUFTLEtBQVQsQ0FBZSxLQUFmLEVBQXNCLEtBQXRCLEVBQTZCO0FBQ3pCLFdBQU8sTUFBTSxLQUFOLENBQVksQ0FBWixFQUFlLE1BQU0sT0FBTixDQUFjLE1BQTdCLENBQVA7QUFDSCIsImZpbGUiOiJEYXRldGltZUZpZWxkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBEYXRldGltZUZpZWxkIENvbXBvbmVudCBmb3IgdGluZ2xlXG4gKiBAYXV0aG9yIGNhb2tlLmNrXG4gKlxuICogQ29weXJpZ2h0IDIwMTQtMjAxNiwgVGluZ2xlIFRlYW0uXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICovXG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBjbGFzc25hbWVzID0gcmVxdWlyZSgnY2xhc3NuYW1lcycpO1xuXG5jb25zdCBDb250ZXh0ID0gcmVxdWlyZSgnQGFsaS90aW5nbGUtY29udGV4dCcpO1xuY29uc3QgU2xvdCA9IHJlcXVpcmUoJ0BhbGkvdGluZ2xlLXNsb3QnKTtcbmNvbnN0IEljb24gPSByZXF1aXJlKCdAYWxpL3RpbmdsZS1pY29uJyk7XG5jb25zdCBGaWVsZCA9IHJlcXVpcmUoJ0BhbGkvdGluZ2xlLWZpZWxkJyk7XG5cbmlmICghUmVhY3QuYWRkb25zIHx8ICFSZWFjdC5hZGRvbnMudXBkYXRlKSB7XG4gICAgY29uc29sZS53YXJuaW5nKCdQbGVhc2UgdXNlIHJlYWN0IHdpdGggYWRkb25zIScpO1xufVxuXG5jbGFzcyBEYXRldGltZUZpZWxkIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuXG4gICAgICAgIC8vIOS9v+eUqOW9k+WJjeaXtumXtOaIluS8oOWFpeaXtumXtOS9nOS4uum7mOiupOWAvFxuICAgICAgICBsZXQgY3VycmVudFZhbHVlID0gcGFyc2VWYWx1ZShwcm9wcy52YWx1ZSk7XG5cbiAgICAgICAgLy8g5b2i5oiQ5YCZ6YCJ6aG5XG4gICAgICAgIGxldCBvcHRpb25zID0gW1xuICAgICAgICAgICAgbWFrZUFycmF5KGN1cnJlbnRWYWx1ZVswXSAtIDgwLCBjdXJyZW50VmFsdWVbMF0gKyAyMCksXG4gICAgICAgICAgICBtYWtlQXJyYXkoMSwgMTIpLm1hcCgodikgPT4geyByZXR1cm4geyB0ZXh0OiBgJHt2fWAsIHZhbHVlOiB2IC0gMSB9fSksXG4gICAgICAgICAgICBnZXREYXRlcyhjdXJyZW50VmFsdWVbMF0sIGN1cnJlbnRWYWx1ZVsxXSksXG4gICAgICAgICAgICBtYWtlQXJyYXkoMCwgMjMpLFxuICAgICAgICAgICAgbWFrZUFycmF5KDAsIDU5KSxcbiAgICAgICAgICAgIG1ha2VBcnJheSgwLCA1OSlcbiAgICAgICAgXTtcbiAgICAgICAgY3VycmVudFZhbHVlID0gc2xpY2UoY3VycmVudFZhbHVlLCBwcm9wcyk7XG4gICAgICAgIG9wdGlvbnMgPSBzbGljZShvcHRpb25zLCBwcm9wcyk7XG5cbiAgICAgICAgLy8g5pWw5o2u5qC85byP5YyWXG4gICAgICAgIGxldCByZXQgPSBTbG90LmZvcm1hdERhdGFWYWx1ZShvcHRpb25zLCBjdXJyZW50VmFsdWUpO1xuICAgICAgICB0LnN0YXRlID0ge1xuICAgICAgICAgICAgZGF0YTogcmV0LmRhdGEsXG4gICAgICAgICAgICB2YWx1ZTogY3VycmVudFZhbHVlLFxuICAgICAgICAgICAgY29uZmlybWVkVmFsdWU6IHByb3BzLnZhbHVlID8gcmV0LnZhbHVlIDogW11cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyDlpJbpg6jlj5jmm7TpgInkuK3lgLxcbiAgICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIGxldCB2YWx1ZSA9IG5leHRQcm9wcy52YWx1ZTtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICB0LnNldFZhbHVlKHNsaWNlKHBhcnNlVmFsdWUobmV4dFByb3BzLnZhbHVlKSwgbmV4dFByb3BzKSwgdHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0LnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBjb25maXJtZWRWYWx1ZTogW11cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFuZGxlQ2xpY2soKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgIXQucHJvcHMucmVhZE9ubHkgJiYgdC5yZWZzLnNsb3Quc2hvdygpO1xuICAgIH1cblxuICAgIGhhbmRsZUNoYW5nZSh2YWx1ZSwgY29sdW1uLCBpbmRleCkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIGxldCBkYXRlcztcbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgIGlmIChjb2x1bW4gPT09IDEpIHtcblxuICAgICAgICAgICAgICAgIC8vIOaUueWPmOS6huaciOS7ve+8jOS8muWvvOiHtOaciOWGheWkqeaVsOeahOaUueWPmFxuICAgICAgICAgICAgICAgIGRhdGVzID0gZ2V0RGF0ZXModmFsdWVbMF0udmFsdWUsIHZhbHVlWzFdLnZhbHVlKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChjb2x1bW4gPT09IDAgJiYgdmFsdWVbMV0udmFsdWUgPT09IDEpIHtcblxuICAgICAgICAgICAgICAgIC8vIOaUueWPmOS6huW5tOS7ve+8jOS8muWvvOiHtCAyIOaciOWkqeaVsOeahOaUueWPmFxuICAgICAgICAgICAgICAgIGRhdGVzID0gZ2V0RGF0ZXModmFsdWVbMF0udmFsdWUsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRlcykge1xuXG4gICAgICAgICAgICAvLyDlkIzml7blj5jmm7Tml6XmnJ/lkozpgInkuK3poblcbiAgICAgICAgICAgIGxldCByZXQgPSBTbG90LmZvcm1hdENvbHVtblZhbHVlKGRhdGVzLCB2YWx1ZVsyXSk7XG4gICAgICAgICAgICB2YWx1ZVsyXSA9IHJldC5jb2x1bW5WYWx1ZTtcbiAgICAgICAgICAgIHQuc2V0U3RhdGUoUmVhY3QuYWRkb25zLnVwZGF0ZSh0LnN0YXRlLCB7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBbMl06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzZXQ6IHJldC5jb2x1bW5EYXRhXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICRzZXQ6IHZhbHVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAvLyDku4XmlLnlj5jkuobpgInkuK3poblcbiAgICAgICAgICAgIHQuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBoYW5kbGVDb25maXJtKHZhbHVlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgbGV0IGFyZ3YgPSB2YWx1ZS5tYXAoKHYpID0+IHYudmFsdWUpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykge1xuICAgICAgICAgICAgYXJndltpXSA9IGFyZ3ZbaV0gfHwgKGkgPT09IDIgPyAxIDogMCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRhdGUgPSBuZXcgKEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmFwcGx5KERhdGUsIFtudWxsXS5jb25jYXQoYXJndikpKTtcblxuICAgICAgICAvLyDnoa7orqTpgInkuK3pobnnm65cbiAgICAgICAgdC5wcm9wcy5vblNlbGVjdChkYXRlLmdldFRpbWUoKSk7XG4gICAgfVxuXG4gICAgaGFuZGxlQ2FuY2VsKCkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIGlmICh0LnN0YXRlLmNvbmZpcm1lZFZhbHVlICYmIHQuc3RhdGUuY29uZmlybWVkVmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICB0LnNldFZhbHVlKHQuc3RhdGUuY29uZmlybWVkVmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0VmFsdWUodmFsLCBjb25maXJtKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgbGV0IHsgdmFsdWUgfSA9IFNsb3QuZm9ybWF0RGF0YVZhbHVlKHQuc3RhdGUuZGF0YSwgdmFsKTtcbiAgICAgICAgbGV0IGNoYW5nZXM7XG5cbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgIC8vIOS4uuehruS/neacieWvueW6lOeahOaXpeacn++8jOmcgOimgemHjeaWsOiuvue9ruaXpeacn1xuICAgICAgICAgICAgbGV0IGRhdGVzID0gZ2V0RGF0ZXModmFsdWVbMF0udmFsdWUsIHZhbHVlWzFdLnZhbHVlKTtcbiAgICAgICAgICAgIGxldCByZXQgPSBTbG90LmZvcm1hdENvbHVtblZhbHVlKGRhdGVzKTtcbiAgICAgICAgICAgIGNoYW5nZXMgPSB7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBbMl06IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzZXQ6IHJldC5jb2x1bW5EYXRhXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICRzZXQ6IHZhbHVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNoYW5nZXMgPSB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgJHNldDogdmFsdWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maXJtKSB7XG4gICAgICAgICAgICBjaGFuZ2VzLmNvbmZpcm1lZFZhbHVlID0ge1xuICAgICAgICAgICAgICAgICRzZXQ6IHZhbHVlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHQuc2V0U3RhdGUoUmVhY3QuYWRkb25zLnVwZGF0ZSh0LnN0YXRlLCBjaGFuZ2VzKSk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIGxldCBvcHRpb25zID0gW107XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8RmllbGQgey4uLnQucHJvcHN9IGljb249e3QucHJvcHMucmVhZE9ubHkgPyBudWxsIDoge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IENvbnRleHQucHJlZml4Q2xhc3MoJ2RhdGV0aW1lLWZpZWxkLWljb24nKSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2FuZ2xlLXJpZ2h0JyxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDI2LFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDI2LFxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiB0LmhhbmRsZUNsaWNrLmJpbmQodClcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NuYW1lcyhDb250ZXh0LnByZWZpeENsYXNzKCdkYXRldGltZS1maWVsZCcpLCB7XG4gICAgICAgICAgICAgICAgICAgIFt0LnByb3BzLmNsYXNzTmFtZV06ICEhdC5wcm9wcy5jbGFzc05hbWVcbiAgICAgICAgICAgICAgICB9KX0+XG4gICAgICAgICAgICAgICAgPGRpdiBvbkNsaWNrPXt0LmhhbmRsZUNsaWNrLmJpbmQodCl9PlxuICAgICAgICAgICAgICAgICAgICB7IXQuc3RhdGUuY29uZmlybWVkVmFsdWVbMF0gPyA8ZGl2IGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnb21pdCBkYXRldGltZS1maWVsZC1wbGFjZWhvbGRlcicpfT57dC5wcm9wcy5wbGFjZWhvbGRlcn08L2Rpdj4gOiAnJ31cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e0NvbnRleHQucHJlZml4Q2xhc3MoJ2RhdGV0aW1lLWZpZWxkLXZhbHVlIEZCSCBGQkFDJyl9PlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtjbGFzc25hbWVzKENvbnRleHQucHJlZml4Q2xhc3MoJ0ZCMSBvbWl0JyksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbQ29udGV4dC5wcmVmaXhDbGFzcygnZGF0ZXRpbWUtZmllbGQtcmVhZG9ubHknKV06ICEhdC5wcm9wcy5yZWFkT25seVxuICAgICAgICAgICAgICAgICAgICAgICAgfSl9Pnt0LnByb3BzLmZvcm1hdHRlcih0LnN0YXRlLmNvbmZpcm1lZFZhbHVlKX08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxTbG90IHJlZj1cInNsb3RcIiB0aXRsZT17dC5wcm9wcy5sYWJlbH0gY29uZmlybVRleHQ9e3QucHJvcHMuY29uZmlybVRleHR9IGNhbmNlbFRleHQ9e3QucHJvcHMuY2FuY2VsVGV4dH0gZGF0YT17dC5zdGF0ZS5kYXRhfSB2YWx1ZT17dC5zdGF0ZS52YWx1ZX0gb25DaGFuZ2U9e3QuaGFuZGxlQ2hhbmdlLmJpbmQodCl9IG9uQ2FuY2VsPXt0LmhhbmRsZUNhbmNlbC5iaW5kKHQpfSBvbkNvbmZpcm09e3QuaGFuZGxlQ29uZmlybS5iaW5kKHQpfSBjb2x1bW5zPXt0LnByb3BzLmNvbHVtbnN9Lz5cbiAgICAgICAgICAgIDwvRmllbGQ+XG4gICAgICAgICk7XG4gICAgfVxufVxuXG5EYXRldGltZUZpZWxkLmRlZmF1bHRQcm9wcyA9IHtcbiAgICBmb3JtYXR0ZXI6ICh2YWx1ZSkgPT4ge1xuICAgICAgICBsZXQgYXJyID0gdmFsdWUubWFwKCh2KSA9PiB2LnRleHQgPCAxMCA/IGAwJHt2LnRleHR9YCA6IHYudGV4dCk7XG4gICAgICAgIGlmIChhcnIubGVuZ3RoIDwgNCkge1xuICAgICAgICAgICAgcmV0dXJuIGFyci5qb2luKCctJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7YXJyLnNsaWNlKDAsIDMpLmpvaW4oJy0nKX0gJHthcnIuc2xpY2UoMykuam9pbignOicpfWA7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uU2VsZWN0OiAoKSA9PiB7fSxcbiAgICByZWFkT25seTogZmFsc2UsXG4gICAgcGxhY2Vob2xkZXI6ICcnLFxuICAgIGNvbHVtbnM6IFsgJ+W5tCcsICfmnIgnLCAn5pelJywgJ+aXticsICfliIYnLCAn56eSJyBdXG59XG5cbi8vIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QvZG9jcy9yZXVzYWJsZS1jb21wb25lbnRzLmh0bWxcbkRhdGV0aW1lRmllbGQucHJvcFR5cGVzID0ge1xuICAgIGNsYXNzTmFtZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBsYWJlbDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyLFxuICAgIGZvcm1hdHRlcjogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25TZWxlY3Q6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgIHJlYWRPbmx5OiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICBwbGFjZWhvbGRlcjogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb25maXJtVGV4dDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjYW5jZWxUZXh0OiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNvbHVtbnM6IFJlYWN0LlByb3BUeXBlcy5hcnJheVxufVxuXG5EYXRldGltZUZpZWxkLmRpc3BsYXlOYW1lID0gJ0RhdGV0aW1lRmllbGQnO1xuXG5tb2R1bGUuZXhwb3J0cyA9IERhdGV0aW1lRmllbGQ7XG5cbi8vIOaYr+WQpuaYr+mXsOW5tOeahOWIpOaWrVxuZnVuY3Rpb24gaXNMZWFwWWVhcih5ZWFyKSB7XG4gICAgcmV0dXJuIHllYXIgJSA0ID09PSAwICYmIHllYXIgJSAxMDAgIT09IDAgfHwgeWVhciAlIDQwMCA9PT0gMDtcbn1cblxuZnVuY3Rpb24gbWFrZUFycmF5KHN0YXJ0LCBlbmQpIHtcbiAgICBmb3IgKHZhciBhcnIgPSBbXSwgaSA9IHN0YXJ0OyBpIDw9IGVuZDsgaSsrKSB7XG4gICAgICAgIGFyci5wdXNoKGkpO1xuICAgIH1cbiAgICByZXR1cm4gYXJyO1xufVxuXG4vLyDojrflj5bmn5DkuKrmnIjku73nmoTml6XmnJ/pgInpoblcbmZ1bmN0aW9uIGdldERhdGVzKHllYXIsIG1vbnRoKSB7XG4gICAgbGV0IGRhdGVzID0gW107XG4gICAgc3dpdGNoICgnMSAxMDEwMTEwMTAxJy5zcGxpdCgnJylbbW9udGhdKSB7XG4gICAgICAgIGNhc2UgJzEnOiAvLyDlpKfmnIhcbiAgICAgICAgICAgIHJldHVybiBtYWtlQXJyYXkoMSwgMzEpO1xuICAgICAgICBjYXNlICcwJzogLy8g5bCP5pyIXG4gICAgICAgICAgICByZXR1cm4gbWFrZUFycmF5KDEsIDMwKTtcbiAgICAgICAgY2FzZSAnICc6IC8vIOmXsOW5tCAyIOaciCDlkowg5bmz5bm0IDIg5pyIXG4gICAgICAgICAgICByZXR1cm4gaXNMZWFwWWVhcih5ZWFyKSA/IG1ha2VBcnJheSgxLCAyOSkgOiBtYWtlQXJyYXkoMSwgMjgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcGFyc2VWYWx1ZSh2YWx1ZSkge1xuICAgIGxldCBkYXRlID0gdmFsdWUgPyBuZXcgRGF0ZShwYXJzZUludCh2YWx1ZSkpIDogbmV3IERhdGUoKTtcbiAgICByZXR1cm4gW1xuICAgICAgICBkYXRlLmdldEZ1bGxZZWFyKCksXG4gICAgICAgIGRhdGUuZ2V0TW9udGgoKSxcbiAgICAgICAgZGF0ZS5nZXREYXRlKCksXG4gICAgICAgIGRhdGUuZ2V0SG91cnMoKSxcbiAgICAgICAgZGF0ZS5nZXRNaW51dGVzKCksXG4gICAgICAgIGRhdGUuZ2V0U2Vjb25kcygpXG4gICAgXTtcbn1cblxuZnVuY3Rpb24gc2xpY2UoYXJyYXksIHByb3BzKSB7XG4gICAgcmV0dXJuIGFycmF5LnNsaWNlKDAsIHByb3BzLmNvbHVtbnMubGVuZ3RoKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
