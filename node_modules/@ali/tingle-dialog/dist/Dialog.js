'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/**
 * Dialog Component for tingle
 * @author minjie,cm
 *
 * Copyright 2014-2016, Tingle Team, Alinw.
 * All rights reserved.
 */
var React = require('react');
var classnames = require('classnames');
var Context = require('@ali/tingle-context');
var i18nHelper = require('i18n-helper');
var lang = require('./i18n');
var ReactCSSTransitionGroup = React.addons.CSSTransitionGroup;
var prefixClass = Context.prefixClass;


var TYPES = ['alert', 'confirm'];

var EMPTY_FUNC = function EMPTY_FUNC() {};

var i18n = function i18n() {
    var locale = arguments.length <= 0 || arguments[0] === undefined ? 'zh_CN' : arguments[0];
    return i18nHelper(lang[locale] || lang.zh_CN);
};

var Dialog = function (_React$Component) {
    _inherits(Dialog, _React$Component);

    function Dialog(props) {
        _classCallCheck(this, Dialog);

        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Dialog).call(this, props));

        var buttons = [{
            content: props.confirmText || i18n(props.locale)('ok'),
            callback: props.onConfirm || EMPTY_FUNC,
            primary: true
        }];

        if (_this.props.type === TYPES[1]) {
            buttons = [{
                content: _this.props.cancelText || i18n(props.locale)('cancel'),
                callback: _this.props.onCancel || EMPTY_FUNC
            }, {
                content: _this.props.confirmText || i18n(props.locale)('ok'),
                callback: _this.props.onConfirm || EMPTY_FUNC,
                primary: true
            }];
        }

        _this.state = {
            title: props.title,
            content: props.content, // 为快捷 API 提供的，Dialog React 方式使用，直接渲染 children
            buttons: buttons,
            show: props.show
        };
        return _this;
    }

    _createClass(Dialog, [{
        key: 'componentWillReceiveProps',
        value: function componentWillReceiveProps(nextProps) {
            this.setState({
                show: nextProps.show,
                title: nextProps.title
            });
        }
    }, {
        key: '_show',
        value: function _show(options) {
            var state = this.state;
            var prop = options ? options : this.props;

            state.show = true;
            state.title = prop.title;
            state.content = prop.content;
            state.buttons = prop.buttons;

            this.setState(state);
        }

        // deprecated

    }, {
        key: 'hide',
        value: function hide() {
            this.setState({ show: false });
        }

        // deprecated

    }, {
        key: 'show',
        value: function show() {
            this.setState({ show: true });
        }
    }, {
        key: 'handleClick',
        value: function handleClick(callback) {
            if (callback() !== false) {
                this.hide();
            }
        }
    }, {
        key: 'render',
        value: function render() {
            var _classSet;

            var t = this;
            var btn = '';
            var _t$props = t.props;
            var className = _t$props.className;
            var children = _t$props.children;

            var other = _objectWithoutProperties(_t$props, ['className', 'children']);

            var _t$state = t.state;
            var title = _t$state.title;
            var buttons = _t$state.buttons;
            var content = _t$state.content;

            var classSet = (_classSet = {}, _defineProperty(_classSet, prefixClass('dialog'), true), _defineProperty(_classSet, t.props.className, !!t.props.className), _classSet);
            var btnsCount = buttons.length;

            btn = buttons && buttons.map(function (item, i) {
                var _classnames;

                var callback = item.callback || function () {
                    return true;
                };
                return React.createElement(
                    'div',
                    { key: 'tDialogButtonKey' + i,
                        className: classnames(prefixClass('FB1 dialog-button TE'), (_classnames = {}, _defineProperty(_classnames, prefixClass('dialog-primary'), item.primary), _defineProperty(_classnames, prefixClass('dialog-secondary'), !item.primary), _defineProperty(_classnames, prefixClass('dialog-brbl5'), i === 0 || btnsCount === 1), _defineProperty(_classnames, prefixClass('dialog-brbr5'), i === 1 || i === btnsCount - 1), _classnames)),
                        onClick: t.handleClick.bind(t, callback) },
                    i18n(t.props.locale)(item.content)
                );
            });

            var displayContent = children;
            if (content) {
                displayContent = content;
            }

            return React.createElement(
                ReactCSSTransitionGroup,
                {
                    transitionName: prefixClass('dialog-fade'),
                    transitionEnterTimeout: 300, transitionLeaveTimeout: 300,
                    transitionAppear: true, transitionAppearTimeout: 300 },
                this.state.show ? React.createElement(
                    'div',
                    { className: prefixClass('dialog-overlay') },
                    React.createElement(
                        'div',
                        { className: prefixClass('dialog-overlay-inner') },
                        React.createElement(
                            'div',
                            { className: classnames(classSet) },
                            title ? React.createElement(
                                'h1',
                                { className: prefixClass('dialog-title') },
                                title
                            ) : '',
                            React.createElement(
                                'div',
                                { className: prefixClass('dialog-content') },
                                displayContent
                            ),
                            React.createElement(
                                'div',
                                { className: prefixClass('dialog-operation TE FBH') },
                                btn
                            )
                        )
                    )
                ) : null
            );
        }
    }]);

    return Dialog;
}(React.Component);

Dialog.defaultProps = {
    title: '',
    content: '',
    onConfirm: null,
    onCancel: null,
    type: 'alert',
    show: true,
    locale: 'zh_CN',
    buttons: [{
        content: 'ok',
        callback: function callback() {},

        primary: true
    }]
};

// http://facebook.github.io/react/docs/reusable-components.html
Dialog.propTypes = {
    title: React.PropTypes.string,
    content: React.PropTypes.string,
    onConfirm: React.PropTypes.func,
    onCancel: React.PropTypes.func,
    type: React.PropTypes.string,
    buttons: React.PropTypes.array,
    show: React.PropTypes.bool,
    locale: React.PropTypes.string
};

var WRAPPER_ID = '__TingleGlobalDialog__';
var doc = document;

Dialog.global = null;

var show = function show(options) {
    if (!Dialog.global) {
        var wrapper = doc.getElementById(WRAPPER_ID);

        var other = _objectWithoutProperties(options, []);

        if (!wrapper) {
            wrapper = doc.createElement('div');
            wrapper.id = WRAPPER_ID;
            doc.body.appendChild(wrapper);
        }

        Dialog.global = ReactDOM.render(React.createElement(Dialog, other), wrapper);
    }
    ;
    Dialog.global._show(options);
};

Dialog.hide = function () {
    Dialog.global && Dialog.global.hide();
};

Dialog.alert = function (options) {
    options.buttons = [{
        content: options.confirmText || i18n(options.locale)('ok'),
        callback: options.onConfirm,
        primary: true
    }];
    show(options);
};

Dialog.confirm = function (options) {
    options.buttons = [{
        content: options.cancelText || i18n(options.locale)('cancel'),
        callback: options.onCancel
    }, {
        content: options.confirmText || i18n(options.locale)('ok'),
        callback: options.onConfirm,
        primary: true
    }];
    show(options);
};

Dialog.displayName = 'Dialog';

module.exports = Dialog;
//# sourceMappingURL=data:application/json;base64,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O0FBU0EsT0FBTyxPQUFQLEdBQWlCLFVBQVUsT0FBVixFQUFtQjtBQUNoQyxZQUFRLE9BQVIsR0FBa0IsQ0FBQztBQUNmLGlCQUFTLFFBQVEsVUFBUixJQUFzQixLQUFLLFFBQVEsTUFBYixFQUFxQixRQUFyQixDQURoQjtBQUVmLGtCQUFVLFFBQVE7QUFGSCxLQUFELEVBR2Y7QUFDQyxpQkFBUyxRQUFRLFdBQVIsSUFBdUIsS0FBSyxRQUFRLE1BQWIsRUFBcUIsSUFBckIsQ0FEakM7QUFFQyxrQkFBVSxRQUFRLFNBRm5CO0FBR0MsaUJBQVM7QUFIVixLQUhlLENBQWxCO0FBUUEsU0FBSyxPQUFMO0FBQ0gsQ0FWRDs7QUFZQSxPQUFPLFdBQVAsR0FBcUIsUUFBckI7O0FBRUEsT0FBTyxPQUFQLEdBQWlCLE1BQWpCIiwiZmlsZSI6IkRpYWxvZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGlhbG9nIENvbXBvbmVudCBmb3IgdGluZ2xlXG4gKiBAYXV0aG9yIG1pbmppZSxjbVxuICpcbiAqIENvcHlyaWdodCAyMDE0LTIwMTYsIFRpbmdsZSBUZWFtLCBBbGludy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKi9cbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKTtcbmNvbnN0IGNsYXNzbmFtZXMgPSByZXF1aXJlKCdjbGFzc25hbWVzJyk7XG5jb25zdCBDb250ZXh0ID0gcmVxdWlyZSgnQGFsaS90aW5nbGUtY29udGV4dCcpO1xuY29uc3QgaTE4bkhlbHBlciA9IHJlcXVpcmUoJ2kxOG4taGVscGVyJyk7XG5jb25zdCBsYW5nID0gcmVxdWlyZSgnLi9pMThuJyk7XG5sZXQgUmVhY3RDU1NUcmFuc2l0aW9uR3JvdXAgPSBSZWFjdC5hZGRvbnMuQ1NTVHJhbnNpdGlvbkdyb3VwO1xuY29uc3QgeyBwcmVmaXhDbGFzcyB9ID0gQ29udGV4dDtcblxuY29uc3QgVFlQRVMgPSBbJ2FsZXJ0JywgJ2NvbmZpcm0nXTtcblxuY29uc3QgRU1QVFlfRlVOQyA9IGZ1bmN0aW9uICgpIHtcbn1cblxuY29uc3QgaTE4biA9IChsb2NhbGUgPSAnemhfQ04nKSA9PiBpMThuSGVscGVyKGxhbmdbbG9jYWxlXSB8fCBsYW5nLnpoX0NOKTtcblxuY2xhc3MgRGlhbG9nIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIGxldCBidXR0b25zID0gW3tcbiAgICAgICAgICAgIGNvbnRlbnQ6IHByb3BzLmNvbmZpcm1UZXh0IHx8IGkxOG4ocHJvcHMubG9jYWxlKSgnb2snKSxcbiAgICAgICAgICAgIGNhbGxiYWNrOiBwcm9wcy5vbkNvbmZpcm0gfHwgRU1QVFlfRlVOQyxcbiAgICAgICAgICAgIHByaW1hcnk6IHRydWVcbiAgICAgICAgfV07XG5cbiAgICAgICAgaWYgKHRoaXMucHJvcHMudHlwZSA9PT0gVFlQRVNbMV0pIHtcbiAgICAgICAgICAgIGJ1dHRvbnMgPSBbe1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMucHJvcHMuY2FuY2VsVGV4dCB8fCBpMThuKHByb3BzLmxvY2FsZSkoJ2NhbmNlbCcpLFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB0aGlzLnByb3BzLm9uQ2FuY2VsIHx8IEVNUFRZX0ZVTkNcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBjb250ZW50OiB0aGlzLnByb3BzLmNvbmZpcm1UZXh0IHx8IGkxOG4ocHJvcHMubG9jYWxlKSgnb2snKSxcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogdGhpcy5wcm9wcy5vbkNvbmZpcm0gfHwgRU1QVFlfRlVOQyxcbiAgICAgICAgICAgICAgICBwcmltYXJ5OiB0cnVlXG4gICAgICAgICAgICB9XTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICB0aXRsZTogcHJvcHMudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBwcm9wcy5jb250ZW50LCAvLyDkuLrlv6vmjbcgQVBJIOaPkOS+m+eahO+8jERpYWxvZyBSZWFjdCDmlrnlvI/kvb/nlKjvvIznm7TmjqXmuLLmn5MgY2hpbGRyZW5cbiAgICAgICAgICAgIGJ1dHRvbnM6IGJ1dHRvbnMsXG4gICAgICAgICAgICBzaG93OiBwcm9wcy5zaG93XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHNob3c6IG5leHRQcm9wcy5zaG93LFxuICAgICAgICAgICAgdGl0bGU6IG5leHRQcm9wcy50aXRsZVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIF9zaG93KG9wdGlvbnMpIHtcbiAgICAgICAgbGV0IHN0YXRlID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgbGV0IHByb3AgPSBvcHRpb25zID8gb3B0aW9ucyA6IHRoaXMucHJvcHM7XG5cbiAgICAgICAgc3RhdGUuc2hvdyA9IHRydWU7XG4gICAgICAgIHN0YXRlLnRpdGxlID0gcHJvcC50aXRsZTtcbiAgICAgICAgc3RhdGUuY29udGVudCA9IHByb3AuY29udGVudDtcbiAgICAgICAgc3RhdGUuYnV0dG9ucyA9IHByb3AuYnV0dG9ucztcblxuICAgICAgICB0aGlzLnNldFN0YXRlKHN0YXRlKTtcbiAgICB9XG5cbiAgICAvLyBkZXByZWNhdGVkXG4gICAgaGlkZSgpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7c2hvdzogZmFsc2V9KTtcbiAgICB9XG5cbiAgICAvLyBkZXByZWNhdGVkXG4gICAgc2hvdygpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7c2hvdzogdHJ1ZX0pO1xuICAgIH1cblxuICAgIGhhbmRsZUNsaWNrKGNhbGxiYWNrKSB7XG4gICAgICAgIGlmIChjYWxsYmFjaygpICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgbGV0IGJ0biA9ICcnO1xuICAgICAgICBsZXQge2NsYXNzTmFtZSwgY2hpbGRyZW4sIC4uLm90aGVyfSA9IHQucHJvcHM7XG4gICAgICAgIGxldCB7dGl0bGUsIGJ1dHRvbnMsIGNvbnRlbnR9ID0gdC5zdGF0ZTtcbiAgICAgICAgbGV0IGNsYXNzU2V0ID0ge1xuICAgICAgICAgICAgW3ByZWZpeENsYXNzKCdkaWFsb2cnKV06IHRydWUsXG4gICAgICAgICAgICBbdC5wcm9wcy5jbGFzc05hbWVdOiAhIXQucHJvcHMuY2xhc3NOYW1lXG4gICAgICAgIH07XG4gICAgICAgIGxldCBidG5zQ291bnQgPSBidXR0b25zLmxlbmd0aDtcblxuICAgICAgICBidG4gPSBidXR0b25zICYmIGJ1dHRvbnMubWFwKGZ1bmN0aW9uIChpdGVtLCBpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGNhbGxiYWNrID0gaXRlbS5jYWxsYmFjayB8fCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXsndERpYWxvZ0J1dHRvbktleScgKyBpfVxuICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NuYW1lcyhwcmVmaXhDbGFzcygnRkIxIGRpYWxvZy1idXR0b24gVEUnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcHJlZml4Q2xhc3MoJ2RpYWxvZy1wcmltYXJ5JyldOiBpdGVtLnByaW1hcnksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW3ByZWZpeENsYXNzKCdkaWFsb2ctc2Vjb25kYXJ5JyldOiAhaXRlbS5wcmltYXJ5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtwcmVmaXhDbGFzcygnZGlhbG9nLWJyYmw1JyldOiBpID09PSAwIHx8IGJ0bnNDb3VudCA9PT0gMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbcHJlZml4Q2xhc3MoJ2RpYWxvZy1icmJyNScpXTogaSA9PT0gMSB8fCBpID09PSBidG5zQ291bnQgLSAxXG4gICAgICAgICAgICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0LmhhbmRsZUNsaWNrLmJpbmQodCwgY2FsbGJhY2spfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtpMThuKHQucHJvcHMubG9jYWxlKShpdGVtLmNvbnRlbnQpfVxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZGlzcGxheUNvbnRlbnQgPSBjaGlsZHJlbjtcbiAgICAgICAgaWYgKGNvbnRlbnQpIHtcbiAgICAgICAgICAgIGRpc3BsYXlDb250ZW50ID0gY29udGVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8UmVhY3RDU1NUcmFuc2l0aW9uR3JvdXBcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uTmFtZT17cHJlZml4Q2xhc3MoJ2RpYWxvZy1mYWRlJyl9XG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbkVudGVyVGltZW91dD17MzAwfSB0cmFuc2l0aW9uTGVhdmVUaW1lb3V0PXszMDB9XG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbkFwcGVhcj17dHJ1ZX0gdHJhbnNpdGlvbkFwcGVhclRpbWVvdXQ9ezMwMH0+XG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnNob3cgP1xuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3ByZWZpeENsYXNzKCdkaWFsb2ctb3ZlcmxheScpfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17cHJlZml4Q2xhc3MoJ2RpYWxvZy1vdmVybGF5LWlubmVyJyl9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3NuYW1lcyhjbGFzc1NldCl9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3RpdGxlID8gPGgxIGNsYXNzTmFtZT17cHJlZml4Q2xhc3MoJ2RpYWxvZy10aXRsZScpfT57dGl0bGV9PC9oMT4gOiAnJ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtwcmVmaXhDbGFzcygnZGlhbG9nLWNvbnRlbnQnKX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2Rpc3BsYXlDb250ZW50fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17cHJlZml4Q2xhc3MoJ2RpYWxvZy1vcGVyYXRpb24gVEUgRkJIJyl9PntidG59PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA8L1JlYWN0Q1NTVHJhbnNpdGlvbkdyb3VwPlxuICAgICAgICApO1xuICAgIH1cbn1cblxuRGlhbG9nLmRlZmF1bHRQcm9wcyA9IHtcbiAgICB0aXRsZTogJycsXG4gICAgY29udGVudDogJycsXG4gICAgb25Db25maXJtOiBudWxsLFxuICAgIG9uQ2FuY2VsOiBudWxsLFxuICAgIHR5cGU6ICdhbGVydCcsXG4gICAgc2hvdzogdHJ1ZSxcbiAgICBsb2NhbGU6ICd6aF9DTicsXG4gICAgYnV0dG9uczogW3tcbiAgICAgICAgY29udGVudDogJ29rJyxcbiAgICAgICAgY2FsbGJhY2soKSB7XG4gICAgICAgIH0sXG4gICAgICAgIHByaW1hcnk6IHRydWVcbiAgICB9XVxufTtcblxuLy8gaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC9kb2NzL3JldXNhYmxlLWNvbXBvbmVudHMuaHRtbFxuRGlhbG9nLnByb3BUeXBlcyA9IHtcbiAgICB0aXRsZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjb250ZW50OiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIG9uQ29uZmlybTogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25DYW5jZWw6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgIHR5cGU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgYnV0dG9uczogUmVhY3QuUHJvcFR5cGVzLmFycmF5LFxuICAgIHNob3c6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIGxvY2FsZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbn07XG5cbnZhciBXUkFQUEVSX0lEID0gJ19fVGluZ2xlR2xvYmFsRGlhbG9nX18nO1xudmFyIGRvYyA9IGRvY3VtZW50O1xuXG5EaWFsb2cuZ2xvYmFsID0gbnVsbDtcblxudmFyIHNob3cgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIGlmICghRGlhbG9nLmdsb2JhbCkge1xuICAgICAgICB2YXIgd3JhcHBlciA9IGRvYy5nZXRFbGVtZW50QnlJZChXUkFQUEVSX0lEKTtcbiAgICAgICAgdmFyIHsuLi5vdGhlcn0gPSBvcHRpb25zO1xuXG4gICAgICAgIGlmICghd3JhcHBlcikge1xuICAgICAgICAgICAgd3JhcHBlciA9IGRvYy5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHdyYXBwZXIuaWQgPSBXUkFQUEVSX0lEO1xuICAgICAgICAgICAgZG9jLmJvZHkuYXBwZW5kQ2hpbGQod3JhcHBlcik7XG4gICAgICAgIH1cblxuICAgICAgICBEaWFsb2cuZ2xvYmFsID0gUmVhY3RET00ucmVuZGVyKDxEaWFsb2cgey4uLm90aGVyfSAgLz4sIHdyYXBwZXIpXG4gICAgfVxuICAgIDtcbiAgICBEaWFsb2cuZ2xvYmFsLl9zaG93KG9wdGlvbnMpO1xufVxuXG5EaWFsb2cuaGlkZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBEaWFsb2cuZ2xvYmFsICYmIERpYWxvZy5nbG9iYWwuaGlkZSgpO1xufVxuXG5EaWFsb2cuYWxlcnQgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG9wdGlvbnMuYnV0dG9ucyA9IFt7XG4gICAgICAgIGNvbnRlbnQ6IG9wdGlvbnMuY29uZmlybVRleHQgfHwgaTE4bihvcHRpb25zLmxvY2FsZSkoJ29rJyksXG4gICAgICAgIGNhbGxiYWNrOiBvcHRpb25zLm9uQ29uZmlybSxcbiAgICAgICAgcHJpbWFyeTogdHJ1ZVxuICAgIH1dO1xuICAgIHNob3cob3B0aW9ucyk7XG59O1xuXG5EaWFsb2cuY29uZmlybSA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgb3B0aW9ucy5idXR0b25zID0gW3tcbiAgICAgICAgY29udGVudDogb3B0aW9ucy5jYW5jZWxUZXh0IHx8IGkxOG4ob3B0aW9ucy5sb2NhbGUpKCdjYW5jZWwnKSxcbiAgICAgICAgY2FsbGJhY2s6IG9wdGlvbnMub25DYW5jZWxcbiAgICB9LCB7XG4gICAgICAgIGNvbnRlbnQ6IG9wdGlvbnMuY29uZmlybVRleHQgfHwgaTE4bihvcHRpb25zLmxvY2FsZSkoJ29rJyksXG4gICAgICAgIGNhbGxiYWNrOiBvcHRpb25zLm9uQ29uZmlybSxcbiAgICAgICAgcHJpbWFyeTogdHJ1ZVxuICAgIH1dO1xuICAgIHNob3cob3B0aW9ucyk7XG59O1xuXG5EaWFsb2cuZGlzcGxheU5hbWUgPSAnRGlhbG9nJztcblxubW9kdWxlLmV4cG9ydHMgPSBEaWFsb2c7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
