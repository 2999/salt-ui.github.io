'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/**
 * SelectField Component for tingle
 * @author caoke.ck
 *
 * Copyright 2014-2016, Tingle Team.
 * All rights reserved.
 */
var React = require('react');
var classnames = require('classnames');
var Context = require('@ali/tingle-context');
var Slot = require('@ali/tingle-slot');
var Icon = require('@ali/tingle-icon');
var Field = require('@ali/tingle-field');

var SelectField = function (_React$Component) {
    _inherits(SelectField, _React$Component);

    function SelectField(props) {
        _classCallCheck(this, SelectField);

        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(SelectField).call(this, props));

        var t = _this;
        var value = props.value;
        t.state = {
            value: [value],
            confirmedValue: [value]
        };
        return _this;
    }

    // 外部变更选中值


    _createClass(SelectField, [{
        key: 'componentWillReceiveProps',
        value: function componentWillReceiveProps(nextProps) {
            var t = this;
            var value = nextProps.value;
            t.setState({
                value: [value],
                confirmedValue: [value]
            });
        }
    }, {
        key: 'handleClick',
        value: function handleClick() {
            var t = this;
            !t.props.readOnly && t.refs.slot.show();
        }
    }, {
        key: 'handleChange',
        value: function handleChange(value) {
            this.setState({
                value: value
            });
        }
    }, {
        key: 'handleConfirm',
        value: function handleConfirm(value) {
            this.props.onSelect(value[0]);
        }
    }, {
        key: 'handleCancel',
        value: function handleCancel() {
            var t = this;
            t.setState({
                value: t.state.confirmedValue
            });
        }
    }, {
        key: 'render',
        value: function render() {
            var t = this;
            return React.createElement(
                Field,
                _extends({}, t.props, { icon: {
                        className: Context.prefixClass('select-field-icon'),
                        name: 'angle-right',
                        width: 26,
                        height: 26,
                        onClick: t.handleClick.bind(t)
                    },
                    className: classnames(Context.prefixClass('select-field'), _defineProperty({}, t.props.className, !!t.props.className)) }),
                React.createElement(
                    'div',
                    { onClick: t.handleClick.bind(t) },
                    !t.state.confirmedValue[0] ? React.createElement(
                        'div',
                        { className: Context.prefixClass('omit select-field-placeholder') },
                        t.props.placeholder
                    ) : '',
                    React.createElement(
                        'div',
                        { className: Context.prefixClass('select-field-value FBH FBAC') },
                        React.createElement(
                            'span',
                            { className: classnames(Context.prefixClass('FB1 omit'), _defineProperty({}, Context.prefixClass('select-field-readonly'), !!t.props.readOnly)) },
                            t.props.formatter(t.state.confirmedValue[0])
                        )
                    )
                ),
                React.createElement(Slot, { ref: 'slot', title: t.props.label, confirmText: t.props.confirmText, cancelText: t.props.cancelText, data: [t.props.options], value: t.state.value, onChange: t.handleChange.bind(t), onCancel: t.handleCancel.bind(t), onConfirm: t.handleConfirm.bind(t) })
            );
        }
    }]);

    return SelectField;
}(React.Component);

SelectField.defaultProps = {
    options: [],
    formatter: function formatter(value) {
        return value ? value.text : '';
    },
    onSelect: function onSelect() {},
    readOnly: false,
    placeholder: ''
};

// http://facebook.github.io/react/docs/reusable-components.html
SelectField.propTypes = {
    className: React.PropTypes.string,
    label: React.PropTypes.string.isRequired,
    options: React.PropTypes.array.isRequired,
    value: React.PropTypes.object,
    formatter: React.PropTypes.func,
    onSelect: React.PropTypes.func,
    readOnly: React.PropTypes.bool,
    placeholder: React.PropTypes.string
};

SelectField.displayName = "SelectField";

module.exports = SelectField;
//# sourceMappingURL=data:application/json;base64,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ZmlsZSI6IlNlbGVjdEZpZWxkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZWxlY3RGaWVsZCBDb21wb25lbnQgZm9yIHRpbmdsZVxuICogQGF1dGhvciBjYW9rZS5ja1xuICpcbiAqIENvcHlyaWdodCAyMDE0LTIwMTYsIFRpbmdsZSBUZWFtLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3QgY2xhc3NuYW1lcyA9IHJlcXVpcmUoJ2NsYXNzbmFtZXMnKTtcbmNvbnN0IENvbnRleHQgPSByZXF1aXJlKCdAYWxpL3RpbmdsZS1jb250ZXh0Jyk7XG5jb25zdCBTbG90ID0gcmVxdWlyZSgnQGFsaS90aW5nbGUtc2xvdCcpO1xuY29uc3QgSWNvbiA9IHJlcXVpcmUoJ0BhbGkvdGluZ2xlLWljb24nKTtcbmNvbnN0IEZpZWxkID0gcmVxdWlyZSgnQGFsaS90aW5nbGUtZmllbGQnKTtcblxuY2xhc3MgU2VsZWN0RmllbGQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuXG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIGxldCB2YWx1ZSA9IHByb3BzLnZhbHVlO1xuICAgICAgICB0LnN0YXRlID0ge1xuICAgICAgICAgICAgdmFsdWU6IFsgdmFsdWUgXSxcbiAgICAgICAgICAgIGNvbmZpcm1lZFZhbHVlOiBbIHZhbHVlIF1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyDlpJbpg6jlj5jmm7TpgInkuK3lgLxcbiAgICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIGxldCB2YWx1ZSA9IG5leHRQcm9wcy52YWx1ZTtcbiAgICAgICAgdC5zZXRTdGF0ZSh7XG4gICAgICAgICAgICB2YWx1ZTogWyB2YWx1ZSBdLFxuICAgICAgICAgICAgY29uZmlybWVkVmFsdWU6IFsgdmFsdWUgXVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBoYW5kbGVDbGljaygpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuICAgICAgICAhdC5wcm9wcy5yZWFkT25seSAmJiB0LnJlZnMuc2xvdC5zaG93KCk7XG4gICAgfVxuXG4gICAgaGFuZGxlQ2hhbmdlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGhhbmRsZUNvbmZpcm0odmFsdWUpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblNlbGVjdCh2YWx1ZVswXSk7XG4gICAgfVxuXG4gICAgaGFuZGxlQ2FuY2VsKCkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIHQuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdmFsdWU6IHQuc3RhdGUuY29uZmlybWVkVmFsdWVcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8RmllbGQgey4uLnQucHJvcHN9IGljb249e3tcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBDb250ZXh0LnByZWZpeENsYXNzKCdzZWxlY3QtZmllbGQtaWNvbicpLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnYW5nbGUtcmlnaHQnLFxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjYsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogMjYsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHQuaGFuZGxlQ2xpY2suYmluZCh0KVxuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKENvbnRleHQucHJlZml4Q2xhc3MoJ3NlbGVjdC1maWVsZCcpLCB7XG4gICAgICAgICAgICAgICAgICAgIFt0LnByb3BzLmNsYXNzTmFtZV06ICEhdC5wcm9wcy5jbGFzc05hbWVcbiAgICAgICAgICAgICAgICB9KX0+XG4gICAgICAgICAgICAgICAgPGRpdiBvbkNsaWNrPXt0LmhhbmRsZUNsaWNrLmJpbmQodCl9PlxuICAgICAgICAgICAgICAgICAgICB7IXQuc3RhdGUuY29uZmlybWVkVmFsdWVbMF0gPyA8ZGl2IGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnb21pdCBzZWxlY3QtZmllbGQtcGxhY2Vob2xkZXInKX0+e3QucHJvcHMucGxhY2Vob2xkZXJ9PC9kaXY+IDogJyd9XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtDb250ZXh0LnByZWZpeENsYXNzKCdzZWxlY3QtZmllbGQtdmFsdWUgRkJIIEZCQUMnKX0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9e2NsYXNzbmFtZXMoQ29udGV4dC5wcmVmaXhDbGFzcygnRkIxIG9taXQnKSwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtDb250ZXh0LnByZWZpeENsYXNzKCdzZWxlY3QtZmllbGQtcmVhZG9ubHknKV06ICEhdC5wcm9wcy5yZWFkT25seVxuICAgICAgICAgICAgICAgICAgICAgICAgfSl9Pnt0LnByb3BzLmZvcm1hdHRlcih0LnN0YXRlLmNvbmZpcm1lZFZhbHVlWzBdKX08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxTbG90IHJlZj1cInNsb3RcIiB0aXRsZT17dC5wcm9wcy5sYWJlbH0gY29uZmlybVRleHQ9e3QucHJvcHMuY29uZmlybVRleHR9IGNhbmNlbFRleHQ9e3QucHJvcHMuY2FuY2VsVGV4dH0gZGF0YT17WyB0LnByb3BzLm9wdGlvbnMgXX0gdmFsdWU9e3Quc3RhdGUudmFsdWV9IG9uQ2hhbmdlPXt0LmhhbmRsZUNoYW5nZS5iaW5kKHQpfSBvbkNhbmNlbD17dC5oYW5kbGVDYW5jZWwuYmluZCh0KX0gb25Db25maXJtPXt0LmhhbmRsZUNvbmZpcm0uYmluZCh0KX0vPlxuICAgICAgICAgICAgPC9GaWVsZD5cbiAgICAgICAgKTtcbiAgICB9XG59XG5cblNlbGVjdEZpZWxkLmRlZmF1bHRQcm9wcyA9IHtcbiAgICBvcHRpb25zOiBbXSxcbiAgICBmb3JtYXR0ZXI6ICh2YWx1ZSkgPT4gdmFsdWUgPyB2YWx1ZS50ZXh0IDogJycsXG4gICAgb25TZWxlY3Q6IGZ1bmN0aW9uKCkge30sXG4gICAgcmVhZE9ubHk6IGZhbHNlLFxuICAgIHBsYWNlaG9sZGVyOiAnJ1xufTtcblxuLy8gaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC9kb2NzL3JldXNhYmxlLWNvbXBvbmVudHMuaHRtbFxuU2VsZWN0RmllbGQucHJvcFR5cGVzID0ge1xuICAgIGNsYXNzTmFtZTogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBsYWJlbDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIG9wdGlvbnM6IFJlYWN0LlByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgIGZvcm1hdHRlcjogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25TZWxlY3Q6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgIHJlYWRPbmx5OiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICBwbGFjZWhvbGRlcjogUmVhY3QuUHJvcFR5cGVzLnN0cmluZ1xufTtcblxuU2VsZWN0RmllbGQuZGlzcGxheU5hbWUgPSBcIlNlbGVjdEZpZWxkXCI7XG5cbm1vZHVsZS5leHBvcnRzID0gU2VsZWN0RmllbGQ7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
