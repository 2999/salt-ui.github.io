'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/**
 * TabBar Component for tingle
 * @author zhouwenjie
 *
 * Copyright 2014-2016, Tingle Team.
 * All rights reserved.
 */
var classnames = require('classnames');
var assign = require('object-assign');

var Context = require('@ali/tingle-context');

var _require = require('@ali/tingle-box'),
    Box = _require.Box;

var Icon = require('@ali/tingle-icon');

var isUrl = function isUrl(str) {
  return (/\/\/.+/g.test(str)
  );
};
var isArray = function isArray(obj) {
  return Object.prototype.toString.call(obj) === '[object Array]';
};

var TabBarItemBadge = function (_React$Component) {
  _inherits(TabBarItemBadge, _React$Component);

  function TabBarItemBadge() {
    _classCallCheck(this, TabBarItemBadge);

    return _possibleConstructorReturn(this, (TabBarItemBadge.__proto__ || Object.getPrototypeOf(TabBarItemBadge)).apply(this, arguments));
  }

  _createClass(TabBarItemBadge, [{
    key: 'render',
    value: function render() {
      var _props = this.props,
          badge = _props.badge,
          badgeStyle = _props.badgeStyle;

      var badgeText = void 0;
      if (badge == null) {
        return null;
      }
      if (/^-?\d+(\.\d*)?|\.\d+$/.test(badge)) {
        badgeText = parseInt(badge, 10);
        if (badgeText > 99) {
          badgeText = '99+';
        }
      }
      return React.createElement(
        'span',
        { style: badgeStyle, className: classnames(Context.prefixClass('tab-bar-item-badge'), {
            'point': !badgeText
          }) },
        badgeText
      );
    }
  }]);

  return TabBarItemBadge;
}(React.Component);

TabBarItemBadge.displayName = 'TabBarItemBadge';
TabBarItemBadge.propTypes = {
  badge: React.PropTypes.oneOfType([React.PropTypes.bool, React.PropTypes.number, React.PropTypes.string]),
  badgeStyle: React.PropTypes.object
};

var TabBarItemIcon = function (_React$Component2) {
  _inherits(TabBarItemIcon, _React$Component2);

  function TabBarItemIcon() {
    _classCallCheck(this, TabBarItemIcon);

    return _possibleConstructorReturn(this, (TabBarItemIcon.__proto__ || Object.getPrototypeOf(TabBarItemIcon)).apply(this, arguments));
  }

  _createClass(TabBarItemIcon, [{
    key: 'getIcon',
    value: function getIcon() {
      var icon = this.props.icon;

      return isArray(icon) ? icon[0] : icon;
    }
  }, {
    key: 'getActiveIcon',
    value: function getActiveIcon() {
      var _props2 = this.props,
          icon = _props2.icon,
          activeIcon = _props2.activeIcon;

      if (activeIcon) {
        return activeIcon;
      }
      return isArray(icon) ? icon[1] : icon;
    }
  }, {
    key: 'renderImgIcon',
    value: function renderImgIcon(icon, title, style) {
      var className = Context.prefixClass('tab-bar-item-img-icon');
      return React.createElement('img', { className: className, style: style, src: icon, alt: title });
    }
  }, {
    key: 'renderTingleIcon',
    value: function renderTingleIcon(icon) {
      var style = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      var className = Context.prefixClass('tab-bar-item-tingle-icon');
      return React.createElement(Icon, { width: 25, height: 25, className: className, style: style, name: icon });
    }
  }, {
    key: 'render',
    value: function render() {
      var _props3 = this.props,
          active = _props3.active,
          title = _props3.title,
          iconStyle = _props3.iconStyle,
          activeIconStyle = _props3.activeIconStyle,
          badge = _props3.badge,
          badgeStyle = _props3.badgeStyle;

      var currentIconStyle = assign({}, iconStyle, active ? activeIconStyle : {});
      var currentIcon = active ? this.getActiveIcon() : this.getIcon();
      if (!currentIcon) {
        return null;
      }
      var iconElem = void 0;
      if (isUrl(currentIcon)) {
        iconElem = this.renderImgIcon(currentIcon, title, currentIconStyle);
      } else {
        iconElem = this.renderTingleIcon(currentIcon, currentIconStyle);
      }
      return React.createElement(
        'div',
        { className: Context.prefixClass('tab-bar-item-icon') },
        React.createElement(TabBarItemBadge, { badge: badge, badgeStyle: badgeStyle }),
        iconElem
      );
    }
  }]);

  return TabBarItemIcon;
}(React.Component);

TabBarItemIcon.displayName = 'TabBarItemIcon';
TabBarItemIcon.propTypes = {
  active: React.PropTypes.bool,
  icon: React.PropTypes.oneOfType([React.PropTypes.string, React.PropTypes.array]),
  activeIcon: React.PropTypes.string,
  iconStyle: React.PropTypes.object,
  activeIconStyle: React.PropTypes.object
};

var TabBarItemTitle = function (_React$Component3) {
  _inherits(TabBarItemTitle, _React$Component3);

  function TabBarItemTitle() {
    _classCallCheck(this, TabBarItemTitle);

    return _possibleConstructorReturn(this, (TabBarItemTitle.__proto__ || Object.getPrototypeOf(TabBarItemTitle)).apply(this, arguments));
  }

  _createClass(TabBarItemTitle, [{
    key: 'render',
    value: function render() {
      var _props4 = this.props,
          active = _props4.active,
          title = _props4.title,
          titleStyle = _props4.titleStyle,
          activeTitleStyle = _props4.activeTitleStyle;

      var currentTitleStyle = active ? activeTitleStyle : titleStyle;
      return React.createElement(
        'span',
        {
          className: Context.prefixClass('tab-bar-item-label'),
          style: currentTitleStyle },
        title
      );
    }
  }]);

  return TabBarItemTitle;
}(React.Component);

TabBarItemTitle.displayName = 'TabBarItemTitle';
TabBarItemTitle.propTypes = {
  active: React.PropTypes.bool,
  title: React.PropTypes.string,
  titleStyle: React.PropTypes.object,
  activeTitleStyle: React.PropTypes.object
};

var TabBarItem = function (_React$Component4) {
  _inherits(TabBarItem, _React$Component4);

  function TabBarItem() {
    _classCallCheck(this, TabBarItem);

    return _possibleConstructorReturn(this, (TabBarItem.__proto__ || Object.getPrototypeOf(TabBarItem)).apply(this, arguments));
  }

  _createClass(TabBarItem, [{
    key: 'render',
    value: function render() {
      var t = this;
      var item = t.props.item;
      var active = t.props.active;
      return React.createElement(
        Box,
        { className: classnames(Context.prefixClass('tab-bar-item'), {
            'active': active
          }), onClick: t.props.onClick, flex: 1
        },
        React.createElement(TabBarItemIcon, _extends({}, item.props, { active: active })),
        React.createElement(TabBarItemTitle, _extends({}, item.props, { active: active }))
      );
    }
  }]);

  return TabBarItem;
}(React.Component);

TabBarItem.displayName = 'TabBarItem';
TabBarItem.propTypes = {
  className: React.PropTypes.string,
  item: React.PropTypes.element,
  titleStyle: React.PropTypes.object,
  activeTitleStyle: React.PropTypes.object,
  iconStyle: React.PropTypes.object,
  activeIconStyle: React.PropTypes.object
};


module.exports = TabBarItem;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRhYkJhckl0ZW0uanMiXSwibmFtZXMiOlsiY2xhc3NuYW1lcyIsInJlcXVpcmUiLCJhc3NpZ24iLCJDb250ZXh0IiwiQm94IiwiSWNvbiIsImlzVXJsIiwic3RyIiwidGVzdCIsImlzQXJyYXkiLCJvYmoiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyIsImNhbGwiLCJUYWJCYXJJdGVtQmFkZ2UiLCJwcm9wcyIsImJhZGdlIiwiYmFkZ2VTdHlsZSIsImJhZGdlVGV4dCIsInBhcnNlSW50IiwicHJlZml4Q2xhc3MiLCJSZWFjdCIsIkNvbXBvbmVudCIsImRpc3BsYXlOYW1lIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwib25lT2ZUeXBlIiwiYm9vbCIsIm51bWJlciIsInN0cmluZyIsIm9iamVjdCIsIlRhYkJhckl0ZW1JY29uIiwiaWNvbiIsImFjdGl2ZUljb24iLCJ0aXRsZSIsInN0eWxlIiwiY2xhc3NOYW1lIiwiYWN0aXZlIiwiaWNvblN0eWxlIiwiYWN0aXZlSWNvblN0eWxlIiwiY3VycmVudEljb25TdHlsZSIsImN1cnJlbnRJY29uIiwiZ2V0QWN0aXZlSWNvbiIsImdldEljb24iLCJpY29uRWxlbSIsInJlbmRlckltZ0ljb24iLCJyZW5kZXJUaW5nbGVJY29uIiwiYXJyYXkiLCJUYWJCYXJJdGVtVGl0bGUiLCJ0aXRsZVN0eWxlIiwiYWN0aXZlVGl0bGVTdHlsZSIsImN1cnJlbnRUaXRsZVN0eWxlIiwiVGFiQmFySXRlbSIsInQiLCJpdGVtIiwib25DbGljayIsImVsZW1lbnQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7OztBQU9BLElBQU1BLGFBQWFDLFFBQVEsWUFBUixDQUFuQjtBQUNBLElBQU1DLFNBQVNELFFBQVEsZUFBUixDQUFmOztBQUVBLElBQU1FLFVBQVVGLFFBQVEscUJBQVIsQ0FBaEI7O2VBQ2NBLFFBQVEsaUJBQVIsQztJQUFQRyxHLFlBQUFBLEc7O0FBQ1AsSUFB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QUlFLDRCQUFDLGNBQUQsZUFBb0JELEtBQUt2QyxLQUF6QixJQUFnQyxRQUFRc0IsTUFBeEMsSUFKRjtBQUtFLDRCQUFDLGVBQUQsZUFBcUJpQixLQUFLdkMsS0FBMUIsSUFBaUMsUUFBUXNCLE1BQXpDO0FBTEYsT0FERjtBQVNEOzs7O0VBeEJzQmhCLE1BQU1DLFM7O0FBQXpCOEIsVSxDQUNHN0IsVyxHQUFjLFk7QUFEakI2QixVLENBRUc1QixTLEdBQVk7QUFDakJZLGFBQVdmLE1BQU1JLFNBQU4sQ0FBZ0JJLE1BRFY7QUFFakJ5QixRQUFNakMsTUFBTUksU0FBTixDQUFnQitCLE9BRkw7QUFHakJQLGNBQVk1QixNQUFNSSxTQUFOLENBQWdCSyxNQUhYO0FBSWpCb0Isb0JBQWtCN0IsTUFBTUksU0FBTixDQUFnQkssTUFKakI7QUFLakJRLGFBQVdqQixNQUFNSSxTQUFOLENBQWdCSyxNQUxWO0FBTWpCUyxtQkFBaUJsQixNQUFNSSxTQUFOLENBQWdCSztBQU5oQixDOzs7QUF5QnJCMkIsT0FBT0MsT0FBUCxHQUFpQk4sVUFBakIiLCJmaWxlIjoiVGFiQmFySXRlbS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGFiQmFyIENvbXBvbmVudCBmb3IgdGluZ2xlXG4gKiBAYXV0aG9yIHpob3V3ZW5qaWVcbiAqXG4gKiBDb3B5cmlnaHQgMjAxNC0yMDE2LCBUaW5nbGUgVGVhbS5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKi9cbmNvbnN0IGNsYXNzbmFtZXMgPSByZXF1aXJlKCdjbGFzc25hbWVzJyk7XG5jb25zdCBhc3NpZ24gPSByZXF1aXJlKCdvYmplY3QtYXNzaWduJyk7XG5cbmNvbnN0IENvbnRleHQgPSByZXF1aXJlKCdAYWxpL3RpbmdsZS1jb250ZXh0Jyk7XG5jb25zdCB7Qm94fSA9IHJlcXVpcmUoJ0BhbGkvdGluZ2xlLWJveCcpO1xuY29uc3QgSWNvbiA9IHJlcXVpcmUoJ0BhbGkvdGluZ2xlLWljb24nKTtcblxuY29uc3QgaXNVcmwgPSAoc3RyKT0+IHtcbiAgcmV0dXJuIC9cXC9cXC8uKy9nLnRlc3Qoc3RyKTtcbn07XG5jb25zdCBpc0FycmF5ID0gKG9iaikgPT4ge1xuICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEFycmF5XSc7XG59O1xuXG5jbGFzcyBUYWJCYXJJdGVtQmFkZ2UgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnVGFiQmFySXRlbUJhZGdlJztcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBiYWRnZTogUmVhY3QuUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgICBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICAgIFJlYWN0LlByb3BUeXBlcy5udW1iZXIsXG4gICAgICBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIF0pLFxuICAgIGJhZGdlU3R5bGU6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgYmFkZ2UsIGJhZGdlU3R5bGUgfSA9IHRoaXMucHJvcHM7XG4gICAgbGV0IGJhZGdlVGV4dDtcbiAgICBpZiAoYmFkZ2UgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmICgvXi0/XFxkKyhcXC5cXGQqKT98XFwuXFxkKyQvLnRlc3QoYmFkZ2UpKSB7XG4gICAgICBiYWRnZVRleHQgPSBwYXJzZUludChiYWRnZSwgMTApO1xuICAgICAgaWYgKGJhZGdlVGV4dCA+IDk5KSB7XG4gICAgICAgIGJhZGdlVGV4dCA9ICc5OSsnO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gPHNwYW4gc3R5bGU9e2JhZGdlU3R5bGV9IGNsYXNzTmFtZT17Y2xhc3NuYW1lcyhDb250ZXh0LnByZWZpeENsYXNzKCd0YWItYmFyLWl0ZW0tYmFkZ2UnKSwge1xuICAgICAgICAgICAgICAgICdwb2ludCc6ICFiYWRnZVRleHRcbiAgICAgICAgICAgIH0pfT57YmFkZ2VUZXh0fTwvc3Bhbj5cbiAgfVxufVxuXG5jbGFzcyBUYWJCYXJJdGVtSWNvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdUYWJCYXJJdGVtSWNvbic7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgYWN0aXZlOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICBpY29uOiBSZWFjdC5Qcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgIFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgICBSZWFjdC5Qcm9wVHlwZXMuYXJyYXksXG4gICAgXSksXG4gICAgYWN0aXZlSWNvbjogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBpY29uU3R5bGU6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgYWN0aXZlSWNvblN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICB9O1xuXG4gIGdldEljb24oKSB7XG4gICAgY29uc3QgeyBpY29uIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiBpc0FycmF5KGljb24pID8gaWNvblswXSA6IGljb25cbiAgfVxuXG4gIGdldEFjdGl2ZUljb24oKSB7XG4gICAgY29uc3QgeyBpY29uLCBhY3RpdmVJY29uIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChhY3RpdmVJY29uKSB7XG4gICAgICByZXR1cm4gYWN0aXZlSWNvbjtcbiAgICB9XG4gICAgcmV0dXJuIGlzQXJyYXkoaWNvbikgPyBpY29uWzFdIDogaWNvbjtcbiAgfVxuXG4gIHJlbmRlckltZ0ljb24oaWNvbiwgdGl0bGUsIHN0eWxlKSB7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gQ29udGV4dC5wcmVmaXhDbGFzcygndGFiLWJhci1pdGVtLWltZy1pY29uJyk7XG4gICAgcmV0dXJuIDxpbWcgY2xhc3NOYW1lPXtjbGFzc05hbWV9IHN0eWxlPXtzdHlsZX0gc3JjPXtpY29ufSBhbHQ9e3RpdGxlfSAvPjtcbiAgfVxuXG4gIHJlbmRlclRpbmdsZUljb24oaWNvbiwgc3R5bGUgPSB7fSkge1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IENvbnRleHQucHJlZml4Q2xhc3MoJ3RhYi1iYXItaXRlbS10aW5nbGUtaWNvbicpO1xuICAgIHJldHVybiA8SWNvbiB3aWR0aD17MjV9IGhlaWdodD17MjV9IGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBzdHlsZT17c3R5bGV9IG5hbWU9e2ljb259IC8+O1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgYWN0aXZlLCB0aXRsZSwgaWNvblN0eWxlLCBhY3RpdmVJY29uU3R5bGUsIGJhZGdlLCBiYWRnZVN0eWxlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGN1cnJlbnRJY29uU3R5bGUgPSBhc3NpZ24oe30sIGljb25TdHlsZSwgYWN0aXZlID8gYWN0aXZlSWNvblN0eWxlIDoge30pO1xuICAgIGNvbnN0IGN1cnJlbnRJY29uID0gYWN0aXZlID8gdGhpcy5nZXRBY3RpdmVJY29uKCkgOiB0aGlzLmdldEljb24oKTtcbiAgICBpZiAoIWN1cnJlbnRJY29uKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgbGV0IGljb25FbGVtO1xuICAgIGlmIChpc1VybChjdXJyZW50SWNvbikpIHtcbiAgICAgIGljb25FbGVtID0gdGhpcy5yZW5kZXJJbWdJY29uKGN1cnJlbnRJY29uLCB0aXRsZSwgY3VycmVudEljb25TdHlsZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGljb25FbGVtID0gdGhpcy5yZW5kZXJUaW5nbGVJY29uKGN1cnJlbnRJY29uLCBjdXJyZW50SWNvblN0eWxlKTtcbiAgICB9XG4gICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPXtDb250ZXh0LnByZWZpeENsYXNzKCd0YWItYmFyLWl0ZW0taWNvbicpfT5cbiAgICAgIDxUYWJCYXJJdGVtQmFkZ2UgYmFkZ2U9e2JhZGdlfSBiYWRnZVN0eWxlPXtiYWRnZVN0eWxlfSAvPlxuICAgICAge2ljb25FbGVtfVxuICAgIDwvZGl2PlxuICB9XG59XG5cbmNsYXNzIFRhYkJhckl0ZW1UaXRsZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdUYWJCYXJJdGVtVGl0bGUnO1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGFjdGl2ZTogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgdGl0bGU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgdGl0bGVTdHlsZTogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgICBhY3RpdmVUaXRsZVN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGFjdGl2ZSwgdGl0bGUsIHRpdGxlU3R5bGUsIGFjdGl2ZVRpdGxlU3R5bGUgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgY3VycmVudFRpdGxlU3R5bGUgPSBhY3RpdmUgPyBhY3RpdmVUaXRsZVN0eWxlIDogdGl0bGVTdHlsZTtcbiAgICByZXR1cm4gPHNwYW5cbiAgICAgIGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygndGFiLWJhci1pdGVtLWxhYmVsJyl9XG4gICAgICBzdHlsZT17Y3VycmVudFRpdGxlU3R5bGV9Pnt0aXRsZX08L3NwYW4+O1xuICB9XG59XG5cbmNsYXNzIFRhYkJhckl0ZW0gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnVGFiQmFySXRlbSc7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgY2xhc3NOYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIGl0ZW06IFJlYWN0LlByb3BUeXBlcy5lbGVtZW50LFxuICAgIHRpdGxlU3R5bGU6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgYWN0aXZlVGl0bGVTdHlsZTogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgICBpY29uU3R5bGU6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgYWN0aXZlSWNvblN0eWxlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB0ID0gdGhpcztcbiAgICBjb25zdCBpdGVtID0gdC5wcm9wcy5pdGVtO1xuICAgIGNvbnN0IGFjdGl2ZSA9IHQucHJvcHMuYWN0aXZlO1xuICAgIHJldHVybiAoXG4gICAgICA8Qm94IGNsYXNzTmFtZT17Y2xhc3NuYW1lcyhDb250ZXh0LnByZWZpeENsYXNzKCd0YWItYmFyLWl0ZW0nKSwge1xuICAgICAgICAgICAgICAgICdhY3RpdmUnOiBhY3RpdmVcbiAgICAgICAgICAgIH0pfSBvbkNsaWNrPXt0LnByb3BzLm9uQ2xpY2t9IGZsZXg9ezF9XG4gICAgICA+XG4gICAgICAgIDxUYWJCYXJJdGVtSWNvbiB7Li4uaXRlbS5wcm9wc30gYWN0aXZlPXthY3RpdmV9IC8+XG4gICAgICAgIDxUYWJCYXJJdGVtVGl0bGUgey4uLml0ZW0ucHJvcHN9IGFjdGl2ZT17YWN0aXZlfSAvPlxuICAgICAgPC9Cb3g+XG4gICAgKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFRhYkJhckl0ZW07XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
