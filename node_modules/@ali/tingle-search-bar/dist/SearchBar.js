'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/**
 * SearchBar Component for tingle
 * @author zhouquan.yezq
 *
 * Copyright 2014-2016, Tingle Team.
 * All rights reserved.
 */
var classnames = require('classnames');
var debounce = require('lodash/debounce');

var Context = require('@ali/tingle-context');
var Icon = require('@ali/tingle-icon');
var locale = require('./locale');
var SearchHistory = require('./SearchHistory');

var addUrlParam = function addUrlParam(name, value) {
    var currentUrl = location.href;
    var reg;
    if (/\?/g.test(currentUrl)) {
        reg = new RegExp(name + '=[-\\w]{4,25}', 'g');
        if (reg.test(currentUrl)) {
            currentUrl = currentUrl.replace(reg, name + "=" + value);
        } else {
            currentUrl += "&" + name + "=" + value;
        }
    } else {
        currentUrl += "?" + name + "=" + value;
    }
    return currentUrl;
};

var SearchBar = function (_React$Component) {
    _inherits(SearchBar, _React$Component);

    function SearchBar(props) {
        _classCallCheck(this, SearchBar);

        var _this = _possibleConstructorReturn(this, (SearchBar.__proto__ || Object.getPrototypeOf(SearchBar)).call(this, props));

        _this.state = {
            isActive: false, // whether in search mode
            keyword: ''
        };
        _this.lastSearch = '';
        _this.listener = _this.exitStatusSearch.bind(_this);
        _this.doDebouceSearch = debounce(_this.doSearch, props.searchDelay);
        return _this;
    }

    _createClass(SearchBar, [{
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            document.body.style.overflow = '';
        }
    }, {
        key: 'onChange',
        value: function onChange(e) {
            var value = e.target.value.trim();
            var t = this;
            this.setState({
                keyword: value
            }, function () {
                if (t.props.instantSearch) {
                    t.doDebouceSearch('input');
                }
            });
            t.props.onChange(value, 'input', e);
        }
    }, {
        key: 'onKeyUp',
        value: function onKeyUp(e) {
            var value = e.target.value.trim();
            if (e.keyCode === 13 && value) {
                this.doSearch('click', value);
                this.refs.input.blur();
            }
        }
    }, {
        key: 'doSearch',
        value: function doSearch(from, keyword) {
            var t = this;
            keyword = keyword || t.state.keyword;
            if (from !== 'input' && t.props.hasHistory) {
                t.refs.history.addItem(keyword);
            }
            if (keyword === t.lastSearch) {
                return;
            }
            t.lastSearch = keyword;
            t.props.onSearch(keyword);
        }
    }, {
        key: 'clearKeyword',
        value: function clearKeyword() {
            var t = this;
            t.setState({
                keyword: ''
            });
            t.refs.input.focus();
            t.props.onChange('', 'clear', null);
        }
    }, {
        key: 'enterSearch',
        value: function enterSearch() {
            var t = this;
            if (t.props.disabled) {
                return;
            }
            t.setState({
                isActive: true
            });
            t.refs.input.focus();
            history.pushState(null, '', addUrlParam('SEARCH_BAR', Date.now()));
            window.addEventListener("popstate", this.listener, false);
            document.body.style.overflow = 'hidden';
            t.props.onEnter();
        }
    }, {
        key: 'exitSearch',
        value: function exitSearch() {
            history.go(-1);
        }
    }, {
        key: 'exitStatusSearch',
        value: function exitStatusSearch() {
            var t = this;
            t.setState({
                isActive: false,
                keyword: ''
            });
            t.refs.input.blur();
            window.removeEventListener("popstate", this.listener, false);
            document.body.style.overflow = '';
            t.props.onExit();
        }
    }, {
        key: 'onHistorySelect',
        value: function onHistorySelect(value) {
            var t = this;
            t.setState({
                keyword: value
            }, function () {
                t.doSearch('history');
            });
        }
    }, {
        key: 'renderHistory',
        value: function renderHistory() {
            var t = this;
            if (!t.props.hasHistory) {
                return null;
            }
            return React.createElement(SearchHistory, { ref: 'history',
                locale: t.props.locale,
                name: t.props.historyName,
                className: classnames({ 'active': !t.state.keyword }),
                onSelect: t.onHistorySelect.bind(t)
            });
        }
    }, {
        key: 'renderResult',
        value: function renderResult() {
            var t = this;
            return React.createElement(
                'div',
                { className: classnames(Context.prefixClass('search-bar-result'), {
                        'active': t.state.keyword
                    }) },
                t.props.children
            );
        }
    }, {
        key: 'render',
        value: function render() {
            var _classnames;

            var t = this;
            var i18n = locale[t.props.locale];
            var placeholder = t.props.placeholder;
            if ((typeof placeholder === 'undefined' ? 'undefined' : _typeof(placeholder)) === 'object' && placeholder !== null) {
                placeholder = placeholder[t.props.locale];
            }
            return React.createElement(
                'div',
                { ref: 'root', className: classnames(Context.prefixClass('search-bar'), (_classnames = {}, _defineProperty(_classnames, t.props.className, !!t.props.className), _defineProperty(_classnames, t.props.locale, !!t.props.locale), _defineProperty(_classnames, 'active', t.state.isActive), _classnames)) },
                React.createElement(
                    'div',
                    { className: classnames(Context.prefixClass('search-bar-wrapper'), _defineProperty({}, t.props.className, !!t.props.className)) },
                    React.createElement(
                        'div',
                        { className: Context.prefixClass('search-bar-box') },
                        t.state.isActive ? null : React.createElement(
                            'div',
                            { className: Context.prefixClass('search-bar-holder-wrapper'),
                                onClick: t.enterSearch.bind(t) },
                            React.createElement(
                                'div',
                                { className: Context.prefixClass('search-bar-holder') },
                                React.createElement(Icon, { name: 'search', className: Context.prefixClass('search-bar-icon-search'),
                                    width: this.props.iconWidth, height: this.props.iconHeight,
                                    fill: this.props.iconColor }),
                                placeholder
                            )
                        ),
                        React.createElement(Icon, { name: 'search', className: Context.prefixClass('search-bar-icon-search'),
                            width: this.props.iconWidth, height: this.props.iconHeight, fill: this.props.iconColor }),
                        React.createElement(
                            'form',
                            { action: 'javascript:void(0)' },
                            React.createElement('input', { ref: 'input', type: 'search',
                                className: Context.prefixClass('search-bar-input'),
                                value: t.state.keyword,
                                onChange: t.onChange.bind(t),
                                onKeyUp: t.onKeyUp.bind(t),
                                placeholder: t.state.isActive ? placeholder : '' })
                        ),
                        React.createElement(Icon, { name: 'cross-round', onClick: t.clearKeyword.bind(t),
                            className: classnames(Context.prefixClass('search-bar-icon-cross'), {
                                'active': t.state.keyword
                            }),
                            width: this.props.iconWidth, height: this.props.iconHeight, fill: this.props.iconColor })
                    ),
                    React.createElement(
                        'span',
                        { className: Context.prefixClass('search-bar-btn'),
                            onClick: t.exitSearch.bind(t)
                        },
                        i18n['cancel']
                    )
                ),
                t.state.isActive ? React.createElement(
                    'div',
                    { className: Context.prefixClass('search-bar-list') },
                    t.renderHistory(),
                    t.renderResult()
                ) : null
            );
        }
    }]);

    return SearchBar;
}(React.Component);

var noop = function noop() {};

SearchBar.defaultProps = {
    iconWidth: 20,
    iconHeight: 20,
    iconColor: "#bcbcbc",
    locale: 'zh_CN',
    placeholder: {
        'zh_CN': '搜索',
        'en_US': 'Search'
    },
    hasHistory: true,
    instantSearch: true, // whether trigger search when  input change
    searchDelay: 350, // debounce time for search action
    disabled: false,
    onChange: noop,
    onSearch: noop,
    onEnter: noop,
    onExit: noop
};

// http://facebook.github.io/react/docs/reusable-components.html
SearchBar.propTypes = {
    locale: React.PropTypes.string,
    placeholder: React.PropTypes.oneOfType([React.PropTypes.string, React.PropTypes.object]),
    hasHistory: React.PropTypes.bool,
    historyName: React.PropTypes.string,
    instantSearch: React.PropTypes.bool,
    searchDelay: React.PropTypes.number,
    onChange: React.PropTypes.func,
    onSearch: React.PropTypes.func,
    onEnter: React.PropTypes.func,
    onExit: React.PropTypes.func,
    disabled: React.PropTypes.bool
};

SearchBar.displayName = 'SearchBar';

module.exports = SearchBar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNlYXJjaEJhci5qcyJdLCJuYW1lcyI6WyJjbGFzc25hbWVzIiwicmVxdWlyZSIsImRlYm91bmNlIiwiQ29udGV4dCIsIkljb24iLCJsb2NhbGUiLCJTZWFyY2hIaXN0b3J5IiwiYWRkVXJsUGFyYW0iLCJuYW1lIiwidmFsdWUiLCJjdXJyZW50VXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVnIiwidGVzdCIsIlJlZ0V4cCIsInJlcGxhY2UiLCJTZWFyY2hCYXIiLCJwcm9wcyIsInN0YXRlIiwiaXNBY3RpdmUiLCJrZXl3b3JkIiwibGFzdFNlYXJjaCIsImxpc3RlbmVyIiwiZXhpdFN0YXR1c1NlYXJjaCIsImJpbmQiLCJkb0RlYm91Y2VTZWFyY2giLCJkb1NlYXJjaCIsInNlYXJjaERlbGF5IiwiZG9jdW1lbnQiLCJib2R5Iiwic3R5bGUiLCJvdmVyZmxvdyIsImUiLCJ0YXJnZXQiLCJ0cmltIiwidCIsInNldFN0YXRlIiwiaW5zdGFudFNlYXJjaCIsIm9uQ2hhbmdlIiwia2V5Q29kZSIsInJlZnMiLCJpbnB1dCIsImJsdXIiLCJmcm9tIiwiaGFzSGlzdG9yeSIsImhpc3RvcnkiLCJhZGRJdGVtIiwib25TZWFyY2giLCJmb2N1cyIsImRpc2FibGVkIiwicHVzaFN0YXRlIiwiRGF0ZSIsIm5vdyIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJvbkVudGVyIiwiZ28iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwib25FeGl0IiwiaGlzdG9yeU5hbWUiLCJvbkhpc3RvcnlTZWxlY3QiLCJwcmVmaXhDbGFzcyIsImNoaWxkcmVuIiwiaTE4biIsInBsYWNlaG9sZGVyIiwiY2xhc3NOYW1lIiwiZW50ZXJTZWFyY2giLCJpY29uV2lkdGgiLCJpY29uSGVpZ2h0IiwiaWNvbkNvbG9yIiwib25LZXlVcCIsImNsZWFyS2V5d29yZCIsImV4aXRTZWFyY2giLCJyZW5kZXJIaXN0b3J5IiwicmVuZGVyUmVzdWx0IiwiUmVhY3QiLCJDb21wb25lbnQiLCJub29wIiwiZGVmYXVsdFByb3BzIiwicHJvcFR5cGVzIiwiUHJvcFR5cGVzIiwic3RyaW5nIiwib25lT2ZUeXBlIiwib2JqZWN0IiwiYm9vbCIsIm51bWJlciIsImZ1bmMiLCJkaXNwbGF5TmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7QUFPQSxJQUFNQSxhQUFhQyxRQUFRLFlBQVIsQ0FBbkI7QUFDQSxJQUFNQyxXQUFXRCxRQUFRLGlCQUFSLENBQWpCOztBQUVBLElBQU1FLFVBQVVGLFFBQVEscUJBQVIsQ0FBaEI7QUFDQSxJQUFNRyxPQUFPSCxRQUFRLGtCQUFSLENBQWI7QUFDQSxJQUFNSSxTQUFTSixRQUFRLFVBQVIsQ0FBZjtBQUNBLElBQU1LLGdCQUFnQkwsUUFBUSxpQkFBUixDQUF0Qjs7QUFFQSxJQUFNTSxjQUFjLFNBQWRBLFdBQWMsQ0FBQ0MsSUFBRCxFQUFPQyxLQUFQLEVBQWlCO0FBQ2pDLFFBQUlDLGFBQWFDLFNBQVNDLElBQTFCO0FBQ0EsUUFBSUMsR0FBSjtBQUNBLFFBQUksTUFBTUMsSUFBTixDQUFXSixVQUFYLENBQUosRUFBNEI7QUFDeEJHLGNBQU0sSUFBSUUsTUFBSixDQUFXUCxPQUFPLGVBQWxCLEVBQW1DLEdBQW5DLENBQU47QUFDQSxZQUFJSyxJQUFJQyxJQUFKLENBQVNKLFVBQVQsQ0FBSixFQUEwQjtBQUN0QkEseUJBQWFBLFdBQVdNLE9BQVgsQ0FBbUJILEdBQW5CLEVBQXdCTCxPQUFPLEdBQVAsR0FBYUMsS0FBckMsQ0FBYjtBQUNILFNBRkQsTUFFTztBQUNIQywwQkFBYyxNQUFNRixJQUFOLEdBQWEsR0FBYixHQUFtQkMsS0FBakM7QUFDSDtBQUNKLEtBUEQsTUFPTztBQUNIQyxzQkFBYyxNQUFNRixJQUFOLEdBQWEsR0FBYixHQUFtQkMsS0FBakM7QUFDSDtBQUNELFdBQU9DLFVBQVA7QUFDSCxDQWREOztJQWdCTU8sUzs7O0FBRUYsdUJBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQSwwSEFDVEEsS0FEUzs7QUFF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O0FBYXJCWCxjQUFXdUMsSUFiVTtBQWNyQjlCLGNBQVc4QixJQWRVO0FBZXJCdEIsYUFBVXNCLElBZlc7QUFnQnJCbkIsWUFBU21CO0FBaEJZLENBQXpCOztBQW1CQTtBQUNBN0QsVUFBVStELFNBQVYsR0FBc0I7QUFDbEIzRSxZQUFRdUUsTUFBTUssU0FBTixDQUFnQkMsTUFETjtBQUVsQmpCLGlCQUFhVyxNQUFNSyxTQUFOLENBQWdCRSxTQUFoQixDQUEwQixDQUNuQ1AsTUFBTUssU0FBTixDQUFnQkMsTUFEbUIsRUFFbkNOLE1BQU1LLFNBQU4sQ0FBZ0JHLE1BRm1CLENBQTFCLENBRks7QUFNbEJ2QyxnQkFBWStCLE1BQU1LLFNBQU4sQ0FBZ0JJLElBTlY7QUFPbEJ6QixpQkFBYWdCLE1BQU1LLFNBQU4sQ0FBZ0JDLE1BUFg7QUFRbEI1QyxtQkFBZXNDLE1BQU1LLFNBQU4sQ0FBZ0JJLElBUmI7QUFTbEJ6RCxpQkFBYWdELE1BQU1LLFNBQU4sQ0FBZ0JLLE1BVFg7QUFVbEIvQyxjQUFVcUMsTUFBTUssU0FBTixDQUFnQk0sSUFWUjtBQVdsQnZDLGNBQVU0QixNQUFNSyxTQUFOLENBQWdCTSxJQVhSO0FBWWxCL0IsYUFBU29CLE1BQU1LLFNBQU4sQ0FBZ0JNLElBWlA7QUFhbEI1QixZQUFRaUIsTUFBTUssU0FBTixDQUFnQk0sSUFiTjtBQWNsQnJDLGNBQVUwQixNQUFNSyxTQUFOLENBQWdCSTtBQWRSLENBQXRCOztBQWlCQXBFLFVBQVV1RSxXQUFWLEdBQXdCLFdBQXhCOztBQUVBQyxPQUFPQyxPQUFQLEdBQWlCekUsU0FBakIiLCJmaWxlIjoiU2VhcmNoQmFyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZWFyY2hCYXIgQ29tcG9uZW50IGZvciB0aW5nbGVcbiAqIEBhdXRob3IgemhvdXF1YW4ueWV6cVxuICpcbiAqIENvcHlyaWdodCAyMDE0LTIwMTYsIFRpbmdsZSBUZWFtLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuY29uc3QgY2xhc3NuYW1lcyA9IHJlcXVpcmUoJ2NsYXNzbmFtZXMnKTtcbmNvbnN0IGRlYm91bmNlID0gcmVxdWlyZSgnbG9kYXNoL2RlYm91bmNlJyk7XG5cbmNvbnN0IENvbnRleHQgPSByZXF1aXJlKCdAYWxpL3RpbmdsZS1jb250ZXh0Jyk7XG5jb25zdCBJY29uID0gcmVxdWlyZSgnQGFsaS90aW5nbGUtaWNvbicpO1xuY29uc3QgbG9jYWxlID0gcmVxdWlyZSgnLi9sb2NhbGUnKTtcbmNvbnN0IFNlYXJjaEhpc3RvcnkgPSByZXF1aXJlKCcuL1NlYXJjaEhpc3RvcnknKTtcblxuY29uc3QgYWRkVXJsUGFyYW0gPSAobmFtZSwgdmFsdWUpID0+IHtcbiAgICB2YXIgY3VycmVudFVybCA9IGxvY2F0aW9uLmhyZWY7XG4gICAgdmFyIHJlZztcbiAgICBpZiAoL1xcPy9nLnRlc3QoY3VycmVudFVybCkpIHtcbiAgICAgICAgcmVnID0gbmV3IFJlZ0V4cChuYW1lICsgJz1bLVxcXFx3XXs0LDI1fScsICdnJyk7XG4gICAgICAgIGlmIChyZWcudGVzdChjdXJyZW50VXJsKSkge1xuICAgICAgICAgICAgY3VycmVudFVybCA9IGN1cnJlbnRVcmwucmVwbGFjZShyZWcsIG5hbWUgKyBcIj1cIiArIHZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGN1cnJlbnRVcmwgKz0gXCImXCIgKyBuYW1lICsgXCI9XCIgKyB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnRVcmwgKz0gXCI/XCIgKyBuYW1lICsgXCI9XCIgKyB2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGN1cnJlbnRVcmxcbn07XG5cbmNsYXNzIFNlYXJjaEJhciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBpc0FjdGl2ZTogZmFsc2UsIC8vIHdoZXRoZXIgaW4gc2VhcmNoIG1vZGVcbiAgICAgICAgICAgIGtleXdvcmQ6ICcnXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubGFzdFNlYXJjaCA9ICcnO1xuICAgICAgICB0aGlzLmxpc3RlbmVyID0gdGhpcy5leGl0U3RhdHVzU2VhcmNoLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuZG9EZWJvdWNlU2VhcmNoID0gZGVib3VuY2UodGhpcy5kb1NlYXJjaCwgcHJvcHMuc2VhcmNoRGVsYXkpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gJyc7XG4gICAgfVxuXG4gICAgb25DaGFuZ2UoZSkge1xuICAgICAgICBsZXQgdmFsdWUgPSBlLnRhcmdldC52YWx1ZS50cmltKCk7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBrZXl3b3JkOiB2YWx1ZVxuICAgICAgICB9LCAoKT0+IHtcbiAgICAgICAgICAgIGlmICh0LnByb3BzLmluc3RhbnRTZWFyY2gpIHtcbiAgICAgICAgICAgICAgICB0LmRvRGVib3VjZVNlYXJjaCgnaW5wdXQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHQucHJvcHMub25DaGFuZ2UodmFsdWUsICdpbnB1dCcsIGUpO1xuICAgIH1cblxuICAgIG9uS2V5VXAoZSkge1xuICAgICAgICBsZXQgdmFsdWUgPSBlLnRhcmdldC52YWx1ZS50cmltKCk7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IDEzICYmIHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLmRvU2VhcmNoKCdjbGljaycsIHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMucmVmcy5pbnB1dC5ibHVyKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkb1NlYXJjaChmcm9tLCBrZXl3b3JkKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAga2V5d29yZCA9IGtleXdvcmQgfHwgdC5zdGF0ZS5rZXl3b3JkO1xuICAgICAgICBpZiAoZnJvbSAhPT0gJ2lucHV0JyAmJiB0LnByb3BzLmhhc0hpc3RvcnkpIHtcbiAgICAgICAgICAgIHQucmVmcy5oaXN0b3J5LmFkZEl0ZW0oa2V5d29yZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleXdvcmQgPT09IHQubGFzdFNlYXJjaCkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgdC5sYXN0U2VhcmNoID0ga2V5d29yZDtcbiAgICAgICAgdC5wcm9wcy5vblNlYXJjaChrZXl3b3JkKTtcbiAgICB9XG5cbiAgICBjbGVhcktleXdvcmQoKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgdC5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBrZXl3b3JkOiAnJ1xuICAgICAgICB9KTtcbiAgICAgICAgdC5yZWZzLmlucHV0LmZvY3VzKCk7XG4gICAgICAgIHQucHJvcHMub25DaGFuZ2UoJycsICdjbGVhcicsIG51bGwpO1xuICAgIH1cblxuICAgIGVudGVyU2VhcmNoKCkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIGlmICh0LnByb3BzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICB0LnNldFN0YXRlKHtcbiAgICAgICAgICAgIGlzQWN0aXZlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0LnJlZnMuaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgJycsIGFkZFVybFBhcmFtKCdTRUFSQ0hfQkFSJywgRGF0ZS5ub3coKSkpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBvcHN0YXRlXCIsIHRoaXMubGlzdGVuZXIsIGZhbHNlKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xuICAgICAgICB0LnByb3BzLm9uRW50ZXIoKTtcbiAgICB9XG5cbiAgICBleGl0U2VhcmNoKCkge1xuICAgICAgICBoaXN0b3J5LmdvKC0xKVxuICAgIH1cblxuICAgIGV4aXRTdGF0dXNTZWFyY2goKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgdC5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgICBrZXl3b3JkOiAnJ1xuICAgICAgICB9KTtcbiAgICAgICAgdC5yZWZzLmlucHV0LmJsdXIoKTtcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJwb3BzdGF0ZVwiLCB0aGlzLmxpc3RlbmVyLCBmYWxzZSk7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgICAgdC5wcm9wcy5vbkV4aXQoKTtcbiAgICB9XG5cbiAgICBvbkhpc3RvcnlTZWxlY3QodmFsdWUpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuICAgICAgICB0LnNldFN0YXRlKHtcbiAgICAgICAgICAgIGtleXdvcmQ6IHZhbHVlXG4gICAgICAgIH0sICgpPT4ge1xuICAgICAgICAgICAgdC5kb1NlYXJjaCgnaGlzdG9yeScpXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlbmRlckhpc3RvcnkoKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgaWYgKCF0LnByb3BzLmhhc0hpc3RvcnkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDxTZWFyY2hIaXN0b3J5IHJlZj1cImhpc3RvcnlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxlPXt0LnByb3BzLmxvY2FsZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9e3QucHJvcHMuaGlzdG9yeU5hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzbmFtZXMoeydhY3RpdmUnOiAhdC5zdGF0ZS5rZXl3b3JkfSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdD17dC5vbkhpc3RvcnlTZWxlY3QuYmluZCh0KX1cbiAgICAgICAgLz5cbiAgICB9XG5cbiAgICByZW5kZXJSZXN1bHQoKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPXtjbGFzc25hbWVzKENvbnRleHQucHJlZml4Q2xhc3MoJ3NlYXJjaC1iYXItcmVzdWx0JyksIHtcbiAgICAgICAgICAgICdhY3RpdmUnOiB0LnN0YXRlLmtleXdvcmRcbiAgICAgICAgfSl9Pnt0LnByb3BzLmNoaWxkcmVufTwvZGl2PlxuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuICAgICAgICBsZXQgaTE4biA9IGxvY2FsZVt0LnByb3BzLmxvY2FsZV07XG4gICAgICAgIGxldCBwbGFjZWhvbGRlciA9IHQucHJvcHMucGxhY2Vob2xkZXI7XG4gICAgICAgIGlmICh0eXBlb2YgcGxhY2Vob2xkZXIgPT09ICdvYmplY3QnICYmIHBsYWNlaG9sZGVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICBwbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyW3QucHJvcHMubG9jYWxlXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gPGRpdiByZWY9J3Jvb3QnIGNsYXNzTmFtZT17Y2xhc3NuYW1lcyhDb250ZXh0LnByZWZpeENsYXNzKCdzZWFyY2gtYmFyJyksIHtcbiAgICAgICAgICAgIFt0LnByb3BzLmNsYXNzTmFtZV06ICEhdC5wcm9wcy5jbGFzc05hbWUsXG4gICAgICAgICAgICBbdC5wcm9wcy5sb2NhbGVdOiAhIXQucHJvcHMubG9jYWxlLFxuICAgICAgICAgICAgJ2FjdGl2ZSc6IHQuc3RhdGUuaXNBY3RpdmVcbiAgICAgICAgfSl9PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzbmFtZXMoQ29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci13cmFwcGVyJyksIHtcbiAgICAgICAgICAgICAgICBbdC5wcm9wcy5jbGFzc05hbWVdOiAhIXQucHJvcHMuY2xhc3NOYW1lXG4gICAgICAgICAgICB9KX0+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e0NvbnRleHQucHJlZml4Q2xhc3MoJ3NlYXJjaC1iYXItYm94Jyl9PlxuICAgICAgICAgICAgICAgICAgICB7dC5zdGF0ZS5pc0FjdGl2ZSA/IG51bGwgOlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e0NvbnRleHQucHJlZml4Q2xhc3MoJ3NlYXJjaC1iYXItaG9sZGVyLXdyYXBwZXInKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dC5lbnRlclNlYXJjaC5iaW5kKHQpfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1ob2xkZXInKX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxJY29uIG5hbWU9XCJzZWFyY2hcIiBjbGFzc05hbWU9e0NvbnRleHQucHJlZml4Q2xhc3MoJ3NlYXJjaC1iYXItaWNvbi1zZWFyY2gnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg9e3RoaXMucHJvcHMuaWNvbldpZHRofSBoZWlnaHQ9e3RoaXMucHJvcHMuaWNvbkhlaWdodH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbD17dGhpcy5wcm9wcy5pY29uQ29sb3J9Lz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3BsYWNlaG9sZGVyfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+IH1cbiAgICAgICAgICAgICAgICAgICAgPEljb24gbmFtZT1cInNlYXJjaFwiIGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1pY29uLXNlYXJjaCcpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aD17dGhpcy5wcm9wcy5pY29uV2lkdGh9IGhlaWdodD17dGhpcy5wcm9wcy5pY29uSGVpZ2h0fSBmaWxsPXt0aGlzLnByb3BzLmljb25Db2xvcn0vPlxuICAgICAgICAgICAgICAgICAgICA8Zm9ybSBhY3Rpb249XCJqYXZhc2NyaXB0OnZvaWQoMClcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCByZWY9XCJpbnB1dFwiIHR5cGU9XCJzZWFyY2hcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1pbnB1dCcpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXt0LnN0YXRlLmtleXdvcmR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3Qub25DaGFuZ2UuYmluZCh0KX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbktleVVwPXt0Lm9uS2V5VXAuYmluZCh0KX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj17dC5zdGF0ZS5pc0FjdGl2ZSA/IHBsYWNlaG9sZGVyIDogJyd9Lz5cbiAgICAgICAgICAgICAgICAgICAgPC9mb3JtPlxuICAgICAgICAgICAgICAgICAgICA8SWNvbiBuYW1lPVwiY3Jvc3Mtcm91bmRcIiBvbkNsaWNrPXt0LmNsZWFyS2V5d29yZC5iaW5kKHQpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzbmFtZXMoQ29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1pY29uLWNyb3NzJyksIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FjdGl2ZSc6IHQuc3RhdGUua2V5d29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aD17dGhpcy5wcm9wcy5pY29uV2lkdGh9IGhlaWdodD17dGhpcy5wcm9wcy5pY29uSGVpZ2h0fSBmaWxsPXt0aGlzLnByb3BzLmljb25Db2xvcn0vPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1idG4nKX1cbiAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0LmV4aXRTZWFyY2guYmluZCh0KX1cbiAgICAgICAgICAgICAgICA+e2kxOG5bJ2NhbmNlbCddfTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAge3Quc3RhdGUuaXNBY3RpdmUgP1xuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtDb250ZXh0LnByZWZpeENsYXNzKCdzZWFyY2gtYmFyLWxpc3QnKX0+XG4gICAgICAgICAgICAgICAgICAgIHt0LnJlbmRlckhpc3RvcnkoKX1cbiAgICAgICAgICAgICAgICAgICAge3QucmVuZGVyUmVzdWx0KCl9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgOiBudWxsfVxuICAgICAgICA8L2Rpdj47XG4gICAgfVxufVxuXG5jb25zdCBub29wID0gKCkgPT4ge307XG5cblNlYXJjaEJhci5kZWZhdWx0UHJvcHMgPSB7XG4gICAgaWNvbldpZHRoOiAyMCxcbiAgICBpY29uSGVpZ2h0OiAyMCxcbiAgICBpY29uQ29sb3I6IFwiI2JjYmNiY1wiLFxuICAgIGxvY2FsZTogJ3poX0NOJyxcbiAgICBwbGFjZWhvbGRlcjoge1xuICAgICAgICAnemhfQ04nOiAn5pCc57SiJyxcbiAgICAgICAgJ2VuX1VTJzogJ1NlYXJjaCdcbiAgICB9LFxuICAgIGhhc0hpc3Rvcnk6IHRydWUsXG4gICAgaW5zdGFudFNlYXJjaDogdHJ1ZSwgLy8gd2hldGhlciB0cmlnZ2VyIHNlYXJjaCB3aGVuICBpbnB1dCBjaGFuZ2VcbiAgICBzZWFyY2hEZWxheTogMzUwLCAvLyBkZWJvdW5jZSB0aW1lIGZvciBzZWFyY2ggYWN0aW9uXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIG9uQ2hhbmdlOiAgbm9vcCxcbiAgICBvblNlYXJjaDogIG5vb3AsXG4gICAgb25FbnRlcjogIG5vb3AsXG4gICAgb25FeGl0OiAgbm9vcCxcbn07XG5cbi8vIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QvZG9jcy9yZXVzYWJsZS1jb21wb25lbnRzLmh0bWxcblNlYXJjaEJhci5wcm9wVHlwZXMgPSB7XG4gICAgbG9jYWxlOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIHBsYWNlaG9sZGVyOiBSZWFjdC5Qcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgICAgUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgUmVhY3QuUHJvcFR5cGVzLm9iamVjdFxuICAgIF0pLFxuICAgIGhhc0hpc3Rvcnk6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIGhpc3RvcnlOYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIGluc3RhbnRTZWFyY2g6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIHNlYXJjaERlbGF5OiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyLFxuICAgIG9uQ2hhbmdlOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICBvblNlYXJjaDogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25FbnRlcjogUmVhY3QuUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25FeGl0OiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICBkaXNhYmxlZDogUmVhY3QuUHJvcFR5cGVzLmJvb2xcbn07XG5cblNlYXJjaEJhci5kaXNwbGF5TmFtZSA9ICdTZWFyY2hCYXInO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNlYXJjaEJhcjtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
