'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/**
 * SearchHistory Component for tingle
 * @author zhouquan.yezq
 *
 * Copyright 2014-2016, Tingle Team.
 * All rights reserved.
 */
var classnames = require('classnames');
var debounce = require('lodash/debounce');

var Context = require('@ali/tingle-context');
var locale = require('./locale');

var Storage = {

    _toJSON: function _toJSON(data) {
        return JSON.stringify(data);
    },

    _fromJSON: function _fromJSON(data) {
        try {
            data = JSON.parse(data);
        } catch (e) {
            data = null;
        }
        return data;
    },

    getItem: function getItem(key) {
        return this._fromJSON(localStorage.getItem(key));
    },

    setItem: function setItem(key, data) {
        return localStorage.setItem(key, this._toJSON(data));
    },

    removeItem: function removeItem(key) {
        localStorage.removeItem(key);
    }
};

var SearchHistory = function (_React$Component) {
    _inherits(SearchHistory, _React$Component);

    function SearchHistory(props) {
        _classCallCheck(this, SearchHistory);

        var _this = _possibleConstructorReturn(this, (SearchHistory.__proto__ || Object.getPrototypeOf(SearchHistory)).call(this, props));

        _this.state = {};
        _this.HISTORY_KEY = props.name;
        return _this;
    }

    _createClass(SearchHistory, [{
        key: 'getHistory',
        value: function getHistory() {
            var list = Storage.getItem(this.HISTORY_KEY) || [];
            return list.slice(0, this.props.displayCount);
        }
    }, {
        key: 'addItem',
        value: function addItem(keyword) {
            // add new history item
            var t = this;
            var list = t.getHistory();
            var index = list.indexOf(keyword);
            if (index !== -1) {
                list.splice(index, 1);
            }
            list.unshift(keyword);
            Storage.setItem(t.HISTORY_KEY, list);
        }
    }, {
        key: 'clearHistory',
        value: function clearHistory() {
            var t = this;
            Storage.removeItem(t.HISTORY_KEY);
            this.setState({
                historyList: []
            });
        }
    }, {
        key: 'onSelect',
        value: function onSelect(keyword) {
            this.props.onSelect && this.props.onSelect(keyword);
        }
    }, {
        key: 'render',
        value: function render() {
            var t = this;
            var list = t.getHistory();
            if (list.length === 0) {
                return null;
            }
            var i18n = locale[t.props.locale];
            return React.createElement(
                'div',
                { className: classnames(Context.prefixClass('search-bar-history'), t.props.className) },
                React.createElement(
                    'div',
                    { className: Context.prefixClass('search-bar-history-header') },
                    i18n['history'],
                    React.createElement(
                        'span',
                        { className: Context.prefixClass('search-bar-history-action'),
                            onClick: t.clearHistory.bind(t) },
                        i18n['clear']
                    )
                ),
                React.createElement(
                    'ul',
                    { className: Context.prefixClass('search-bar-history-list') },
                    list.map(function (item, idx) {
                        return React.createElement(
                            'li',
                            { key: idx },
                            React.createElement(
                                'span',
                                { onClick: t.onSelect.bind(t, item) },
                                item
                            )
                        );
                    })
                )
            );
        }
    }]);

    return SearchHistory;
}(React.Component);

SearchHistory.defaultProps = {
    name: 'SEARCH_BAR_HISTORY',
    keyword: '',
    displayCount: 8
};

// http://facebook.github.io/react/docs/reusable-components.html
SearchHistory.propTypes = {
    onSelect: React.PropTypes.func,
    name: React.PropTypes.string,
    keyword: React.PropTypes.string,
    displayCount: React.PropTypes.number
};

SearchHistory.displayName = 'SearchHistory';

module.exports = SearchHistory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNlYXJjaEhpc3RvcnkuanMiXSwibmFtZXMiOlsiY2xhc3NuYW1lcyIsInJlcXVpcmUiLCJkZWJvdW5jZSIsIkNvbnRleHQiLCJsb2NhbGUiLCJTdG9yYWdlIiwiX3RvSlNPTiIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwiX2Zyb21KU09OIiwicGFyc2UiLCJlIiwiZ2V0SXRlbSIsImtleSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJyZW1vdmVJdGVtIiwiU2VhcmNoSGlzdG9yeSIsInByb3BzIiwic3RhdGUiLCJISVNUT1JZX0tFWSIsIm5hbWUiLCJsaXN0Iiwic2xpY2UiLCJkaXNwbGF5Q291bnQiLCJrZXl3b3JkIiwidCIsImdldEhpc3RvcnkiLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJ1bnNoaWZ0Iiwic2V0U3RhdGUiLCJoaXN0b3J5TGlzdCIsIm9uU2VsZWN0IiwibGVuZ3RoIiwiaTE4biIsInByZWZpeENsYXNzIiwiY2xhc3NOYW1lIiwiY2xlYXJIaXN0b3J5IiwiYmluZCIsIm1hcCIsIml0ZW0iLCJpZHgiLCJSZWFjdCIsIkNvbXBvbmVudCIsImRlZmF1bHRQcm9wcyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsImZ1bmMiLCJzdHJpbmciLCJudW1iZXIiLCJkaXNwbGF5TmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7Ozs7OztBQU9BLElBQU1BLGFBQWFDLFFBQVEsWUFBUixDQUFuQjtBQUNBLElBQU1DLFdBQVdELFFBQVEsaUJBQVIsQ0FBakI7O0FBRUEsSUFBTUUsVUFBVUYsUUFBUSxxQkFBUixDQUFoQjtBQUNBLElBQU1HLFNBQVNILFFBQVEsVUFBUixDQUFmOztBQUVBLElBQU1JLFVBQVU7O0FBRVpDLGFBQVMsaUJBQVVDLElBQVYsRUFBZ0I7QUFDckIsZUFBT0MsS0FBS0MsU0FBTCxDQUFlRixJQUFmLENBQVA7QUFDSCxLQUpXOztBQU1aRyxlQUFXLG1CQUFVSCxJQUFW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QUttQixHQUFMLENBQVMsVUFBQ0MsSUFBRCxFQUFPQyxHQUFQO0FBQUEsK0JBQWU7QUFBQTtBQUFBLDhCQUFJLEtBQUtBLEdBQVQ7QUFBYztBQUFBO0FBQUEsa0NBQU0sU0FBU2pCLEVBQUVRLFFBQUYsQ0FBV00sSUFBWCxDQUFnQmQsQ0FBaEIsRUFBbUJnQixJQUFuQixDQUFmO0FBQTBDQTtBQUExQztBQUFkLHlCQUFmO0FBQUEscUJBQVQ7QUFETDtBQU5HLGFBQVA7QUFVSDs7OztFQXJEdUJFLE1BQU1DLFM7O0FBd0RsQzVCLGNBQWM2QixZQUFkLEdBQTZCO0FBQ3pCekIsVUFBTSxvQkFEbUI7QUFFekJJLGFBQVMsRUFGZ0I7QUFHekJELGtCQUFjO0FBSFcsQ0FBN0I7O0FBTUE7QUFDQVAsY0FBYzhCLFNBQWQsR0FBMEI7QUFDdEJiLGNBQVVVLE1BQU1JLFNBQU4sQ0FBZ0JDLElBREo7QUFFdEI1QixVQUFNdUIsTUFBTUksU0FBTixDQUFnQkUsTUFGQTtBQUd0QnpCLGFBQVNtQixNQUFNSSxTQUFOLENBQWdCRSxNQUhIO0FBSXRCMUIsa0JBQWNvQixNQUFNSSxTQUFOLENBQWdCRztBQUpSLENBQTFCOztBQU9BbEMsY0FBY21DLFdBQWQsR0FBNEIsZUFBNUI7O0FBRUFDLE9BQU9DLE9BQVAsR0FBaUJyQyxhQUFqQiIsImZpbGUiOiJTZWFyY2hIaXN0b3J5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZWFyY2hIaXN0b3J5IENvbXBvbmVudCBmb3IgdGluZ2xlXG4gKiBAYXV0aG9yIHpob3VxdWFuLnllenFcbiAqXG4gKiBDb3B5cmlnaHQgMjAxNC0yMDE2LCBUaW5nbGUgVGVhbS5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKi9cbmNvbnN0IGNsYXNzbmFtZXMgPSByZXF1aXJlKCdjbGFzc25hbWVzJyk7XG5jb25zdCBkZWJvdW5jZSA9IHJlcXVpcmUoJ2xvZGFzaC9kZWJvdW5jZScpO1xuXG5jb25zdCBDb250ZXh0ID0gcmVxdWlyZSgnQGFsaS90aW5nbGUtY29udGV4dCcpO1xuY29uc3QgbG9jYWxlID0gcmVxdWlyZSgnLi9sb2NhbGUnKTtcblxuY29uc3QgU3RvcmFnZSA9IHtcblxuICAgIF90b0pTT046IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhKVxuICAgIH0sXG5cbiAgICBfZnJvbUpTT046IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZGF0YSA9IG51bGxcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YVxuICAgIH0sXG5cbiAgICBnZXRJdGVtOiBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mcm9tSlNPTihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcbiAgICB9LFxuXG4gICAgc2V0SXRlbTogZnVuY3Rpb24gKGtleSwgZGF0YSkge1xuICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB0aGlzLl90b0pTT04oZGF0YSkpO1xuICAgIH0sXG5cbiAgICByZW1vdmVJdGVtOiBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgfVxufTtcblxuY2xhc3MgU2VhcmNoSGlzdG9yeSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7fTtcbiAgICAgICAgdGhpcy5ISVNUT1JZX0tFWSA9IHByb3BzLm5hbWU7XG4gICAgfVxuXG4gICAgZ2V0SGlzdG9yeSgpIHtcbiAgICAgICAgbGV0IGxpc3QgPSBTdG9yYWdlLmdldEl0ZW0odGhpcy5ISVNUT1JZX0tFWSkgfHwgW107XG4gICAgICAgIHJldHVybiBsaXN0LnNsaWNlKDAsIHRoaXMucHJvcHMuZGlzcGxheUNvdW50KVxuICAgIH1cblxuICAgIGFkZEl0ZW0oa2V5d29yZCkgeyAvLyBhZGQgbmV3IGhpc3RvcnkgaXRlbVxuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIGxldCBsaXN0ID0gdC5nZXRIaXN0b3J5KCk7XG4gICAgICAgIGxldCBpbmRleCA9IGxpc3QuaW5kZXhPZihrZXl3b3JkKTtcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgbGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG4gICAgICAgIGxpc3QudW5zaGlmdChrZXl3b3JkKTtcbiAgICAgICAgU3RvcmFnZS5zZXRJdGVtKHQuSElTVE9SWV9LRVksIGxpc3QpO1xuICAgIH1cblxuICAgIGNsZWFySGlzdG9yeSgpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuICAgICAgICBTdG9yYWdlLnJlbW92ZUl0ZW0odC5ISVNUT1JZX0tFWSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgaGlzdG9yeUxpc3Q6IFtdXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uU2VsZWN0KGtleXdvcmQpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblNlbGVjdCAmJiB0aGlzLnByb3BzLm9uU2VsZWN0KGtleXdvcmQpO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuICAgICAgICBsZXQgbGlzdCA9IHQuZ2V0SGlzdG9yeSgpO1xuICAgICAgICBpZiAobGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cbiAgICAgICAgbGV0IGkxOG4gPSBsb2NhbGVbdC5wcm9wcy5sb2NhbGVdO1xuICAgICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9e2NsYXNzbmFtZXMoQ29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1oaXN0b3J5JyksIHQucHJvcHMuY2xhc3NOYW1lKX0+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1oaXN0b3J5LWhlYWRlcicpfT5cbiAgICAgICAgICAgICAgICB7aTE4blsnaGlzdG9yeSddfVxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1oaXN0b3J5LWFjdGlvbicpfVxuICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3QuY2xlYXJIaXN0b3J5LmJpbmQodCl9PntpMThuWydjbGVhciddfTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT17Q29udGV4dC5wcmVmaXhDbGFzcygnc2VhcmNoLWJhci1oaXN0b3J5LWxpc3QnKX0+XG4gICAgICAgICAgICAgICAge2xpc3QubWFwKChpdGVtLCBpZHgpID0+IDxsaSBrZXk9e2lkeH0+PHNwYW4gb25DbGljaz17dC5vblNlbGVjdC5iaW5kKHQsIGl0ZW0pfT57aXRlbX08L3NwYW4+PC9saT4pfVxuICAgICAgICAgICAgPC91bD5cbiAgICAgICAgPC9kaXY+XG4gICAgfVxufVxuXG5TZWFyY2hIaXN0b3J5LmRlZmF1bHRQcm9wcyA9IHtcbiAgICBuYW1lOiAnU0VBUkNIX0JBUl9ISVNUT1JZJyxcbiAgICBrZXl3b3JkOiAnJyxcbiAgICBkaXNwbGF5Q291bnQ6IDhcbn07XG5cbi8vIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QvZG9jcy9yZXVzYWJsZS1jb21wb25lbnRzLmh0bWxcblNlYXJjaEhpc3RvcnkucHJvcFR5cGVzID0ge1xuICAgIG9uU2VsZWN0OiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcbiAgICBuYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIGtleXdvcmQ6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgZGlzcGxheUNvdW50OiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyXG59O1xuXG5TZWFyY2hIaXN0b3J5LmRpc3BsYXlOYW1lID0gJ1NlYXJjaEhpc3RvcnknO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNlYXJjaEhpc3Rvcnk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
