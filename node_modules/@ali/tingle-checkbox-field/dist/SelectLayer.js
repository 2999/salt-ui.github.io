'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/**
 * Copyright 2014-2016, Tingle Team.
 * All rights reserved.
 */

var React = require('react');
var classnames = require('classnames');
var Context = require('@ali/tingle-context');
var Icon = require('@ali/tingle-icon');
var Layer = require('@ali/tingle-layer');
var Scroller = require('@ali/tingle-scroller');

var SelectLayer = function (_React$Component) {
    _inherits(SelectLayer, _React$Component);

    function SelectLayer(props) {
        _classCallCheck(this, SelectLayer);

        var _this = _possibleConstructorReturn(this, (SelectLayer.__proto__ || Object.getPrototypeOf(SelectLayer)).call(this, props));

        var t = _this;

        // 初始状态
        t.state = {
            visible: false
        };
        return _this;
    }

    _createClass(SelectLayer, [{
        key: 'retain',
        value: function retain() {
            var _this2 = this;

            this.checks = [];
            this.props.data.forEach(function (item) {
                _this2.checks.push(item.checked);
            });
        }
    }, {
        key: 'reset',
        value: function reset() {
            var _this3 = this;

            this.props.data.forEach(function (item, i) {
                item.checked = _this3.checks[i];
            });
        }
    }, {
        key: 'show',
        value: function show() {
            var t = this;

            t.retain();
            t.setState({
                visible: true
            }, function () {});
        }
    }, {
        key: 'hide',
        value: function hide() {
            var t = this;

            t.setState({
                visible: false
            }, function () {});
        }
    }, {
        key: 'handleCancel',
        value: function handleCancel() {
            var t = this;
            try {
                t.props.onCancel();
            } finally {
                t.reset();
                t.hide();
            }
        }
    }, {
        key: 'handleClick',
        value: function handleClick(item) {
            if (item.disable) {
                return;
            }
            item.checked = !item.checked;
            this.setState(this.state);
        }
    }, {
        key: 'getData',
        value: function getData() {
            var t = this;
            var data = [];

            this.props.data.forEach(function (item) {
                if (item.checked) {
                    data.push(item);
                }
            });
            return data;
        }
    }, {
        key: 'handleConfirm',
        value: function handleConfirm() {
            var t = this;
            try {
                t.props.onConfirm(t.getData());
            } finally {
                t.hide();
            }
        }
    }, {
        key: 'render',
        value: function render() {
            var t = this;
            var _t$props = t.props,
                className = _t$props.className,
                maskCloseable = _t$props.maskCloseable,
                cancelText = _t$props.cancelText,
                confirmText = _t$props.confirmText;

            var prefixClass = Context.prefixClass;

            return React.createElement(
                Layer,
                {
                    visible: t.state.visible,
                    bottom: 0,
                    onMaskClick: maskCloseable ? t.handleCancel.bind(t) : function () {
                        return maskCloseable;
                    }
                },
                React.createElement(
                    'div',
                    {
                        ref: 'root',
                        className: classnames(prefixClass('select-layer'), _defineProperty({}, className, !!className))
                    },
                    React.createElement(
                        'div',
                        { className: prefixClass('select-layer-header FBH FBAC') },
                        React.createElement(
                            'div',
                            {
                                className: prefixClass('select-layer-cancel'),
                                onClick: t.handleCancel.bind(t)
                            },
                            cancelText
                        ),
                        React.createElement(
                            'div',
                            { className: prefixClass('FB1 FAC select-layer-title') },
                            t.props.title
                        ),
                        React.createElement(
                            'div',
                            {
                                className: classnames(prefixClass('select-layer-confirm')),
                                onClick: t.handleConfirm.bind(t)
                            },
                            confirmText
                        )
                    ),
                    React.createElement(
                        'div',
                        { className: prefixClass('select-layer-body FBH FC9 PR') },
                        React.createElement(
                            Scroller,
                            { ref: 'scroller', key: 'scroller', click: true, className: prefixClass('FB1'), autoRefresh: true, tap: 'iscroll:tap' },
                            React.createElement(
                                'ul',
                                { className: 'select-list' },
                                t.props.data.map(function (m, i) {
                                    var iconClassName = classnames(prefixClass("checkbox-field-icon"), { "checked": m.checked }, { "noChecked": !m.checked }, { "disable": m.disable });
                                    var iconTag = m.checked ? React.createElement(Icon, {
                                        key: 'check-round',
                                        width: 26,
                                        height: 26,
                                        name: 'check-round',
                                        className: iconClassName
                                    }) : React.createElement('div', { className: iconClassName });
                                    return React.createElement(
                                        'li',
                                        {
                                            key: 'item' + i,
                                            onClick: t.handleClick.bind(t, m),
                                            className: classnames(prefixClass('select-layer-item FBH'))
                                        },
                                        iconTag,
                                        React.createElement(
                                            'div',
                                            { className: classnames(prefixClass('FB1'), _defineProperty({}, 'item-text', true)) },
                                            m.text
                                        )
                                    );
                                })
                            )
                        )
                    )
                )
            );
        }
    }]);

    return SelectLayer;
}(React.Component);

SelectLayer.defaultProps = {
    title: '',
    value: [],
    maskCloseable: true,
    data: [],
    className: '',
    confirmText: '完成',
    cancelText: '取消',
    onConfirm: function onConfirm() {},
    onCancel: function onCancel() {}
};

// http://facebook.github.io/react/docs/reusable-components.html
SelectLayer.propTypes = {
    className: React.PropTypes.string,
    title: React.PropTypes.string,
    data: React.PropTypes.array.isRequired,
    value: React.PropTypes.array,
    maskCloseable: React.PropTypes.bool,
    confirmText: React.PropTypes.string,
    cancelText: React.PropTypes.string,
    onConfirm: React.PropTypes.func,
    onCancel: React.PropTypes.func
};

SelectLayer.displayName = 'SelectLayer';

module.exports = SelectLayer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNlbGVjdExheWVyLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwicmVxdWlyZSIsImNsYXNzbmFtZXMiLCJDb250ZXh0IiwiSWNvbiIsIkxheWVyIiwiU2Nyb2xsZXIiLCJTZWxlY3RMYXllciIsInByb3BzIiwidCIsInN0YXRlIiwidmlzaWJsZSIsImNoZWNrcyIsImRhdGEiLCJmb3JFYWNoIiwicHVzaCIsIml0ZW0iLCJjaGVja2VkIiwiaSIsInJldGFpbiIsInNldFN0YXRlIiwib25DYW5jZWwiLCJyZXNldCIsImhpZGUiLCJkaXNhYmxlIiwib25Db25maXJtIiwiZ2V0RGF0YSIsImNsYXNzTmFtZSIsIm1hc2tDbG9zZWFibGUiLCJjYW5jZWxUZXh0IiwiY29uZmlybVRleHQiLCJwcmVmaXhDbGFzcyIsImhhbmRsZUNhbmNlbCIsImJpbmQiLCJ0aXRsZSIsImhhbmRsZUNvbmZpcm0iLCJtYXAiLCJtIiwiaWNvbkNsYXNzTmFtZSIsImljb25UYWciLCJoYW5kbGVDbGljayIsInRleHQiLCJDb21wb25lbnQiLCJkZWZhdWx0UHJvcHMiLCJ2YWx1ZSIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInN0cmluZyIsImFycmF5IiwiaXNSZXF1aXJlZCIsImJvb2wiLCJmdW5jIiwiZGlzcGxheU5hbWUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7Ozs7QUFLQSxJQUFNQSxRQUFRQyxRQUFRLE9BQVIsQ0FBZDtBQUNBLElBQU1DLGFBQWFELFFBQVEsWUFBUixDQUFuQjtBQUNBLElBQU1FLFVBQVVGLFFBQVEscUJBQVIsQ0FBaEI7QUFDQSxJQUFNRyxPQUFPSCxRQUFRLGtCQUFSLENBQWI7QUFDQSxJQUFNSSxRQUFRSixRQUFRLG1CQUFSLENBQWQ7QUFDQSxJQUFNSyxXQUFXTCxRQUFRLHNCQUFSLENBQWpCOztJQUVNTSxXOzs7QUFFRix5QkFBWUMsS0FBWixFQUFtQjtBQUFBOztBQUFBLDhIQUNUQSxLQURTOztBQUdmLFlB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QjlCLGNBQVVyQixNQUFNOEMsU0FBTixDQUFnQks7QUFUTixDQUF4Qjs7QUFZQTVDLFlBQVk2QyxXQUFaLEdBQTBCLGFBQTFCOztBQUVBQyxPQUFPQyxPQUFQLEdBQWlCL0MsV0FBakIiLCJmaWxlIjoiU2VsZWN0TGF5ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAyMDE0LTIwMTYsIFRpbmdsZSBUZWFtLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqL1xuXG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBjbGFzc25hbWVzID0gcmVxdWlyZSgnY2xhc3NuYW1lcycpO1xuY29uc3QgQ29udGV4dCA9IHJlcXVpcmUoJ0BhbGkvdGluZ2xlLWNvbnRleHQnKTtcbmNvbnN0IEljb24gPSByZXF1aXJlKCdAYWxpL3RpbmdsZS1pY29uJyk7XG5jb25zdCBMYXllciA9IHJlcXVpcmUoJ0BhbGkvdGluZ2xlLWxheWVyJyk7XG5jb25zdCBTY3JvbGxlciA9IHJlcXVpcmUoJ0BhbGkvdGluZ2xlLXNjcm9sbGVyJyk7XG5cbmNsYXNzIFNlbGVjdExheWVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcblxuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcblxuICAgICAgICBjb25zdCB0ID0gdGhpcztcblxuICAgICAgICAvLyDliJ3lp4vnirbmgIFcbiAgICAgICAgdC5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHJldGFpbigpIHtcbiAgICAgICAgdGhpcy5jaGVja3MgPSBbXTtcbiAgICAgICAgdGhpcy5wcm9wcy5kYXRhLmZvckVhY2goIGl0ZW0gPT4ge1xuICAgICAgICAgICAgdGhpcy5jaGVja3MucHVzaChpdGVtLmNoZWNrZWQpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLnByb3BzLmRhdGEuZm9yRWFjaCggKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRoaXMuY2hlY2tzW2ldO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzaG93KCkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG5cbiAgICAgICAgdC5yZXRhaW4oKTtcbiAgICAgICAgdC5zZXRTdGF0ZSh7XG4gICAgICAgICAgICB2aXNpYmxlOiB0cnVlXG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaGlkZSgpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuXG4gICAgICAgIHQuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBoYW5kbGVDYW5jZWwoKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHQucHJvcHMub25DYW5jZWwoKTtcbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIHQucmVzZXQoKTtcbiAgICAgICAgICAgIHQuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGFuZGxlQ2xpY2soaXRlbSkge1xuICAgICAgICBpZiAoaXRlbS5kaXNhYmxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5jaGVja2VkID0gIWl0ZW0uY2hlY2tlZDtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh0aGlzLnN0YXRlKTtcbiAgICB9XG5cbiAgICBnZXREYXRhKCkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcztcbiAgICAgICAgY29uc3QgZGF0YSA9IFtdO1xuXG4gICAgICAgIHRoaXMucHJvcHMuZGF0YS5mb3JFYWNoKCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgaWYgKGl0ZW0uY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgIGRhdGEucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIGhhbmRsZUNvbmZpcm0oKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHQucHJvcHMub25Db25maXJtKHQuZ2V0RGF0YSgpKTtcbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIHQuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGNsYXNzTmFtZSwgbWFza0Nsb3NlYWJsZSwgY2FuY2VsVGV4dCwgY29uZmlybVRleHQgfSA9IHQucHJvcHM7XG4gICAgICAgIGNvbnN0IHByZWZpeENsYXNzID0gQ29udGV4dC5wcmVmaXhDbGFzcztcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPExheWVyXG4gICAgICAgICAgICAgICAgdmlzaWJsZT17dC5zdGF0ZS52aXNpYmxlfVxuICAgICAgICAgICAgICAgIGJvdHRvbT17MH1cbiAgICAgICAgICAgICAgICBvbk1hc2tDbGljaz17bWFza0Nsb3NlYWJsZSA/IHQuaGFuZGxlQ2FuY2VsLmJpbmQodCkgOiAoKCkgPT4gbWFza0Nsb3NlYWJsZSl9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgICByZWY9XCJyb290XCJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzbmFtZXMocHJlZml4Q2xhc3MoJ3NlbGVjdC1sYXllcicpLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NsYXNzTmFtZV06ICEhY2xhc3NOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtwcmVmaXhDbGFzcygnc2VsZWN0LWxheWVyLWhlYWRlciBGQkggRkJBQycpfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e3ByZWZpeENsYXNzKCdzZWxlY3QtbGF5ZXItY2FuY2VsJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17dC5oYW5kbGVDYW5jZWwuYmluZCh0KX1cbiAgICAgICAgICAgICAgICAgICAgICAgID57Y2FuY2VsVGV4dH08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtwcmVmaXhDbGFzcygnRkIxIEZBQyBzZWxlY3QtbGF5ZXItdGl0bGUnKX0+e3QucHJvcHMudGl0bGV9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKHByZWZpeENsYXNzKCdzZWxlY3QtbGF5ZXItY29uZmlybScpKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0LmhhbmRsZUNvbmZpcm0uYmluZCh0KX1cbiAgICAgICAgICAgICAgICAgICAgICAgID57Y29uZmlybVRleHR9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17cHJlZml4Q2xhc3MoJ3NlbGVjdC1sYXllci1ib2R5IEZCSCBGQzkgUFInKX0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8U2Nyb2xsZXIgIHJlZj17YHNjcm9sbGVyYH0ga2V5PXtgc2Nyb2xsZXJgfSBjbGljaz17dHJ1ZX0gY2xhc3NOYW1lPXtwcmVmaXhDbGFzcygnRkIxJyl9IGF1dG9SZWZyZXNoPXt0cnVlfSB0YXA9XCJpc2Nyb2xsOnRhcFwiID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPVwic2VsZWN0LWxpc3RcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQucHJvcHMuZGF0YS5tYXAoZnVuY3Rpb24obSwgaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaWNvbkNsYXNzTmFtZSA9IGNsYXNzbmFtZXMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXhDbGFzcyhcImNoZWNrYm94LWZpZWxkLWljb25cIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XCJjaGVja2VkXCI6IG0uY2hlY2tlZH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XCJub0NoZWNrZWRcIjogIW0uY2hlY2tlZH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XCJkaXNhYmxlXCI6IG0uZGlzYWJsZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGljb25UYWcgPSBtLmNoZWNrZWQgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEljb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9XCJjaGVjay1yb3VuZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg9ezI2fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodD17MjZ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1cImNoZWNrLXJvdW5kXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2ljb25DbGFzc05hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPiA6IDxkaXYgY2xhc3NOYW1lPXtpY29uQ2xhc3NOYW1lfSA+PC9kaXY+O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtgaXRlbSR7aX1gfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3QuaGFuZGxlQ2xpY2suYmluZCh0LCBtKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzbmFtZXMocHJlZml4Q2xhc3MoYHNlbGVjdC1sYXllci1pdGVtIEZCSGApKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtpY29uVGFnfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzbmFtZXMocHJlZml4Q2xhc3MoJ0ZCMScpLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWydpdGVtLXRleHQnXTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSl9PnttLnRleHR9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9TY3JvbGxlcj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L0xheWVyPlxuICAgICAgICApXG4gICAgfVxufVxuXG5TZWxlY3RMYXllci5kZWZhdWx0UHJvcHMgPSB7XG4gICAgdGl0bGU6ICcnLFxuICAgIHZhbHVlOiBbXSxcbiAgICBtYXNrQ2xvc2VhYmxlOiB0cnVlLFxuICAgIGRhdGE6W10sXG4gICAgY2xhc3NOYW1lOicnLFxuICAgIGNvbmZpcm1UZXh0OiAn5a6M5oiQJyxcbiAgICBjYW5jZWxUZXh0OiAn5Y+W5raIJyxcbiAgICBvbkNvbmZpcm0oKSB7fSxcbiAgICBvbkNhbmNlbCgpIHt9XG59O1xuXG4vLyBodHRwOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0L2RvY3MvcmV1c2FibGUtY29tcG9uZW50cy5odG1sXG5TZWxlY3RMYXllci5wcm9wVHlwZXMgPSB7XG4gICAgY2xhc3NOYW1lOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIHRpdGxlOiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIGRhdGE6IFJlYWN0LlByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkLFxuICAgIHZhbHVlOiBSZWFjdC5Qcm9wVHlwZXMuYXJyYXksXG4gICAgbWFza0Nsb3NlYWJsZTogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgY29uZmlybVRleHQ6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgY2FuY2VsVGV4dDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBvbkNvbmZpcm06IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgIG9uQ2FuY2VsOiBSZWFjdC5Qcm9wVHlwZXMuZnVuY1xufTtcblxuU2VsZWN0TGF5ZXIuZGlzcGxheU5hbWUgPSAnU2VsZWN0TGF5ZXInO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNlbGVjdExheWVyO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
