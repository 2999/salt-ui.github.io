'use strict';

var HIDDEN_TEXTAREA_STYLE = ['height: 0', 'visibility: hidden', 'overflow: hidden', 'position: absolute', 'z-index: -1000', 'top: 0', 'right: 0'];

var STYLES = ['letter-spacing', 'line-height', 'padding-top', 'padding-bottom', 'padding-left', 'padding-right', 'font-family', 'font-weight', 'font-size', 'text-transform', 'width', 'border-width', 'box-sizing'];

var shadowTextarea = null;

function getStyleInfo(textarea) {
    var computedStyle = window.getComputedStyle(textarea);
    var boxSizing = getPrefixedStyle(computedStyle, 'box-sizing');
    var heightAdjust = 0;
    var padding = getStyleNumber(computedStyle, 'padding-top') + getStyleNumber(computedStyle, 'padding-bottom');
    var border = getStyleNumber(computedStyle, 'border-bottom-width') + getStyleNumber(computedStyle, 'border-top-width');
    if (boxSizing === 'border-box') heightAdjust += border;else if (boxSizing === 'content-box') heightAdjust -= padding;
    return {
        styles: STYLES.map(function (name) {
            return name + ':' + computedStyle.getPropertyValue(name);
        }),
        padding: padding,
        border: border,
        heightAdjust: heightAdjust
    };
}

function getPrefixedStyle(computedStyle, name) {
    var prefix = ['-o-', '-ms-', '-moz-', '-webkit-', ''];
    var tmp = void 0;
    for (var i = prefix.length; i--;) {
        if (tmp = computedStyle.getPropertyValue(prefix[i] + name)) return tmp;
    }return null;
}

function getStyleNumber(computedStyle, name) {
    return parseFloat(computedStyle.getPropertyValue(name));
}

function getSingleRowHeight(textarea) {
    var tmp = textarea.value;
    textarea.value = 'x';
    var result = textarea.scrollHeight;
    textarea.value = tmp;
    return result;
}

module.exports = function calculateHeight(textarea, minRows, maxRows) {
    if (!shadowTextarea) document.body.appendChild(shadowTextarea = document.createElement('textarea'));
    var _styleInfo = getStyleInfo(textarea);
    var styles = _styleInfo.styles;
    var heightAdjust = _styleInfo.heightAdjust,
        padding = _styleInfo.padding,
        border = _styleInfo.border;

    shadowTextarea.setAttribute('style', styles.concat(HIDDEN_TEXTAREA_STYLE).join(';'));
    shadowTextarea.value = textarea.value;
    var height = shadowTextarea.scrollHeight + heightAdjust;
    var minHeight = -Infinity;
    var maxHeight = Infinity;
    var singleRowHeight = getSingleRowHeight(shadowTextarea) - padding;
    if (minRows !== null || maxRows !== null) {
        if (minRows !== null) {
            minHeight = singleRowHeight * minRows + padding + heightAdjust;
            height = Math.max(minHeight, height);
        }
        if (maxRows !== null) {
            maxHeight = singleRowHeight * maxRows + padding + heightAdjust;
            height = Math.min(maxHeight, height);
        }
    }
    //rows:height/singleRowHeight
    return {
        //height,
        //minHeight,
        //maxHeight
        rows: height / singleRowHeight > maxRows ? maxRow : height / singleRowHeight
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbGN1bGF0ZUhlaWdodC5qcyJdLCJuYW1lcyI6WyJISURERU5fVEVYVEFSRUFfU1RZTEUiLCJTVFlMRVMiLCJzaGFkb3dUZXh0YXJlYSIsImdldFN0eWxlSW5mbyIsInRleHRhcmVhIiwiY29tcHV0ZWRTdHlsZSIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJib3hTaXppbmciLCJnZXRQcmVmaXhlZFN0eWxlIiwiaGVpZ2h0QWRqdXN0IiwicGFkZGluZyIsImdldFN0eWxlTnVtYmVyIiwiYm9yZGVyIiwic3R5bGVzIiwibWFwIiwibmFtZSIsImdldFByb3BlcnR5VmFsdWUiLCJwcmVmaXgiLCJ0bXAiLCJpIiwibGVuZ3RoIiwicGFyc2VGbG9hdCIsImdldFNpbmdsZVJvd0hlaWdodCIsInZhbHVlIiwicmVzdWx0Iiwic2Nyb2xsSGVpZ2h0IiwibW9kdWxlIiwiZXhwb3J0cyIsImNhbGN1bGF0ZUhlaWdodCIsIm1pblJvd3MiLCJtYXhSb3dzIiwiZG9jdW1lbnQiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJjcmVhdGVFbGVtZW50IiwiX3N0eWxlSW5mbyIsInNldEF0dHJpYnV0ZSIsImNvbmNhdCIsImpvaW4iLCJoZWlnaHQiLCJtaW5IZWlnaHQiLCJJbmZpbml0eSIsIm1heEhlaWdodCIsInNpbmdsZVJvd0hlaWdodCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJyb3dzIiwibWF4Um93Il0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLHdCQUF3QixDQUMxQixXQUQwQixFQUUxQixvQkFGMEIsRUFHMUIsa0JBSDBCLEVBSTFCLG9CQUowQixFQUsxQixnQkFMMEIsRUFNMUIsUUFOMEIsRUFPMUIsVUFQMEIsQ0FBOUI7O0FBVUEsSUFBTUMsU0FBUyxDQUNYLGdCQURXLEVBRVgsYUFGVyxFQUdYLGFBSFcsRUFJWCxnQkFKVyxFQUtYLGNBTFcsRUFNWCxlQU5XLEVBT1gsYUFQVyxFQVFYLGFBUlcsRUFTWCxXQVRXLEVBVVgsZ0JBVlcsRUFXWCxPQVhXLEVBWVgs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Q0FBQ0MsUUFBakI7QUFDQSxRQUFJQyxZQUFZRCxRQUFoQjtBQUNBLFFBQUlFLGtCQUFrQnJCLG1CQUFtQnJCLGNBQW5CLElBQXFDUyxPQUEzRDtBQUNBLFFBQUltQixZQUFZLElBQVosSUFBb0JDLFlBQVksSUFBcEMsRUFBMEM7QUFDdEMsWUFBSUQsWUFBWSxJQUFoQixFQUFzQjtBQUNsQlcsd0JBQVlHLGtCQUFrQmQsT0FBbEIsR0FBNEJuQixPQUE1QixHQUFzQ0QsWUFBbEQ7QUFDQThCLHFCQUFTSyxLQUFLQyxHQUFMLENBQVNMLFNBQVQsRUFBb0JELE1BQXBCLENBQVQ7QUFDSDtBQUNELFlBQUlULFlBQVksSUFBaEIsRUFBc0I7QUFDbEJZLHdCQUFZQyxrQkFBa0JiLE9BQWxCLEdBQTRCcEIsT0FBNUIsR0FBc0NELFlBQWxEO0FBQ0E4QixxQkFBU0ssS0FBS0UsR0FBTCxDQUFTSixTQUFULEVBQW9CSCxNQUFwQixDQUFUO0FBQ0g7QUFDSjtBQUNEO0FBQ0EsV0FBTztBQUNIO0FBQ0E7QUFDQTtBQUNBUSxjQUFPUixTQUFTSSxlQUFWLEdBQTZCYixPQUE3QixHQUF1Q2tCLE1BQXZDLEdBQWlEVCxTQUFTSTtBQUo3RCxLQUFQO0FBTUgsQ0FoQ0QiLCJmaWxlIjoiY2FsY3VsYXRlSGVpZ2h0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgSElEREVOX1RFWFRBUkVBX1NUWUxFID0gW1xuICAgICdoZWlnaHQ6IDAnLFxuICAgICd2aXNpYmlsaXR5OiBoaWRkZW4nLFxuICAgICdvdmVyZmxvdzogaGlkZGVuJyxcbiAgICAncG9zaXRpb246IGFic29sdXRlJyxcbiAgICAnei1pbmRleDogLTEwMDAnLFxuICAgICd0b3A6IDAnLFxuICAgICdyaWdodDogMCdcbl07XG5cbmNvbnN0IFNUWUxFUyA9IFtcbiAgICAnbGV0dGVyLXNwYWNpbmcnLFxuICAgICdsaW5lLWhlaWdodCcsXG4gICAgJ3BhZGRpbmctdG9wJyxcbiAgICAncGFkZGluZy1ib3R0b20nLFxuICAgICdwYWRkaW5nLWxlZnQnLFxuICAgICdwYWRkaW5nLXJpZ2h0JyxcbiAgICAnZm9udC1mYW1pbHknLFxuICAgICdmb250LXdlaWdodCcsXG4gICAgJ2ZvbnQtc2l6ZScsXG4gICAgJ3RleHQtdHJhbnNmb3JtJyxcbiAgICAnd2lkdGgnLFxuICAgICdib3JkZXItd2lkdGgnLFxuICAgICdib3gtc2l6aW5nJ1xuXTtcblxubGV0IHNoYWRvd1RleHRhcmVhID0gbnVsbDtcblxuZnVuY3Rpb24gZ2V0U3R5bGVJbmZvKHRleHRhcmVhKSB7XG4gICAgbGV0IGNvbXB1dGVkU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0ZXh0YXJlYSk7XG4gICAgbGV0IGJveFNpemluZyA9IGdldFByZWZpeGVkU3R5bGUoY29tcHV0ZWRTdHlsZSwgJ2JveC1zaXppbmcnKTtcbiAgICBsZXQgaGVpZ2h0QWRqdXN0ID0gMDtcbiAgICBsZXQgcGFkZGluZyA9IGdldFN0eWxlTnVtYmVyKGNvbXB1dGVkU3R5bGUsICdwYWRkaW5nLXRvcCcpICsgZ2V0U3R5bGVOdW1iZXIoY29tcHV0ZWRTdHlsZSwgJ3BhZGRpbmctYm90dG9tJyk7XG4gICAgbGV0IGJvcmRlciA9IGdldFN0eWxlTnVtYmVyKGNvbXB1dGVkU3R5bGUsICdib3JkZXItYm90dG9tLXdpZHRoJykgKyBnZXRTdHlsZU51bWJlcihjb21wdXRlZFN0eWxlLCAnYm9yZGVyLXRvcC13aWR0aCcpO1xuICAgIGlmIChib3hTaXppbmcgPT09ICdib3JkZXItYm94JylcbiAgICAgICAgaGVpZ2h0QWRqdXN0ICs9IGJvcmRlcjtcbiAgICBlbHNlIGlmIChib3hTaXppbmcgPT09ICdjb250ZW50LWJveCcpXG4gICAgICAgIGhlaWdodEFkanVzdCAtPSBwYWRkaW5nO1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0eWxlczogU1RZTEVTLm1hcChmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5hbWUgKyAnOicgKyBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUobmFtZSk7XG4gICAgICAgIH0pLFxuICAgICAgICBwYWRkaW5nLFxuICAgICAgICBib3JkZXIsXG4gICAgICAgIGhlaWdodEFkanVzdFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGdldFByZWZpeGVkU3R5bGUoY29tcHV0ZWRTdHlsZSwgbmFtZSkge1xuICAgIGxldCBwcmVmaXggPSBbJy1vLScsICctbXMtJywgJy1tb3otJywgJy13ZWJraXQtJywgJyddO1xuICAgIGxldCB0bXA7XG4gICAgZm9yIChsZXQgaSA9IHByZWZpeC5sZW5ndGg7IGktLTspXG4gICAgICAgIGlmICh0bXAgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUocHJlZml4W2ldICsgbmFtZSkpXG4gICAgICAgICAgICByZXR1cm4gdG1wO1xuICAgIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBnZXRTdHlsZU51bWJlcihjb21wdXRlZFN0eWxlLCBuYW1lKSB7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQoY29tcHV0ZWRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpKTtcbn1cblxuZnVuY3Rpb24gZ2V0U2luZ2xlUm93SGVpZ2h0KHRleHRhcmVhKSB7XG4gICAgbGV0IHRtcCA9IHRleHRhcmVhLnZhbHVlO1xuICAgIHRleHRhcmVhLnZhbHVlID0gJ3gnO1xuICAgIGxldCByZXN1bHQgPSB0ZXh0YXJlYS5zY3JvbGxIZWlnaHQ7XG4gICAgdGV4dGFyZWEudmFsdWUgPSB0bXA7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBjYWxjdWxhdGVIZWlnaHQodGV4dGFyZWEsIG1pblJvd3MsIG1heFJvd3MpIHtcbiAgICBpZiAoIXNoYWRvd1RleHRhcmVhKSBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNoYWRvd1RleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKSk7XG4gICAgbGV0IF9zdHlsZUluZm8gPSBnZXRTdHlsZUluZm8odGV4dGFyZWEpO1xuICAgIGxldCBzdHlsZXMgPSBfc3R5bGVJbmZvLnN0eWxlcztcbiAgICBsZXQge1xuICAgICAgICBoZWlnaHRBZGp1c3QsXG4gICAgICAgIHBhZGRpbmcsXG4gICAgICAgIGJvcmRlclxuICAgIH0gPSBfc3R5bGVJbmZvO1xuICAgIHNoYWRvd1RleHRhcmVhLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBzdHlsZXMuY29uY2F0KEhJRERFTl9URVhUQVJFQV9TVFlMRSkuam9pbignOycpKTtcbiAgICBzaGFkb3dUZXh0YXJlYS52YWx1ZSA9IHRleHRhcmVhLnZhbHVlO1xuICAgIGxldCBoZWlnaHQgPSBzaGFkb3dUZXh0YXJlYS5zY3JvbGxIZWlnaHQgKyBoZWlnaHRBZGp1c3Q7XG4gICAgbGV0IG1pbkhlaWdodCA9IC1JbmZpbml0eTtcbiAgICBsZXQgbWF4SGVpZ2h0ID0gSW5maW5pdHk7XG4gICAgbGV0IHNpbmdsZVJvd0hlaWdodCA9IGdldFNpbmdsZVJvd0hlaWdodChzaGFkb3dUZXh0YXJlYSkgLSBwYWRkaW5nO1xuICAgIGlmIChtaW5Sb3dzICE9PSBudWxsIHx8IG1heFJvd3MgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKG1pblJvd3MgIT09IG51bGwpIHtcbiAgICAgICAgICAgIG1pbkhlaWdodCA9IHNpbmdsZVJvd0hlaWdodCAqIG1pblJvd3MgKyBwYWRkaW5nICsgaGVpZ2h0QWRqdXN0O1xuICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5tYXgobWluSGVpZ2h0LCBoZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXhSb3dzICE9PSBudWxsKSB7XG4gICAgICAgICAgICBtYXhIZWlnaHQgPSBzaW5nbGVSb3dIZWlnaHQgKiBtYXhSb3dzICsgcGFkZGluZyArIGhlaWdodEFkanVzdDtcbiAgICAgICAgICAgIGhlaWdodCA9IE1hdGgubWluKG1heEhlaWdodCwgaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvL3Jvd3M6aGVpZ2h0L3NpbmdsZVJvd0hlaWdodFxuICAgIHJldHVybiB7XG4gICAgICAgIC8vaGVpZ2h0LFxuICAgICAgICAvL21pbkhlaWdodCxcbiAgICAgICAgLy9tYXhIZWlnaHRcbiAgICAgICAgcm93czogKGhlaWdodCAvIHNpbmdsZVJvd0hlaWdodCkgPiBtYXhSb3dzID8gbWF4Um93IDogKGhlaWdodCAvIHNpbmdsZVJvd0hlaWdodClcbiAgICB9O1xufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
