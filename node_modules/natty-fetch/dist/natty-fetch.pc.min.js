/*! natty-fetch.pc.min.js v2.2.3 | MIT License | https://github.com/jias/natty-fetch */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("natty-storage")):"function"==typeof define&&define.amd?define(["natty-storage"],t):e.nattyFetch=t(e.nattyStorage)}(this,function(e){"use strict";function t(e){return e}function r(e){return function(){for(var t=arguments,r=e(t[0],t[1]),o=2,n=t.length;o<n;o++)r=e(r,t[o]);return r}}function o(){return G(9e9*L())}function n(e){return!!e.match(H)}function a(e){return!!e.match(B)}function i(e){return typeof e===V}function s(e){return typeof e===W}function c(e){return typeof e===z}function u(e){return c(e)?e():e}function l(e){return!isNaN(e)&&typeof e===K}function p(e){return typeof e===Q&&e!==C}function f(e){return e!==C&&e===e.window}function d(e){return e!==C&&p(e)&&!f(e)&&Object.getPrototypeOf(e)===Object.prototype}function m(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&t++;return 0===t}function g(e){return M.call(e)===I}function h(e){var t=N.createElement("a");return t.href=e,!X||":"!==t.protocol&&""!==t.protocol?J.hostname!==t.hostname||J.port!==t.port||J.protocol!==t.protocol:""!==t.hostname&&(J.hostname!==t.hostname||J.port!==t.port)}function v(e,t,r){void 0===e&&(e={}),void 0===t&&(t={}),void 0===r&&(r=T);for(var o in t)t.hasOwnProperty(o)&&void 0!==t[o]&&(r===P?g(t[o])?e[o]=[].concat(t[o]):d(t[o])?e[o]=Y({},t[o]):e[o]=t[o]:e[o]=t[o]);return e}function y(e){return!!e&&typeof e.length===K}function j(e,t){var r,o;if(y(e)){for(r=0,o=e.length;r<o;r++)if(t.call(e[r],e[r],r)===!1)return}else for(r in e)if(t.call(e[r],e[r],r)===!1)return}function k(e){var t,r={},o=[];for(t in e)e.hasOwnProperty(t)&&(o.push(t),d(e[t])&&(e[t]=k(e[t])));o.sort();for(var n=0,a=o.length;n<a;n++)r[o[n]]=e[o[n]];return r}function b(e,t,r,o){var n,a=g(t),i=d(t);j(t,function(t,s){n=M.call(t),o&&(s=r?o:o+"["+(i||n==A||n==I?s:"")+"]"),!o&&a?e.add(t.name,t.value):n==I||!r&&n==A?b(e,t,r,s):e.add(s,t)})}function w(e,t){var r=[];return r.add=function(e,t){c(t)&&(t=t()),t==C&&(t=""),r.push(F(e)+"="+F(t))},b(r,e,t),r.join("&").replace(/%20/g,"+")}function S(e){return decodeURIComponent(e.replace(/\+/g," "))}function _(e,t,r,o){r&&(t[i(r)?"_stamp":r]=+new Date);var n=w(t,o);return n?e+(~e.indexOf("?")?"&":"?")+n:e}function q(e){return ee+e}function x(e){e=Y({},de,e);var t=h(e.url),r=new XMLHttpRequest;ce&&t&&(r=new XDomainRequest),r._completed=T,fe(r,e,t),r.open(e.method,_(e.url,Y({},e.useMark?e.mark:{},e.method===re?e.data:{}),e.urlStamp,e.traditional)),ce||(r.withCredentials=i(e.withCredentials)?e.withCredentials:t),pe(r,e);var o,n=e.postDataFormat;return o=e.method===re||e.data===C?C:"FORM"===n?w(e.data,e.traditional):"JSON"===n?JSON.stringify(e.data):e.data,r.send(o),r}function O(e){e=Y({},be,e);var t,r=e.callbackName=e.callbackName.replace(/\{id\}/,o()),n=e.complete;e.complete=function(){ye(t),n()},me[r]=function(t){me[r]=C,e.success(t),e.complete()};var a,i=_(e.url,Y((a={},a[e.flag]=r,a),e.useMark?e.mark:{},e.data),e.urlStamp,e.traditional);return t=ke(i,e),{abort:function(){me[r]=function(){me[r]=C},ye(t)}}}e="default"in e?e["default"]:e;var R="undefined"!=typeof window,N=R?document:null,F=encodeURIComponent,C=null,P=!0,T=!P,U="undefined",E="",M=Object.prototype.toString,I="[object Array]",A="[object Object]",D={dummy:P};D.then=D["catch"]=function(){return D};var J,X=R&&(!!window.ActiveXObject||"ActiveXObject"in window),L=Math.random,G=Math.floor,H=/^(https?:)?\/\//,B=/^[\.\/]/,V="boolean",W="string",z="function",K="number",Q="object";N&&(J=N.createElement("a"),J.href=location.href);var Y=r(v),$=Object.freeze({hasWindow:R,doc:N,escape:F,NULL:C,TRUE:P,FALSE:T,UNDEFINED:U,EMPTY:E,dummyPromise:D,isIE:X,noop:t,redo:r,makeRandom:o,isAbsoluteUrl:n,isRelativeUrl:a,isBoolean:i,isString:s,isFunction:c,runAsFn:u,isNumber:l,isObject:p,isWindow:f,isPlainObject:d,isEmptyObject:m,isArray:g,isCrossDomain:h,extend:Y,likeArray:y,each:j,sortPlainObjectKey:k,serialize:b,param:w,decodeParam:S,appendQueryString:_}),Z=function(e){var t=this;t.promise=new e(function(e,r){t._resolve=e,t._reject=r})};Z.prototype.resolve=function(e){this._resolve.call(this.promise,e)},Z.prototype.reject=function(e){this._reject.call(this.promise,e)};var ee="_",te={on:function(){var e=this,t=arguments;if("string"==typeof t[0]&&"function"==typeof t[1]){var r=q(t[0]);e[r]=e[r]||[],e[r].push(t[1])}else if("object"==typeof t[0]){var o=t[0];for(var n in o)e.on(n,o[n])}},off:function(e,t){var r=this,e=q(e);if(t){var o=r[e];o.splice(o.indexOf(t),1),r[e].length||delete r[e]}else delete r[e]},fire:function(e,t,r){var o=this,n=o[q(e)];if(!n)return"NO_EVENT";for(var a,i=0;a=n[i];i++)a.apply(r||o,[].concat(t))},hasEvent:function(e){return!!this[q(e)]}},re="GET",oe="script",ne="xml",ae="json",ie=U!==typeof XMLHttpRequest?new XMLHttpRequest:{},se=U!==typeof XDomainRequest,ce=R?!("withCredentials"in ie)&&se:null,ue=R?"withCredentials"in ie||se:null,le={"*":"*/*",script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript",json:"application/json, text/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},pe=function(e,t){if(e.setRequestHeader){var r={Accept:le[t.accept]};if(h(t.url)||(r["X-Requested-With"]="XMLHttpRequest"),Y(r,t.header),"POST"===t.method){var o=t.postDataFormat,n="FORM"===o?"application/x-www-form-urlencoded; charset=UTF-8":"JSON"===o?"application/json; charset=UTF-8":C;n!==C&&(r["Content-Type"]=n)}for(var a in r)e.setRequestHeader(a,r[a])}},fe=function(e,r,o){var n=function(){e._completed||(e._completed=!0,r.complete(),e._aborted=null,delete e._aborted)},a=function(){if(!e._completed){var t=e.responseText;switch(r.accept){case ae:try{t=JSON.parse(t)}catch(e){console.warn("The response can NOT be parsed to JSON object.",t)}break;case oe:(0,eval)(t);break;case ne:t=e.responseXML}r.success(t,e),n()}},i=function(){e._completed||(r.error(e.status,e),n())},s=function(){e._completed||(r.abort(),n())};ce&&o?e.onload=a:e.onreadystatechange=function(){e._completed||4==e.readyState&&(e.status>=200&&e.status<300||304===e.status?a():!e._aborted&&i())},e.onerror=i;var c=e.abort;e.abort=function(){e._completed||(e._aborted=!0,X||c.call(e),s())},e.onprogress=e.ontimeout=t},de={url:"",mark:{},useMark:!0,method:re,accept:"*",data:null,header:{},withCredentials:C,urlStamp:!0,success:t,error:t,complete:t,abort:t,log:T,traditional:T,postDataFormat:"FORM"};x.fallback=ce,x.supportCORS=ue;var me=R?window:C,ge=R?document:C,he="script",ve=R?navigator.userAgent.indexOf("MSIE 8.0")>-1:T,ye=function(e){ve&&e.readyState?e.onreadystatechange=C:e.onerror=C,e.parentNode.removeChild(e),e=C},je=C,ke=function(e,t){var r=ge.createElement(he);return r.type="text/javascript",r.src=e,r.async=!0,ve&&r.readyState?r.onreadystatechange=function(){"loaded"===r.readyState&&me[t.callbackName]&&(me[t.callbackName]=C,t.error(),t.complete())}:r.onerror=function(e){me[t.callbackName]=C,t.error(e),t.complete()},je=je||ge.getElementsByTagName("head")[0],je.insertBefore(r,je.firstChild),r},be={url:"",mark:{},useMark:!0,data:{},urlStamp:!0,success:t,error:t,complete:t,log:!1,flag:"callback",callbackName:"jsonp{id}",traditional:T},we=function(e){var r=e.api;r.loop=function(e,o,n){if(void 0===o&&(o=t),void 0===n&&(n=t),!e.duration||!l(e.duration))throw new Error("Illegal `duration` value for `startLoop` method.");var a=C,i=function(){clearTimeout(a),a=C,i.looping=T},s=function(){i.looping=P,a=setTimeout(function(){r(e.data).then(o,n),s()},e.duration)};return r(e.data).then(o,n),s(),i}},Se=function(e){var r=this,o=e.api,n=o.config;o.soon=function(e,a,i){if(void 0===a&&(a=t),void 0===i&&(i=t),!n.ignoreSelfConcurrent||!n.pending){n.overrideSelfConcurrent&&n._lastRequester&&(n._lastRequester.abort(),delete n._lastRequester);var s=r.makeVars(e),c=function(){r.remoteRequest(s,n).then(function(e){a({fromStorage:T,content:e})})["catch"](function(e){i(e)})};o.storageUseable?(s.queryString=m(s.data)?"no-query-string":JSON.stringify(k(s.data)),o.storage.has(s.queryString).then(function(e){e.has&&a({fromStorage:P,content:e.value}),c()})):c()}}};void 0===e&&console.warn("Please install the `natty-storage` script which is required by `natty-fetch`, go on with https://www.npmjs.com/package/natty-storage");var _e=Y,qe=u,xe=n,Oe=a,Re=t,Ne=i,Fe=g,Ce=c,Pe=k,Te=m,Ue=d,Ee=D,Me=s,Ie=C,Ae=P,De=T,Je=E,Xe=R,Le={data:{},didFetch:Re,fit:Re,header:{},ignoreSelfConcurrent:De,jsonp:De,log:De,method:"GET",mock:De,mockUrl:Je,mockUrlPrefix:Je,mockUrlSuffix:Je,process:Re,Promise:Xe?window.Promise:Ie,retry:0,customRequest:Ie,timeout:0,traditional:De,url:Je,urlPrefix:Je,urlStamp:Ae,urlSuffix:Je,withCredentials:Ie,willFetch:Re,storage:!1,plugins:!1,postDataFormat:"FORM"},Ge=_e({},Le),He=function(e,t,r,o){var n=this;n.contextConfig=r,n._path=e;var a=n.config=n.processAPIOptions(t);n.api=function(e){if(e=e||{},a.ignoreSelfConcurrent&&n.api.pending)return Ee;a.overrideSelfConcurrent&&n.api._requester&&n.api.abort();var t=n.makeVars(e);return 0===a.retry?n.request(t,a):n.tryRequest(t,a)},n.api.contextId=o,n.api._path=e,n.api.pending=De,n.api._requester=Ie,n.api.abort=function(){n.api.pending&&n.api._requester&&n.api._requester.abort()},n.api.config=a,n.initStorage();for(var i=Fe(a.plugins)?a.plugins:[],s=0,c=i.length;s<c;s++)Ce(i[s])&&i[s].call(n,n)};He.prototype.makeVars=function(e){var t=this,r=t.config,o={mark:{_api:t._path}};return r.mock&&(o.mark._mock=Ae),"FORM"!==r.postDataFormat&&"JSON"!==r.postDataFormat||(e=_e({},qe(r.data),qe(e))),o.data=e,o},He.prototype.processAPIOptions=function(e){var t=this,r=[].concat(t.contextConfig.plugins||[],e.plugins||[]),o=_e({},t.contextConfig,e,{plugins:r});return o.mock&&(o.mockUrl=t.getFullUrl(o)),o.url=t.getFullUrl(o),Fe(e.jsonp)&&(o.jsonp=Ne(e.jsonp[0])?e.jsonp[0]:De,o.jsonp&&(o.jsonpFlag=e.jsonp[1],o.jsonpCallbackName=e.jsonp[2])),!o.mock&&o.url.match(/\.jsonp(\?.*)?$/)&&(o.jsonp=Ae),o},He.prototype.initStorage=function(){var t=this,r=t.config,o="GET"===r.method||r.jsonp;if(!o&&r.storage===Ae)throw new Error("A `"+r.method+"` request CAN NOT use `storage` which is only for `GET/jsonp` request! Please check the options for `"+t._path+"`");if(r.storage===Ae&&(r.storage={type:"variable"}),t.api.storageUseable=Ue(r.storage)&&("GET"===r.method||r.jsonp)&&e.support[r.storage.type],t.api.storageUseable){if("localStorage"===r.storage.type){if(!r.storage.hasOwnProperty("key")||!r.storage.key)throw new Error("`key` is required when `storage.type` is `localStorage`.")}else r.storage.key=r.storage.key||[t.api.contextId,t._path].join("_");t.api.storage=e(_e({},r.storage,{async:Ae,tag:[r.storage.tag,r.jsonp?"jsonp":r.method,r.url].join("_")}))}},He.prototype.request=function(e,t){var r=this;return r.api.storageUseable?(e.queryString=Te(e.data)?"no-query-string":JSON.stringify(Pe(e.data)),r.api.storage.has(e.queryString).then(function(o){return o.has?o.value:r.remoteRequest(e,t)})):r.remoteRequest(e,t)},He.prototype.getFullUrl=function(e){var t=e.mock?e.mockUrl:e.url;if(!t)return Je;var r=e.mock?"mockUrlPrefix":"urlPrefix",o=e.mock?"mockUrlSuffix":"urlSuffix",n=!e[r]||xe(t)||Oe(t)?Je:e[r],a=e[o]?e[o]:Je;return n+t+a},He.prototype.remoteRequest=function(e,t){var r=this;t.willFetch(e,t,"remote"),r.api.pending=Ae;var o=new Z(t.Promise);return t.customRequest?r.api._requester=t.customRequest(e,t,o):t.jsonp?r.api._requester=r.sendJSONP(e,t,o):r.api._requester=r.sendAjax(e,t,o),0!==t.timeout&&setTimeout(function(){if(r.api.pending&&r.api._requester){r.api.abort();var e={timeout:Ae,message:"Timeout By "+t.timeout+"ms."};o.reject(e),te.fire("g.reject",[e,t]),te.fire(r.api.contextId+".reject",[e,t])}},t.timeout),o.promise},He.prototype.tryRequest=function(e,t){var r=this;return new t.Promise(function(o,n){var a=0,i=function(){e.mark._retryTime=a,r.request(e,t).then(function(e){o(e),te.fire("g.resolve",[e,t],t),te.fire(r.api.contextId+".resolve",[e,t],t)},function(e){a===t.retry?n(e):(a++,i())})};i()})},He.prototype.processResponse=function(e,t,r,o){var n=this;if(t.didFetch(e,t),o=t.fit(o,e),o.success){var a=t.process(o.content,e),i=function(){r.resolve(a),te.fire("g.resolve",[a,t],t),te.fire(n.api.contextId+".resolve",[a,t],t)};n.api.storageUseable?n.api.storage.set(e.queryString,a).then(function(){i()})["catch"](function(){i()}):i()}else{var s=_e({message:"`success` is false, "+n._path},o.error);r.reject(s),te.fire("g.reject",[s,t]),te.fire(n.api.contextId+".reject",[s,t])}},He.prototype.sendAjax=function(e,t,r){var o=this,n=t.mock?t.mockUrl:t.url;return x({traditional:t.traditional,urlStamp:t.urlStamp,mark:e.mark,useMark:t.mark,log:t.log,url:n,method:t.method,data:e.data,header:t.header,withCredentials:t.withCredentials,accept:"json",success:function(n){o.processResponse(e,t,r,n)},error:function a(i){var a={status:i,message:"Error(status "+i+") in request for "+e.mark._api+"("+n+")"};r.reject(a),te.fire("g.reject",[a,t]),te.fire(o.api.contextId+".reject",[a,t])},complete:function(){void 0!==e.retryTime&&e.retryTime!==t.retry||(o.api.pending=De,o.api._requester=Ie)},postDataFormat:t.postDataFormat})},He.prototype.sendJSONP=function(e,t,r){var o=this,n=t.mock?t.mockUrl:t.url;return O({traditional:t.traditional,log:t.log,mark:e.mark,useMark:t.mark,url:n,data:e.data,urlStamp:t.urlStamp,flag:t.jsonpFlag,callbackName:t.jsonpCallbackName,success:function(n){o.processResponse(e,t,r,n)},error:function a(){var a={message:"Not accessable JSONP in request for "+e.mark._api+"("+n+")"};r.reject(a),te.fire("g.reject",[a,t]),te.fire(o.api.contextId+".reject",[a,t])},complete:function(){void 0!==e.retryTime&&e.retryTime!==t.retry||(o.api.pending=De,o.api._requester=Ie)}})};var Be=function(){var t=0;return function(r,o){Me(r)?o=o||{}:(o=r||{},r="c"+t++);var n=e({type:"variable",key:r}),a={};a.api=n.get(),a._contextId=r;var i=[].concat(Ge.plugins||[],o.plugins||[]);return a._config=_e({},Ge,o,{plugins:i}),a.create=function(e,t){var o=2===arguments.length&&Me(e);o||(t=e);for(var i in t)n.set(o?e+"."+i:i,new He(o?e+"."+i:i,qe(t[i]),a._config,r).api);a.api=n.get()},a.on=function(e,t){if(Ce(t))return te.on(a._contextId+"."+e,t),a},a}}(),Ve={};return Ve.create=function(e){return new He("nattyFetch",qe(e),Le,"global").api},_e(Ve,{onlyForModern:!1,version:"2.2.3",_util:$,_event:te,context:Be,ajax:x,jsonp:O,setGlobal:function(e){return Ge=_e({},Le,e),this},getGlobal:function(e){return e?Ge[e]:Ge},on:function(e,t){if(Ce(t))return te.on("g."+e,t),this},plugin:{loop:we,soon:Se}}),Ve.setGlobal(Le),Ve});
//# sourceMappingURL=natty-fetch.pc.min.js.map
