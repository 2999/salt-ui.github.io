{"version":3,"file":null,"sources":["../src/util.js","../src/event.js","../src/ajax.js","../src/jsonp.js","../src/defer.js","../src/plugin.loop.js","../src/plugin.soon.js","../src/natty-fetch.js"],"sourcesContent":["/**\n * src/util.js\n *\n * @license MIT License\n * @author jias (https://github.com/jias/natty-fetch)\n */\nexport const hasWindow = 'undefined' !== typeof window;\nexport const doc = hasWindow ? document : null;\nexport const escape = encodeURIComponent;\nexport const NULL = null;\nexport const TRUE = true;\nexport const FALSE = !TRUE;\nexport const UNDEFINED = 'undefined';\nexport const EMPTY = '';\n\nconst toString = Object.prototype.toString;\nconst ARRAY_TYPE = '[object Array]';\nconst OBJECT_TYPE = '[object Object]';\n\n/**\n * 伪造的`promise`对象\n * NOTE 伪造的promise对象要支持链式调用 保证和`new Promise`返回的对象行为一致\n *      dummyPromise.then().catch().finally()\n */\nexport const dummyPromise = {\n    dummy: TRUE\n};\n\ndummyPromise.then = dummyPromise['catch'] = () => {\n    // NOTE 这里用了剪头函数 不能用`return this`\n    return dummyPromise;\n};\n\n/**\n * 判断是否是IE8~11, 不包含Edge\n * @returns {boolean}\n * @note IE11下 window.ActiveXObject的值很怪异, 所以需要追加 'ActiveXObject' in window 来判断\n */\nexport const isIE = hasWindow && (!!window.ActiveXObject || 'ActiveXObject' in window);\n\nexport function noop(v) {\n    return v;\n}\n\n/**\n * 变换两个参数的函数到多个参数\n * @param  {Function} fn 基函数\n * @return {Function} 变换后的函数\n * @demo\n *      function add(x, y) { return x+y; }\n *      add = redo(add);\n *      add(1,2,3) => 6\n */\nexport function redo(fn) {\n    return function () {\n        var args = arguments;\n        var ret = fn(args[0], args[1]);\n        for (var i = 2, l = args.length; i < l; i++) {\n            ret = fn(ret, args[i]);\n        }\n        return ret;\n    }\n};\n\nconst random = Math.random;\nconst floor = Math.floor;\nexport function makeRandom() {\n    return floor(random() * 9e9);\n};\n\nconst absoluteUrlReg = /^(https?:)?\\/\\//;\nexport function isAbsoluteUrl(url) {\n    return !!url.match(absoluteUrlReg);\n};\n\nconst relativeUrlReg = /^[\\.\\/]/;\nexport function isRelativeUrl(url) {\n    return !!url.match(relativeUrlReg);\n};\n\nconst BOOLEAN = 'boolean';\nexport function isBoolean(v) {\n    return typeof v === BOOLEAN;\n};\n\nconst STRING = 'string';\nexport function isString(v) {\n    return typeof v === STRING;\n};\n\nconst FUNCTION = 'function';\nexport function isFunction(v) {\n    return typeof v === FUNCTION;\n};\n\nexport function runAsFn(v) {\n    return isFunction(v) ? v() : v;\n};\n\nconst NUMBER = 'number';\nexport function isNumber(v) {\n    return !isNaN(v) && typeof v === NUMBER;\n};\n\nconst OBJECT = 'object';\nexport function isObject(v) {\n    return typeof v === OBJECT && v !== NULL;\n};\n\nexport function isWindow(v) {\n    return v !== NULL && v === v.window;\n};\n\n// 参考了zepto\nexport function isPlainObject(v) {\n    return v !== NULL && isObject(v) && !isWindow(v) && Object.getPrototypeOf(v) === Object.prototype;\n}\n\nexport function isEmptyObject(v) {\n    let count = 0;\n    for (let i in v) {\n        if (v.hasOwnProperty(i)) {\n            count++;\n        }\n    }\n    return count === 0;\n}\n\nexport function isArray(v) {\n    return toString.call(v) === ARRAY_TYPE;\n}\n\n/**\n * 判断是否跨域\n * @type {Element}\n * @note 需要特别关注IE8~11的行为是不一样的!!!\n */\nlet originA;\nif(doc) {\n    originA = doc.createElement('a');\n    originA.href = location.href;\n}\nexport function isCrossDomain(url) {\n\n    let requestA = doc.createElement('a');\n    requestA.href = url;\n\n    // 如果`url`的值不包含`protocol`和`host`(比如相对路径), 在标准浏览器下, 会自定补全`requestA`对象的`protocal`和`host`属性.\n    // 但在IE8~11下, 不会自动补全. 即`requestA.protocol`和`requestA.host`的值都是空的.\n    // 在IE11的不同小版本下, requestA.protocol的值有的是`:`, 有的是空字符串, 太奇葩啦!\n    if (__FALLBACK__) {\n        if (isIE && (requestA.protocol === ':' || requestA.protocol === '')) {\n            if (requestA.hostname === '') {\n                //alert(0)\n                return false;\n            } else {\n                //alert('1:'+(originA.hostname !== requestA.hostname || originA.port !== requestA.port))\n                return originA.hostname !== requestA.hostname || originA.port !== requestA.port;\n            }\n        }\n    }\n\n    // 标准浏览器\n    return originA.hostname !== requestA.hostname || originA.port !== requestA.port || originA.protocol !== requestA.protocol;\n};\n\n/**\n * 对象扩展\n * @param  {Object} receiver\n * @param  {Object} supplier\n * @return {Object} 扩展后的receiver对象\n * @note 这个extend方法是定制的, 不要拷贝到其他地方用!!!\n * @note 这个extend方法是深拷贝方式的!!!\n */\nfunction _extend(receiver = {}, supplier = {}, deepCopy = FALSE) {\n    for (let key in supplier) {\n        // `supplier`中不是未定义的键 都可以执行扩展\n        if (supplier.hasOwnProperty(key) && supplier[key] !== undefined) {\n            if (deepCopy === TRUE) {\n                if (isArray(supplier[key])) {\n                    receiver[key] = [].concat(supplier[key]);\n                } else if (isPlainObject(supplier[key])) {\n                    receiver[key] = extend({}, supplier[key]);\n                } else {\n                    receiver[key] = supplier[key];\n                }\n            } else {\n                receiver[key] = supplier[key];\n            }\n        }\n    }\n    return receiver;\n};\n\nconst extend = redo(_extend)\nexport {extend}\n\nexport function likeArray(v) {\n    if (!v) {\n        return false;\n    }\n    return typeof v.length === NUMBER;\n};\n\n/**\n *\n * @param v {Array|Object} 遍历目标对象\n * @param fn {Function} 遍历器 会被传入两个参数, 分别是`value`和`key`\n */\nexport function each(v, fn) {\n    let i, l;\n    if (likeArray(v)) {\n        for (i = 0, l = v.length; i < l; i++) {\n            if (fn.call(v[i], v[i], i) === false) return;\n        }\n    } else {\n        for (i in v) {\n            if (fn.call(v[i], v[i], i) === false) return;\n        }\n    }\n};\n\n/**\n * 将对象的`键`排序后 返回一个新对象\n *\n * @param obj {Object} 被操作的对象\n * @returns {Object} 返回的新对象\n * @case 这个函数用于对比两次请求的参数是否一致\n */\nexport function sortPlainObjectKey(obj) {\n    let clone = {};\n    let key;\n    let keyArray = [];\n    for (key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            keyArray.push(key);\n            if (isPlainObject(obj[key])) {\n                obj[key] = sortPlainObjectKey(obj[key]);\n            }\n        }\n    }\n    keyArray.sort();\n    for (let i=0, l=keyArray.length; i<l; i++) {\n        clone[keyArray[i]] = obj[keyArray[i]];\n    }\n    return clone;\n};\n\nexport function serialize(params, obj, traditional, scope) {\n    let type, array = isArray(obj), hash = isPlainObject(obj);\n    each(obj, function(value, key) {\n        type = toString.call(value);\n        if (scope) {\n            key = traditional ? scope : scope + '[' + (hash || type == OBJECT_TYPE || type == ARRAY_TYPE ? key : '') + ']';\n        }\n\n        // 递归\n        if (!scope && array) {\n            params.add(value.name, value.value);\n        }\n        // recurse into nested objects\n        else if (type == ARRAY_TYPE || (!traditional && type == OBJECT_TYPE)) {\n            serialize(params, value, traditional, key);\n        } else {\n            params.add(key, value);\n        }\n    });\n};\n\n/**\n * 功能和`Zepto.param`一样\n * @param obj {Object}\n * @param traditional {Boolean}\n * @returns {string}\n * $.param({ foo: { one: 1, two: 2 }}) // \"foo[one]=1&foo[two]=2)\"\n * $.param({ ids: [1,2,3] })           // \"ids[]=1&ids[]=2&ids[]=3\"\n * $.param({ ids: [1,2,3] }, true)     // \"ids=1&ids=2&ids=3\"\n * $.param({ foo: 'bar', nested: { will: 'not be ignored' }})    // \"foo=bar&nested[will]=not+be+ignored\"\n * $.param({ foo: 'bar', nested: { will: 'be ignored' }}, true)  // \"foo=bar&nested=[object+Object]\"\n * $.param({ id: function(){ return 1 + 2 } })  // \"id=3\"\n */\nexport function param(obj, traditional) {\n    var params = [];\n    params.add = (key, value) => {\n        if (isFunction(value)) value = value();\n        if (value == NULL) value = '';\n        params.push(escape(key) + '=' + escape(value));\n    };\n    serialize(params, obj, traditional);\n    return params.join('&').replace(/%20/g, '+');\n};\n\nexport function decodeParam(str) {\n    return decodeURIComponent(str.replace(/\\+/g, ' '));\n};\n\n// 给URL追加查询字符串\nexport function appendQueryString(url, obj, urlStamp, traditional) {\n    // 是否添加时间戳\n    if (urlStamp) {\n        obj[isBoolean(urlStamp) ? '_stamp' : urlStamp] = +new Date()\n    }\n    let queryString = param(obj, traditional);\n\n    if (queryString) {\n        return url + (~url.indexOf('?') ? '&' : '?') + queryString;\n    } else {\n        return url;\n    }\n};","/**\n * src/event.js\n *\n * @license MIT License\n * @author jias (https://github.com/jias/natty-fetch)\n */\nconst PREFIX = '_';\nfunction rename (type) { return PREFIX + type; }\n\nexport default {\n    on : function () {\n        var t    = this;\n        var args = arguments;\n        if (typeof args[0] === 'string' && typeof args[1] === 'function') {\n            var type = rename(args[0]);\n            t[type]  = t[type] || [];\n            t[type].push(args[1]);\n        } else if (typeof args[0] === 'object') {\n            var hash = args[0];\n            for (var i in hash) {\n                t.on(i, hash[i]);\n            }\n        }\n    },\n    off : function (type, fn) {\n        var t = this;\n        var type = rename(type);\n        if (!fn) {\n            delete t[type];\n        } else {\n            var fns = t[type];\n            fns.splice(fns.indexOf(fn), 1);\n            if (!t[type].length) delete t[type];\n        }\n    },\n    // @param {array} args\n    fire : function (type, args, context) {\n        var t = this;\n        var fns = t[rename(type)];\n        if (!fns) return 'NO_EVENT';\n        for (var i=0, fn; fn = fns[i]; i++) {\n            fn.apply(context || t, [].concat(args));\n        }\n    },\n    hasEvent : function (type) {\n        return !!this[rename(type)];\n    }\n}","/**\n * src/ajax.js\n *\n * @license MIT License\n * @author jias (https://github.com/jias/natty-fetch)\n */\nimport {\n    extend, appendQueryString, noop, isCrossDomain, isBoolean, param,\n    FALSE, NULL, UNDEFINED\n} from './util';\n\nconst supportCORS = UNDEFINED !== typeof XMLHttpRequest && 'withCredentials' in (new XMLHttpRequest());\nconst GET = 'GET';\nconst POST = 'POST';\nconst SCRIPT = 'script';\nconst XML = 'xml';\nconst JS0N = 'json'; // NOTE 不能使用`JSON`，这里用数字零`0`代替了字母`O`\n\n// minetype的简写映射\n// TODO 考虑是否优化\nconst acceptToRequestHeader = {\n    // IIS returns `application/x-javascript` 但应该不需要支持\n    '*':    '*/' + '*',\n    script: 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript',\n    json:   'application/json, text/json',\n    xml:    'application/xml, text/xml',\n    html:   'text/html',\n    text:   'text/plain'\n};\n\n// 设置请求头\n// 没有处理的事情：跨域时使用者传入的多余的Header没有屏蔽 没必要\nconst setHeaders = (xhr, options) => {\n\n    let header = {\n        Accept: acceptToRequestHeader[options.accept]\n    };\n    // 如果没有跨域 则打该标识 业界通用做法\n    // TODO 如果是跨域的 只有有限的requestHeader是可以使用的 待补充注释\n    if (!isCrossDomain(options.url)) {\n        header['X-Requested-With'] = 'XMLHttpRequest';\n    }\n\n    extend(header, options.header);\n\n    // 如果是`POST`请求，根据options.postDataFormat设置对应的Content-Type\n    // FORM和JSON都强制使用对应的Content-Type，RAW则不改动Content-Type的值，由调用者指定\n    if (options.method === 'POST') {\n        let pdf = options.postDataFormat;\n        let contentType = (pdf === 'FORM')\n            ? 'application/x-www-form-urlencoded; charset=UTF-8'\n            : (pdf === 'JSON')\n                ? 'application/json; charset=UTF-8'\n                : NULL;\n        if (contentType !== NULL)\n            header['Content-Type'] = contentType;\n    }\n\n    for (let key in header) {\n        xhr.setRequestHeader(key, header[key]);\n    }\n};\n\n// 绑定事件\n// NOTE 还得继续使用readystatechange事件\n//      比较遗憾 到现在了依然不能安全的使用load和error等事件 就连PC端的chrome都有下面的问题\n//      500: 触发load loadend 不触发error\n//      404: 触发load loadend 不触发error\nconst setEvents = (xhr, options) => {\n\n    // 再高级的浏览器都有低级错误! 已经不能在相信了!\n    // MAC OSX Yosemite Safari上的低级错误: 一次`ajax`请求的`loadend`事件完成之后,\n    // 如果执行`xhr.abort()`, 居然还能触发一遍`abort`和`loadend`事件!!!\n    // `_finished`标识一次完整的请求是否结束, 如果已结束, 则不再触发任何事件\n    xhr._finished = FALSE;\n\n    const readyStateChangeFn = () => {\n        if (xhr._finished) {\n            return;\n        }\n        //console.log('xhr.readyState', xhr.readyState, 'xhr.status', xhr.status, xhr);\n        if (xhr.readyState === 4) {\n            // 如果请求被取消(aborted) 则`xhr.status`会是0 所以不会进入`success`回调\n            if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {\n                //let mime = xhr.getResponseHeader('Content-Type');\n                let data = xhr.responseText;\n                switch (options.accept) {\n                    case JS0N:\n                        try {\n                            data = JSON.parse(data)\n                        } catch (e) {\n                            console.warn('The response can NOT be parsed to JSON object.', data);\n                        }\n                        break;\n                    case SCRIPT:\n                        (1, eval)(data);\n                        break;\n                    case XML:\n                        data = xhr.responseXML;\n                        break;\n                    //case HTML:\n                    //case TEXT:\n                    default:\n                        break;\n                }\n                options.success(data, xhr);\n            } else {\n                // 因为取消时会先触发原生的`onreadystatechange`响应，后触发`onAbort`回调，所以\n                // 如果请求被取消(aborted) 则`xhr.status`会是0 程序走到这里的时候，`xhr._aborted`状态是false，\n                // 需要排除，不应该触发`error`回调\n                !xhr._aborted && options.error(xhr.status, xhr);\n            }\n        }\n    };\n\n\n    // readyState value:\n    //   0: UNSET 未初始化\n    //   1: OPENED\n    //   2: HEADERS_RECEIVED\n    //   3: LOADING\n    //   4: DONE 此时触发load事件\n    xhr.addEventListener(\"readystatechange\", readyStateChangeFn);\n\n    //xhr.addEventListener('error', function () {\n    //    console.log('xhr event: error');\n    //});\n\n    //xhr.addEventListener('load', function () {\n    //    console.log('xhr event: load');\n    //});\n\n    const abortFn = () => {\n        if (xhr._finished) {\n            return;\n        }\n        //options.log && console.info('~abort');\n        options.abort(xhr.status, xhr);\n    };\n\n    xhr.addEventListener('abort', abortFn);\n\n    const loadedFn = () => {\n        if (xhr._finished) {\n            return;\n        }\n        xhr._finished = true;\n        //options.log && console.info('~loadend');\n        options.complete(xhr.status, xhr);\n        delete xhr._aborted;\n    }\n\n    xhr.addEventListener('loadend', loadedFn);\n};\n\nconst defaultOptions = {\n    url: '',\n    mark: {},\n    useMark: true,\n    method: GET,\n    accept: '*',\n    data: null,\n    header: {},\n    withCredentials: NULL, // 根据`url`是否跨域决定默认值. 如果显式配置该值(必须是布尔值), 则个使用配置值\n    urlStamp: true,\n    success: noop,\n    error: noop,\n    complete: noop,\n    abort: noop,\n    log: FALSE,\n    traditional: FALSE,\n    postDataFormat: 'FORM'\n};\n\nexport default function ajax(options) {\n\n    options = extend({}, defaultOptions, options);\n\n    // 是否跨域\n    let isCD = isCrossDomain(options.url);\n\n    let xhr = new XMLHttpRequest();\n\n    setEvents(xhr, options);\n\n    xhr.open(options.method, appendQueryString(\n        options.url,\n        extend({}, options.useMark ? options.mark : {}, options.method === GET ? options.data : {}),\n        options.urlStamp,\n        options.traditional\n    ));\n\n    // NOTE 生产环境的Server端, `Access-Control-Allow-Origin`的值一定不要配置成`*`!!! 而且`Access-Control-Allow-Credentials`应该是true!!!\n    // NOTE 如果Server端的`responseHeader`配置了`Access-Control-Allow-Origin`的值是通配符`*` 则前端`withCredentials`是不能使用true值的\n    // NOTE 如果Client端`withCredentials`使用了true值 则后端`responseHeader`中必须配置`Access-Control-Allow-Credentials`是true\n        xhr.withCredentials = isBoolean(options.withCredentials) ? options.withCredentials : isCD;\n\n    // 设置requestHeader\n    setHeaders(xhr, options);\n\n    // 根据postDataFormat来格式化要发送的数据\n    let pdf = options.postDataFormat;\n    let sendData;\n    if (options.method === GET || options.data === NULL)\n        sendData = NULL;\n    else\n        sendData = (pdf === 'FORM')\n            ? param(options.data, options.traditional)\n            : (pdf === 'JSON')\n                ? JSON.stringify(options.data)\n                : options.data;\n\n    // 文档建议说 send方法如果不发送请求体数据 则null参数在某些浏览器上是必须的\n    xhr.send(sendData);\n\n    let originAbort = xhr.abort;\n\n    // 重写`abort`方法\n    xhr.abort = () => {\n        xhr._aborted = true;\n        // NOTE 直接调用`originAbort()`时 浏览器会报 `Illegal invocation` 错误\n        originAbort.call(xhr);\n    };\n\n    return xhr;\n};\n\n// 移动端不需要fallback\najax.fallback = false;\najax.supportCORS = supportCORS;\n\n/**\n * file: ajax.js\n * ref https://xhr.spec.whatwg.org\n * ref https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n * ref https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest\n * ref https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS\n * ref https://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n * ref http://www.html5rocks.com/en/tutorials/cors/\n * @link http://enable-cors.org/index.html\n */\n","/**\n * src/jsonp.js\n *\n * @license MIT License\n * @author jias (https://github.com/jias/natty-fetch)\n */\nimport {appendQueryString, noop, extend, makeRandom, hasWindow, NULL, FALSE} from './util';\nconst win = hasWindow ? window : NULL;\nconst doc = hasWindow ? document : NULL;\nconst SCRIPT = 'script';\n\nconst removeScript = (script) => {\n    script.onerror = NULL;\n    script.parentNode.removeChild(script);\n    script = NULL;\n};\nlet head = NULL;\nconst insertScript = (url, options) => {\n    let script = doc.createElement(SCRIPT);\n    script.src = url;\n    script.async = true;\n\n    script.onerror = (e) => {\n        win[options.callbackName] = NULL;\n        options.error(e);\n        options.complete();\n    };\n\n    head = head || doc.getElementsByTagName('head')[0];\n    head.insertBefore(script, head.firstChild);\n    return script;\n}\n\nconst defaultOptions = {\n    url: '',\n    mark: {},\n    useMark: true,\n    data: {},\n    urlStamp: true,\n    success: noop,\n    error: noop,\n    complete: noop,\n    log: false,\n    flag: 'callback',\n    callbackName: 'jsonp{id}',\n    traditional: FALSE\n};\n\nexport default function jsonp(options) {\n\n    options = extend({}, defaultOptions, options);\n\n    let callbackName = options.callbackName = options.callbackName.replace(/\\{id\\}/, makeRandom());\n\n    let originComplete = options.complete;\n\n    let script;\n\n    // 二次包装的`complete`回调\n    options.complete = () => {\n        // 删除脚本\n        removeScript(script);\n        originComplete();\n    }\n\n    // 成功回调\n    win[callbackName] = (data) => {\n        // JSONP函数需要立即删除 用于`IE8`判断是否触发`onerror`\n        win[callbackName] = NULL;\n        options.success(data);\n        options.complete();\n    };\n\n    // 生成`url`\n    let url = appendQueryString(\n        options.url,\n        extend({[options.flag]: callbackName}, options.useMark ? options.mark : {}, options.data),\n        options.urlStamp,\n        options.traditional\n    );\n\n    // 插入脚本\n    script = insertScript(url, options);\n    \n    return {\n        abort() {\n            // 覆盖成功回调为无数据处理版本\n            win[callbackName] = () => {\n                win[callbackName] = NULL;\n            };\n            removeScript(script);\n        }\n    };\n}\n","/**\n * src/defer.js\n *\n * @license MIT License\n * @author jias (https://github.com/jias/natty-fetch)\n */\nexport default class Defer {\n  constructor(Promise) {\n    const t = this\n    t.promise = new Promise(function (resolve, reject) {\n      t._resolve = resolve\n      t._reject = reject\n    })\n  }\n\n  resolve(value) {\n    this._resolve.call(this.promise, value)\n  }\n\n  reject(reason) {\n    this._reject.call(this.promise, reason)\n  }\n}","\n/**\n * src/plugin.loop.js\n * 创建轮询支持\n *\n * @license MIT License\n * @author jias (https://github.com/jias/natty-fetch)\n */\nimport {isNumber, noop, TRUE, FALSE, NULL} from './util'\n\n/**\n * 创建轮询支持\n * @param api {Function} 需要轮询的函数\n */\nexport default function(apiInstance) {\n    let api = apiInstance.api;\n    api.loop = (options, resolveFn = noop, rejectFn = noop) => {\n        if (!options.duration || !isNumber(options.duration)) {\n            throw new Error('Illegal `duration` value for `startLoop` method.')\n        }\n\n        let loopTimer = NULL\n\n        let stop = () => {\n            clearTimeout(loopTimer)\n            loopTimer = NULL\n            stop.looping = FALSE\n        }\n\n        let sleepAndRequest = () => {\n            stop.looping = TRUE\n            loopTimer = setTimeout(() => {\n                api(options.data).then(resolveFn, rejectFn)\n                sleepAndRequest()\n            }, options.duration)\n        }\n\n        // NOTE 轮询过程中是不响应服务器端错误的 所以第二个参数是`noop`\n        api(options.data).then(resolveFn, rejectFn)\n        sleepAndRequest()\n        \n        return stop\n    }\n}\n","/**\n * src/plugin.soon.js\n *\n * @license MIT License\n * @author jias (https://github.com/jias/natty-fetch)\n */\nimport {noop, isEmptyObject, sortPlainObjectKey, FALSE, TRUE} from './util';\n\nexport default function(apiInstance) {\n    let t = this;\n    let api = apiInstance.api;\n    let {config} = api;\n    api.soon = function(data, successFn = noop, errorFn = noop) {\n\n        // 是否忽略自身的并发请求\n        // NOTE 这个地方和内置的api方法不一致\n        if (config.ignoreSelfConcurrent && config.pending) {\n            return;\n        }\n\n        if (config.overrideSelfConcurrent && config._lastRequester) {\n            config._lastRequester.abort();\n            delete config._lastRequester;\n        }\n\n        // 一次请求的私有相关数据\n        let vars = t.makeVars(data);\n\n        let remoteRequest = function () {\n            t.remoteRequest(vars, config).then(function (content) {\n                successFn({\n                    fromStorage: FALSE,\n                    content\n                });\n            })['catch'](function (e) {\n                errorFn(e);\n            });\n        }\n\n        if (api.storageUseable) {\n\n            // 只有GET和JSONP才会有storage生效\n            vars.queryString = isEmptyObject(vars.data) ? 'no-query-string' : JSON.stringify(sortPlainObjectKey(vars.data));\n\n            api.storage.has(vars.queryString).then(function (result) {\n\n                // console.warn('has cached: ', hasValue);\n                if (result.has) {\n                    successFn({\n                        fromStorage: TRUE,\n                        content: result.value\n                    });\n                }\n\n                // 在`storage`可用的情况下, 远程请求返回的数据会同步到`storage`\n                remoteRequest();\n            });\n        } else {\n            remoteRequest();\n        }\n    };\n};","/**\n * src/natty-fetch.js\n *\n * @license MIT License\n * @author jias (https://github.com/jias/natty-fetch)\n */\n\nimport nattyStorage from 'natty-storage';\n\nif (nattyStorage === undefined) {\n    console.warn('Please install the `natty-storage` script which is required by `natty-fetch`, go on with' +\n        ' https://www.npmjs.com/package/natty-storage');\n}\n\nimport * as util from './util';\nconst {\n    extend, runAsFn, isAbsoluteUrl,\n    isRelativeUrl, noop, isBoolean,\n    isArray, isFunction,\n    sortPlainObjectKey, isEmptyObject,\n    isPlainObject, dummyPromise,\n    isString, NULL, TRUE, FALSE, EMPTY, hasWindow\n} = util;\n\nimport Defer from './defer';\nimport event from './event';\n\nimport ajax from './__AJAX__';\nimport jsonp from './__JSONP__';\n\n// 内置插件\nimport pluginLoop from './plugin.loop';\nimport pluginSoon from './plugin.soon';\n\n// 全局默认配置\nconst defaultGlobalConfig = {\n\n    // 默认参数\n    data: {},\n\n    // 请求完成钩子函数\n    didFetch: noop,\n\n    // 预处理回调\n    fit: noop,\n\n    // 自定义header, 只针对非跨域的ajax有效, 跨域时将忽略自定义header\n    header: {},\n\n    // 是否忽律接口自身的并发请求\n    ignoreSelfConcurrent: FALSE,\n\n    // 有两种格式配置`jsonp`的值\n    // {Boolean}\n    // {Array} eg: [TRUE, 'cb', 'j{id}']\n    jsonp: FALSE,\n\n    // 是否开启log信息\n    log: FALSE,\n\n    // 非GET方式对JSONP无效\n    method: 'GET',\n\n    // 是否开启mock模式\n    mock: FALSE,\n\n    mockUrl: EMPTY,\n\n    // 全局`mockUrl`前缀\n    mockUrlPrefix: EMPTY,\n\n    // 全局`mockUrl`后缀\n    mockUrlSuffix: EMPTY,\n\n    // 成功回调\n    process: noop,\n\n    // 私有Promise对象, 如果不想用浏览器原生的Promise对象的话\n    Promise: hasWindow ? window.Promise : NULL,\n\n    // 默认不执行重试\n    retry: 0,\n\n    // 使用已有的request方法\n    customRequest: NULL,\n\n    // 0表示不启动超时处理\n    timeout: 0,\n\n    // http://zeptojs.com/#$.param\n    traditional: FALSE,\n\n    url: EMPTY,\n\n    // 全局`url`前缀\n    urlPrefix: EMPTY,\n\n    // 是否在`url`上添加时间戳, 用于避免浏览器的304缓存\n    urlStamp: TRUE,\n\n    // 全局`url`后缀\n    urlSuffix: EMPTY,\n\n    // TODO 文档中没有暴露\n    withCredentials: NULL,\n\n    // 请求之前调用的钩子函数\n    willFetch: noop,\n\n    // 扩展: storage\n    storage: false,\n\n    // 插件\n    // 目前只支持两种插件\n    // plugins: [\n    //     nattyFetch.plugin.loop\n    //     nattyFetch.plugin.soon\n    // ]\n    plugins: false,\n\n    // POST的data格式，有以下三种，值严格区分大小写：\n    // 1. FORM\n    // 2. JSON\n    // 3. RAW\n    // 4. (其他任何值都将被视为RAW)\n    // 默认为FORM，跟Natty-Fetch原始逻辑兼容\n    postDataFormat: 'FORM'\n};\n\nlet runtimeGlobalConfig = extend({}, defaultGlobalConfig);\n\nclass API {\n    constructor(path, options, contextConfig, contextId) {\n        let t = this;\n        t.contextConfig = contextConfig;\n        t._path = path;\n\n        let config = t.config = t.processAPIOptions(options);\n\n        /**\n         * `api`的实现\n         * @param data {Object|Function}\n         * @returns {Object} Promise Object\n         */\n        t.api = function (data) {\n            data = data || {};\n            // 是否忽略自身的并发请求\n            if (config.ignoreSelfConcurrent && t.api.pending) {\n                return dummyPromise;\n            }\n\n            if (config.overrideSelfConcurrent && t.api._requester) {\n                t.api.abort();\n            }\n\n            let vars = t.makeVars(data);\n\n            if (config.retry === 0) {\n                return t.request(vars, config);\n            } else {\n                return t.tryRequest(vars, config);\n            }\n        };\n\n        t.api.contextId = contextId;\n        t.api._path = path;\n\n        // 标记是否正在等待请求返回\n        t.api.pending = FALSE;\n        t.api._requester = NULL;\n\n        // 取消响应\n        t.api.abort = function () {\n            if (t.api.pending && t.api._requester) {\n                t.api._requester.abort();\n            }\n        };\n\n        t.api.config = config;\n\n        t.initStorage();\n\n        // 启动插件\n        let plugins = isArray(config.plugins) ? config.plugins : [];\n        for (let i = 0, l = plugins.length; i<l; i++) {\n            isFunction(plugins[i]) && plugins[i].call(t, t);\n        }\n    }\n\n    makeVars(data) {\n        let t = this;\n        let config = t.config;\n\n        // 一次请求的私有相关数据\n        let vars = {\n            mark: {\n                _api: t._path\n            }\n        };\n\n        if (config.mock) {\n            vars.mark._mock = TRUE;\n        }\n\n        // if (config.urlStamp) {\n        //     vars.mark._stamp = +new Date();\n        // }\n\n        // `data`必须在请求发生时实时创建\n        // 如果postDataFormat是非FORM/JSON值时，不对data进行处理，因为这种情况下调用者意图直接向服务端传递RAW数据，\n        // 这时传入的data极有可能是字符串\n        // 当config.data是{}的情况下，如果调用者传入的data是字符串，经过extend()处理以后就会变成字符串数组\n        // 字符串数组被后续传递给xhr.send()时会被默认调用toString()，结果就变成'[object object]'这种不合法数据\n        if (config.postDataFormat === 'FORM' || config.postDataFormat === 'JSON')\n            data = extend({}, runAsFn(config.data), runAsFn(data));\n\n        // 将数据参数存在私有标记中, 方便API的`process`方法内部使用\n        vars.data = data;\n\n        return vars;\n    }\n\n    /**\n     * 处理API的配置\n     * @param options {Object}\n     */\n    processAPIOptions(options) {\n\n        let t = this;\n\n        // 插件是不能覆盖的, 应该追加\n        let plugins = [].concat(t.contextConfig.plugins || [], options.plugins || []);\n\n        let config = extend({}, t.contextConfig, options, {\n            plugins\n        });\n\n        if (config.mock) {\n            config.mockUrl = t.getFullUrl(config);\n        }\n\n        config.url = t.getFullUrl(config);\n\n        // 按照[boolean, callbackKeyWord, callbackFunctionName]格式处理\n        if (isArray(options.jsonp)) {\n            config.jsonp = isBoolean(options.jsonp[0]) ? options.jsonp[0] : FALSE;\n            // 这个参数只用于jsonp\n            if (config.jsonp) {\n                config.jsonpFlag = options.jsonp[1];\n                config.jsonpCallbackName = options.jsonp[2];\n            }\n        }\n\n        // 配置自动增强 如果`url`的值有`.jsonp`结尾 则认为是`jsonp`请求\n        // NOTE jsonp是描述正式接口的 不影响mock接口!!!\n        if (!config.mock && !!config.url.match(/\\.jsonp(\\?.*)?$/)) {\n            config.jsonp = TRUE;\n        }\n\n        return config;\n    }\n\n    initStorage() {\n        let t = this;\n        let config = t.config;\n\n        // 开启`storage`的前提条件\n        let storagePrecondition = config.method === 'GET' || config.jsonp;\n\n        // 不满足`storage`使用条件的情况下, 开启`storage`将抛出错误\n        if (!storagePrecondition && config.storage === TRUE) {\n            throw new Error('A `' + config.method + '` request CAN NOT use `storage` which is only for `GET/jsonp`' +\n                ' request! Please check the options for `' + t._path + '`');\n        }\n\n        // 简易开启缓存的写法\n        if (config.storage === TRUE) {\n            config.storage = {\n                type: 'variable'\n            };\n        }\n\n        // 决定什么情况下缓存可以开启\n        t.api.storageUseable = isPlainObject(config.storage)\n            && (config.method === 'GET' || config.jsonp)\n            && nattyStorage.support[config.storage.type];\n        // 创建缓存实例\n        if (t.api.storageUseable) {\n            // 当使用`localStorage`时, 强制指定`key`值。如果没指定, 抛错!\n            // 当使用`variable`或`sessionStorage`时, 如果没指定`key`, 则自动生成内部`key`\n            // !!!为什么在使用`localStorage`时必须指定`key`值???\n            // !!!因为当key发生变化时, `localStorage`很容易产生死数据, 必须强制开发者有意识的去维护`key`值\n            if (config.storage.type === 'localStorage') {\n                if (!config.storage.hasOwnProperty('key') || !config.storage.key) {\n                    throw new Error('`key` is required when `storage.type` is `localStorage`.');\n                }\n            } else {\n                config.storage.key = config.storage.key || [t.api.contextId, t._path].join('_');\n            }\n\n            // `key`和`tag`的选择原则:\n            // `key`只选用相对稳定的值, 减少因为`key`的改变而增加的残留缓存\n            // 经常变化的值用于`tag`, 如一个接口在开发过程中可能使用方式不一样, 会在`jsonp`和`get`之间切换。\n            t.api.storage = nattyStorage(extend({}, config.storage, {\n                async: TRUE,\n                tag: [\n                    config.storage.tag,\n                    config.jsonp ? 'jsonp' : config.method,\n                    config.url\n                ].join('_') // 使用者的`tag`和内部的`tag`, 要同时生效\n            }));\n        }\n    }\n\n    /**\n     * 请求数据(从storage或者从网络)\n     * @param vars {Object} 发送的数据\n     * @param config {Object} 已经处理完善的请求配置\n     * @returns {Object} defer对象\n     */\n    request(vars, config) {\n        let t = this;\n\n        if (t.api.storageUseable) {\n\n            // 只有GET和JSONP才会有storage生效\n            vars.queryString = isEmptyObject(vars.data) ? 'no-query-string' : JSON.stringify(sortPlainObjectKey(vars.data));\n\n            return t.api.storage.has(vars.queryString).then(function (data) {\n                // alert(JSON.stringify(data, null, 4) + JSON.stringify(sessionStorage, null, 4));\n                // console.warn('has cached: ', hasValue);\n                if (data.has) {\n                    return data.value;\n                } else {\n                    return t.remoteRequest(vars, config);\n                }\n            });\n        } else {\n            return t.remoteRequest(vars, config);\n        }\n    }\n\n    /**\n     * 获取正式接口的完整`url`\n     * @param config {Object}\n     */\n    getFullUrl(config) {\n        let url = config.mock ? config.mockUrl : config.url;\n        if (!url) return EMPTY;\n        let prefixKey = config.mock ? 'mockUrlPrefix' : 'urlPrefix';\n        let suffixKey = config.mock ? 'mockUrlSuffix' : 'urlSuffix';\n        let prefix = config[prefixKey] && !isAbsoluteUrl(url) && !isRelativeUrl(url) ? config[prefixKey] : EMPTY;\n        let suffix = config[suffixKey] ? config[suffixKey]: EMPTY;\n        return prefix + url + suffix;\n    }\n\n    /**\n     * 发起网络请求\n     * @param vars\n     * @param config\n     * @returns {Promise}\n     */\n    remoteRequest(vars, config) {\n        let t = this;\n\n        // 调用 willFetch 钩子\n        config.willFetch(vars, config, 'remote');\n\n        // 等待状态在此处开启 在相应的`requester`的`complete`回调中关闭\n        t.api.pending = TRUE;\n\n        let defer = new Defer(config.Promise);\n\n        // 创建请求实例requester\n        if (config.customRequest) {\n            // 使用已有的request方法\n            t.api._requester = config.customRequest(vars, config, defer);\n        } else if (config.jsonp) {\n            t.api._requester = t.sendJSONP(vars, config, defer);\n        } else {\n            t.api._requester = t.sendAjax(vars, config, defer);\n        }\n\n        // 超时处理\n        if (0 !== config.timeout) {\n            setTimeout(() => {\n                if (t.api.pending && t.api._requester) {\n                    // 取消请求\n                    t.api.abort();\n\n                    let error = {\n                        timeout: TRUE,\n                        message: 'Timeout By ' + config.timeout + 'ms.'\n                    };\n\n                    defer.reject(error);\n                    event.fire('g.reject', [error, config]);\n                    event.fire(t.api.contextId + '.reject', [error, config]);\n                }\n            }, config.timeout);\n        }\n\n        return defer.promise;\n    }\n\n    /**\n     * 重试功能的实现\n     * @param vars {Object} 发送的数据\n     * @param config\n     * @returns {Object} defer对象\n     */\n    tryRequest(vars, config) {\n        let t = this;\n\n        return new config.Promise(function (resolve, reject) {\n            let retryTime = 0;\n            let request = () => {\n                // 更新的重试次数\n                vars.mark._retryTime = retryTime;\n                t.request(vars, config).then((content) => {\n                    resolve(content);\n                    event.fire('g.resolve', [content, config], config);\n                    event.fire(t.api.contextId + '.resolve', [content, config], config);\n                }, (error) => {\n                    if (retryTime === config.retry) {\n                        reject(error);\n                    } else {\n                        retryTime++;\n                        request();\n                    }\n                });\n            };\n\n            request();\n        });\n    }\n\n    /**\n     * 处理结构化的响应数据\n     * @param config\n     * @param response\n     * @param defer\n     */\n    processResponse(vars, config, defer, response) {\n        let t = this;\n\n        // 调用 didFetch 钩子函数\n        config.didFetch(vars, config);\n\n        // 非标准格式数据的预处理\n        response = config.fit(response, vars);\n\n\n\n        if (response.success) {\n            // 数据处理\n            let content = config.process(response.content, vars);\n\n            let resolveDefer = function () {\n                defer.resolve(content);\n                event.fire('g.resolve', [content, config], config);\n                event.fire(t.api.contextId + '.resolve', [content, config], config);\n            }\n\n            if (t.api.storageUseable) {\n                t.api.storage.set(vars.queryString, content).then(function () {\n                    resolveDefer();\n                })['catch'](function () {\n                    resolveDefer();\n                });\n            } else {\n                resolveDefer();\n            }\n        } else {\n            let error = extend({\n                message: '`success` is false, ' + t._path\n            }, response.error);\n            // NOTE response是只读的对象!!!\n            defer.reject(error);\n            event.fire('g.reject', [error, config]);\n            event.fire(t.api.contextId + '.reject', [error, config]);\n        }\n    }\n\n    /**\n     * 发起Ajax请求\n     * @param config {Object} 请求配置\n     * @param defer {Object} defer对象\n     * @param retryTime {undefined|Number} 如果没有重试 将是undefined值 见`createAPI`方法\n     *                                     如果有重试 将是重试的当前次数 见`tryRequest`方法\n     * @returns {Object} xhr对象实例\n     */\n    sendAjax(vars, config, defer) {\n        const t = this;\n        const url = config.mock ? config.mockUrl : config.url;\n\n        return ajax({\n            traditional: config.traditional,\n            urlStamp: config.urlStamp,\n            mark: vars.mark,\n            useMark: config.mark,\n            log: config.log,\n            url: url,\n            method: config.method,\n            data: vars.data,\n            header: config.header,\n            withCredentials: config.withCredentials,\n            // 强制约定json\n            accept: 'json',\n            success(response/*, xhr*/) {\n                t.processResponse(vars, config, defer, response);\n            },\n            error(status) {\n                // 如果跨域使用了自定义的header，且服务端没有配置允许对应的header，此处status为0，目前无法处理。\n                const error = {\n                    status,\n                    message: `Error(status ${status}) in request for ${vars.mark._api}(${url})`\n                };\n\n                defer.reject(error);\n                event.fire('g.reject', [error, config]);\n                event.fire(t.api.contextId + '.reject', [error, config]);\n            },\n            complete(/*status, xhr*/) {\n                if (vars.retryTime === undefined || vars.retryTime === config.retry) {\n                    //C.log('ajax complete');\n\n                    t.api.pending = FALSE;\n                    t.api._requester = NULL;\n                }\n                //console.log('__complete: pending:', config.pending, 'retryTime:', retryTime, Math.random());\n            },\n            postDataFormat: config.postDataFormat\n        });\n    }\n\n    /**\n     * 发起jsonp请求\n     * @param vars {Object} 一次请求相关的私有数据\n     * @param config {Object} 请求配置\n     * @param defer {Object} defer对象\n     * @param retryTime {undefined|Number} 如果没有重试 将是undefined值 见`createAPI`方法\n     *                                     如果有重试 将是重试的当前次数 见`tryRequest`方法\n     * @returns {Object} 带有abort方法的对象\n     */\n    sendJSONP(vars, config, defer) {\n        const t = this;\n        const url = config.mock ? config.mockUrl : config.url;\n        return jsonp({\n            traditional: config.traditional,\n            log: config.log,\n            mark: vars.mark,\n            useMark: config.mark,\n            url: url,\n            data: vars.data,\n            urlStamp: config.urlStamp,\n            flag: config.jsonpFlag,\n            callbackName: config.jsonpCallbackName,\n            success(response) {\n                t.processResponse(vars, config, defer, response);\n            },\n            error() {\n                let error = {\n                    message: `Not accessable JSONP in request for ${vars.mark._api}(${url})`\n                };\n\n                defer.reject(error);\n                event.fire('g.reject', [error, config]);\n                event.fire(t.api.contextId + '.reject', [error, config]);\n            },\n            complete() {\n                if (vars.retryTime === undefined || vars.retryTime === config.retry) {\n                    t.api.pending = FALSE;\n                    t.api._requester = NULL;\n                }\n            }\n        });\n    }\n}\n\n/**\n * 关键词\n *     语意化的\n *     优雅的\n *     功能增强的\n *     底层隔离的\n */\nconst context = (function () {\n    let count = 0;\n\n    return function(contextId, options) {\n\n        if (isString(contextId)) {\n            options = options || {};\n        } else {\n            options = contextId || {}\n            contextId = 'c' + count++;\n        }\n\n        let storage = nattyStorage({\n            type: 'variable',\n            key: contextId\n        });\n\n        let ctx = {};\n\n        ctx.api = storage.get();\n\n        ctx._contextId = contextId;\n\n        // 插件是不能覆盖的, 应该追加\n        let plugins = [].concat(runtimeGlobalConfig.plugins || [], options.plugins || []);\n\n        ctx._config = extend({}, runtimeGlobalConfig, options, {\n            plugins\n        });\n\n        /**\n         * 创建api\n         * @param namespace {String} optional\n         * @param APIs {Object} 该`namespace`下的`api`配置\n         */\n        ctx.create = function(namespace, APIs) {\n            let hasNamespace = arguments.length === 2 && isString(namespace);\n\n            if (!hasNamespace) {\n                APIs = namespace;\n            }\n\n            for (let path in APIs) {\n                storage.set(\n                    hasNamespace ? namespace + '.' + path : path,\n                    new API(\n                        hasNamespace ? namespace + '.' + path : path,\n                        runAsFn(APIs[path]),\n                        ctx._config,\n                        contextId\n                    ).api\n                );\n            }\n\n            ctx.api = storage.get();\n        }\n\n        // 绑定上下文事件\n        ctx.on = function(name, fn) {\n            if (!isFunction(fn)) return;\n            event.on(ctx._contextId + '.' + name, fn);\n            return ctx;\n        }\n\n        return ctx;\n    }\n})();\n\n/**\n * 简易接口\n * @param options\n */\nlet nattyFetch = {};\n\nnattyFetch.create = function (options) {\n    return new API('nattyFetch', runAsFn(options), defaultGlobalConfig, 'global').api;\n};\n\nextend(nattyFetch, {\n    onlyForModern: !__FALLBACK__,\n    version: '__VERSION__',\n    _util: util,\n    _event: event,\n    context,\n    ajax,\n    jsonp,\n\n    /**\n     * 执行全局配置\n     * @param options\n     */\n    setGlobal(options) {\n        runtimeGlobalConfig = extend({}, defaultGlobalConfig, options);\n        return this;\n    },\n\n    /**\n     * 获取全局配置\n     * @param property {String} optional\n     * @returns {*}\n     */\n    getGlobal(property) {\n        return property ? runtimeGlobalConfig[property] : runtimeGlobalConfig;\n    },\n\n    // 绑定全局事件\n    on(name, fn) {\n        if (!isFunction(fn)) return;\n        event.on('g.' + name, fn);\n        return this;\n    },\n\n    /**\n     * 插件名称空间\n     */\n    plugin: {\n        loop: pluginLoop,\n        soon: pluginSoon\n    }\n});\n\n// 内部直接将运行时的全局配置初始化到默认值\nnattyFetch.setGlobal(defaultGlobalConfig);\n\nexport default nattyFetch;"],"names":["noop","v","redo","fn","args","arguments","ret","i","l","length","makeRandom","floor","random","isAbsoluteUrl","url","match","absoluteUrlReg","isRelativeUrl","relativeUrlReg","isBoolean","BOOLEAN","isString","STRING","isFunction","FUNCTION","runAsFn","isNumber","isNaN","NUMBER","isObject","OBJECT","NULL","isWindow","window","isPlainObject","Object","getPrototypeOf","prototype","isEmptyObject","let","count","hasOwnProperty","isArray","toString","call","ARRAY_TYPE","isCrossDomain","requestA","doc","createElement","href","originA","hostname","port","protocol","_extend","receiver","supplier","deepCopy","FALSE","key","undefined","TRUE","concat","extend","likeArray","each","sortPlainObjectKey","obj","clone","keyArray","push","sort","serialize","params","traditional","scope","type","array","hash","value","OBJECT_TYPE","add","name","param","escape","join","replace","decodeParam","str","decodeURIComponent","appendQueryString","urlStamp","Date","queryString","indexOf","rename","PREFIX","ajax","options","defaultOptions","isCD","xhr","XMLHttpRequest","setEvents","open","method","useMark","mark","GET","data","withCredentials","setHeaders","sendData","pdf","postDataFormat","JSON","stringify","send","originAbort","abort","_aborted","jsonp","script","callbackName","originComplete","complete","removeScript","win","success","flag","insertScript","hasWindow","document","encodeURIComponent","UNDEFINED","EMPTY","dummyPromise","dummy","then","isIE","ActiveXObject","Math","location","const","Defer","Promise","t","this","promise","resolve","reject","_resolve","_reject","reason","on","off","fns","splice","fire","context","apply","hasEvent","supportCORS","SCRIPT","XML","JS0N","acceptToRequestHeader","*","json","xml","html","text","header","Accept","accept","contentType","setRequestHeader","_finished","readyStateChangeFn","readyState","status","responseText","parse","e","console","warn","eval","responseXML","error","addEventListener","abortFn","loadedFn","log","fallback","onerror","parentNode","removeChild","head","src","async","getElementsByTagName","insertBefore","firstChild","apiInstance","api","loop","resolveFn","rejectFn","duration","Error","loopTimer","stop","clearTimeout","looping","sleepAndRequest","setTimeout","config","soon","successFn","errorFn","ignoreSelfConcurrent","pending","overrideSelfConcurrent","_lastRequester","vars","makeVars","remoteRequest","content","fromStorage","storageUseable","storage","has","result","nattyStorage","defaultGlobalConfig","didFetch","fit","mock","mockUrl","mockUrlPrefix","mockUrlSuffix","process","retry","customRequest","timeout","urlPrefix","urlSuffix","willFetch","plugins","runtimeGlobalConfig","API","path","contextConfig","contextId","_path","processAPIOptions","_requester","request","tryRequest","initStorage","_api","_mock","getFullUrl","jsonpFlag","jsonpCallbackName","storagePrecondition","support","tag","prefixKey","suffixKey","prefix","suffix","defer","sendJSONP","sendAjax","message","event","retryTime","_retryTime","processResponse","response","resolveDefer","set","ctx","get","_contextId","_config","create","namespace","APIs","hasNamespace","nattyFetch","onlyForModern","version","_util","util","_event","setGlobal","getGlobal","property","plugin","pluginLoop","pluginSoon"],"mappings":"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"}